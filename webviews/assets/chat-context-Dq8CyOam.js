var Vd=Object.defineProperty;var cc=s=>{throw TypeError(s)};var Zd=(s,n,i)=>n in s?Vd(s,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[n]=i;var d=(s,n,i)=>Zd(s,typeof n!="symbol"?n+"":n,i),ca=(s,n,i)=>n.has(s)||cc("Cannot "+i);var g=(s,n,i)=>(ca(s,n,"read from private field"),i?i.call(s):n.get(s)),it=(s,n,i)=>n.has(s)?cc("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(s):n.set(s,i),W=(s,n,i,o)=>(ca(s,n,"write to private field"),o?o.call(s,i):n.set(s,i),i),k=(s,n,i)=>(ca(s,n,"access private method"),i);var Is=(s,n,i,o)=>({set _(l){W(s,n,l,i)},get _(){return g(s,n,o)}});import{W as U,S as Ac}from"./ButtonAugment-DueOA3_V.js";import{d as Yd}from"./Content-7zb4jZEH.js";import{ab as xr,a9 as Rn,S as Ps,d as Ns,e as Us,h as nr,j as ct,k as Tr,l as je,n as tn,m as Mr,al as Sr,a5 as Jd,z as Kd,A as Xd,b as ga,t as pa,B as Qd,P as lc,y as Ds,Q as la,a0 as Fc,a1 as hc,V as dc,W as fc,X as gc,a2 as Rc,ad as tf,an as ef}from"./index-p4Dt6o3z.js";import{p as nf,S as rf,a as pc}from"./pen-to-square-DUXCbbi7.js";import{n as qc,a as sf,g as af}from"./file-paths-BEF4tZXQ.js";var Oc=(s=>(s.chat="chat",s))(Oc||{}),Dc=(s=>(s.chatMentionFolder="chat-mention-folder",s.chatMentionFile="chat-mention-file",s.chatMentionExternalSource="chat-mention-external-source",s.chatClearContext="chat-clear-context",s.chatRestoreDefaultContext="chat-restore-default-context",s.chatUseActionFind="chat-use-action-find",s.chatUseActionExplain="chat-use-action-explain",s.chatUseActionFix="chat-use-action-autofix",s.chatUseActionWriteTest="chat-use-action-write-test",s.chatNewConversation="chat-new-conversation",s.chatNewAutofixConversation="chat-new-autofix-conversation",s.chatEditConversationName="chat-edit-conversation-name",s.chatFailedSmartPasteResolveFile="chat-failed-smart-paste-resolve-file",s.chatPrecomputeSmartPaste="chat-precompute-smart-paste",s.chatSmartPaste="chat-smart-paste",s.chatCodeblockCopy="chat-codeblock-copy",s.chatCodeblockCreate="chat-codeblock-create",s.chatCodeblockGoToFile="chat-codeblock-go-to-file",s.chatCodespanGoToFile="chat-codespan-go-to-file",s.chatCodespanGoToSymbol="chat-codespan-go-to-symbol",s.chatMermaidblockInitialize="chat-mermaidblock-initialize",s.chatMermaidblockToggle="chat-mermaidblock-toggle",s.chatMermaidblockInteract="chat-mermaidblock-interact",s.chatMermaidBlockError="chat-mermaidblock-error",s.chatUseSuggestedQuestion="chat-use-suggested-question",s.chatDisplaySuggestedQuestions="chat-display-suggested-questions",s.setWorkspaceGuidelines="chat-set-workspace-guidelines",s.clearWorkspaceGuidelines="chat-clear-workspace-guidelines",s.setUserGuidelines="chat-set-user-guidelines",s.clearUserGuidelines="chat-clear-user-guidelines",s))(Dc||{}),te=(s=>(s[s.TEXT=0]="TEXT",s[s.TOOL_RESULT=1]="TOOL_RESULT",s[s.IMAGE=2]="IMAGE",s[s.IMAGE_ID=3]="IMAGE_ID",s[s.IDE_STATE=4]="IDE_STATE",s[s.EDIT_EVENTS=5]="EDIT_EVENTS",s[s.CHECKPOINT_REF=6]="CHECKPOINT_REF",s[s.CHANGE_PERSONALITY=7]="CHANGE_PERSONALITY",s))(te||{}),Zn=(s=>(s[s.IMAGE_FORMAT_UNSPECIFIED=0]="IMAGE_FORMAT_UNSPECIFIED",s[s.PNG=1]="PNG",s[s.JPEG=2]="JPEG",s[s.GIF=3]="GIF",s[s.WEBP=4]="WEBP",s))(Zn||{}),kc=(s=>(s[s.UNSPECIFIED=0]="UNSPECIFIED",s[s.USER_EDIT=1]="USER_EDIT",s[s.CHECKPOINT_REVERT=2]="CHECKPOINT_REVERT",s))(kc||{}),of=(s=>(s[s.CONTENT_TYPE_UNSPECIFIED=0]="CONTENT_TYPE_UNSPECIFIED",s[s.CONTENT_TEXT=1]="CONTENT_TEXT",s[s.CONTENT_IMAGE=2]="CONTENT_IMAGE",s))(of||{}),ee=(s=>(s[s.RAW_RESPONSE=0]="RAW_RESPONSE",s[s.SUGGESTED_QUESTIONS=1]="SUGGESTED_QUESTIONS",s[s.MAIN_TEXT_FINISHED=2]="MAIN_TEXT_FINISHED",s[s.TOOL_USE=5]="TOOL_USE",s[s.AGENT_MEMORY=6]="AGENT_MEMORY",s))(ee||{}),_a=(s=>(s.chat="CHAT",s.agent="AGENT",s.remoteAgent="REMOTE_AGENT",s.memories="MEMORIES",s.orientation="ORIENTATION",s.memoriesCompression="MEMORIES_COMPRESSION",s))(_a||{}),Pt=(s=>(s[s.DEFAULT=0]="DEFAULT",s[s.PROTOTYPER=1]="PROTOTYPER",s[s.BRAINSTORM=2]="BRAINSTORM",s[s.REVIEWER=3]="REVIEWER",s))(Pt||{}),oe=(s=>(s.getEditListRequest="agent-get-edit-list-request",s.getEditListResponse="agent-get-edit-list-response",s.getEditChangesByRequestIdRequest="agent-get-edit-changes-by-request-id-request",s.getEditChangesByRequestIdResponse="agent-get-edit-changes-by-request-id-response",s.setCurrentConversation="agent-set-current-conversation",s.revertToTimestamp="revert-to-timestamp",s.chatAgentEditAcceptAll="chat-agent-edit-accept-all",s.reportAgentSessionEvent="report-agent-session-event",s.reportAgentRequestEvent="report-agent-request-event",s.chatReviewAgentFile="chat-review-agent-file",s.getAgentEditContentsByRequestId="get-agent-edit-contents-by-request-id",s.getAgentEditContentsByRequestIdResponse="get-agent-edit-contents-by-request-id-response",s.checkHasEverUsedAgent="check-has-ever-used-agent",s.checkHasEverUsedAgentResponse="check-has-ever-used-agent-response",s.setHasEverUsedAgent="set-has-ever-used-agent",s))(oe||{}),ma=(s=>(s.closeAllToolProcesses="close-all-tool-processes",s.getToolIdentifierRequest="get-tool-identifier-request",s.getToolIdentifierResponse="get-tool-identifier-response",s))(ma||{});const ha="augment-welcome";var ut=(s=>(s.draft="draft",s.sent="sent",s.failed="failed",s.success="success",s.cancelled="cancelled",s))(ut||{}),Tn=(s=>(s.running="running",s.awaitingUserAction="awaiting-user-action",s.notRunning="not-running",s))(Tn||{}),Wt=(s=>(s.seen="seen",s.unseen="unseen",s))(Wt||{}),Yn=(s=>(s.signInWelcome="sign-in-welcome",s.generateCommitMessage="generate-commit-message",s.summaryResponse="summary-response",s.summaryTitle="summary-title",s.educateFeatures="educate-features",s.autofixMessage="autofix-message",s.autofixSteeringMessage="autofix-steering-message",s.autofixStage="autofix-stage",s.agentOnboarding="agent-onboarding",s.agenticTurnDelimiter="agentic-turn-delimiter",s.agenticRevertDelimiter="agentic-revert-delimiter",s.agenticCheckpointDelimiter="agentic-checkpoint-delimiter",s.exchange="exchange",s))(Yn||{});function de(s){return!!s&&(s.chatItemType===void 0||s.chatItemType==="agent-onboarding")}function Jn(s){return de(s)&&s.status==="success"}function $f(s){return s.chatItemType==="autofix-message"}function Vf(s){return s.chatItemType==="autofix-steering-message"}function Zf(s){return s.chatItemType==="autofix-stage"}function Yf(s){return s.chatItemType==="sign-in-welcome"}function Jf(s){return s.chatItemType==="generate-commit-message"}function Kf(s){return s.chatItemType==="summary-response"}function Xf(s){return s.chatItemType==="educate-features"}function Qf(s){return s.chatItemType==="agent-onboarding"}function tg(s){return s.chatItemType==="agentic-turn-delimiter"}function wr(s){return s.chatItemType==="agentic-checkpoint-delimiter"}function eg(s){return s.revertTarget!==void 0}function ng(s){var n;return((n=s.structured_output_nodes)==null?void 0:n.some(i=>i.type===ee.TOOL_USE))??!1}function rg(s){var n;return((n=s.structured_request_nodes)==null?void 0:n.some(i=>i.type===te.TOOL_RESULT))??!1}function sg(s){return!(!s||typeof s!="object")&&(!("request_id"in s)||typeof s.request_id=="string")&&(!("seen_state"in s)||s.seen_state==="seen"||s.seen_state==="unseen")}class uf{constructor(n,i,o,l=5,f=4e3,_){d(this,"_isCancelled",!1);this.requestId=n,this.chatMessage=i,this.startStreamFn=o,this.maxRetries=l,this.baseDelay=f,this.flags=_}cancel(){this._isCancelled=!0}async*getStream(){let n=0,i=!1;try{for(;!this._isCancelled;){const o=this.startStreamFn(this.chatMessage,this.flags?{flags:this.flags}:void 0);let l=!1,f="";for await(const b of o){if(b.status===ut.failed){if(b.isRetriable!==!0||i)return yield b;l=!0,f=b.display_error_message||"Service is currently unavailable";break}i=!0,yield b}if(!l)return;if(this._isCancelled)return yield this.createCancelledStatus();if(n++,n>this.maxRetries)return void(yield{request_id:this.requestId,seen_state:Wt.unseen,status:ut.failed,display_error_message:f,isRetriable:!1});const _=this.baseDelay*2**(n-1);yield{request_id:this.requestId,status:ut.sent,display_error_message:`Service temporarily unavailable. Retrying in ${_/1e3} seconds... (Attempt ${n} of ${this.maxRetries})`,isRetriable:!0},await new Promise(b=>setTimeout(b,_)),yield{request_id:this.requestId,status:ut.sent,display_error_message:"Generating response...",isRetriable:!0}}this._isCancelled&&(yield this.createCancelledStatus())}catch(o){yield{request_id:this.requestId,seen_state:Wt.unseen,status:ut.failed,display_error_message:o instanceof Error?o.message:String(o)}}}createCancelledStatus(){return{request_id:this.requestId,seen_state:Wt.unseen,status:ut.cancelled}}}function fe(s,n){return n in s&&s[n]!==void 0}function Pc(s){return fe(s,"file")}function va(s){return fe(s,"recentFile")}function Nc(s){return fe(s,"folder")}function ya(s){return fe(s,"sourceFolder")}function ig(s){return fe(s,"sourceFolderGroup")}function _c(s){return fe(s,"selection")}function Uc(s){return fe(s,"externalSource")}function ag(s){return fe(s,"allDefaultContext")}function og(s){return fe(s,"clearContext")}function mc(s){return fe(s,"userGuidelines")}function ug(s){return fe(s,"agentMemories")}function Aa(s){return fe(s,"personality")}const cg={allDefaultContext:!0,label:"Default Context",id:"allDefaultContext"},lg={clearContext:!0,label:"Clear Context",id:"clearContext"},hg={userGuidelines:{enabled:!1,overLimit:!1,contents:"",lengthLimit:2e3},label:"User Guidelines",id:"userGuidelines"},cf={agentMemories:{},label:"Agent Memories",id:"agentMemories"},vc=[{personality:{type:Pt.DEFAULT,description:"Expert software engineer - trusted coding agent, at your service!"},label:"Agent Auggie",name:"auggie-personality-agent-default",id:"auggie-personality-agent-default"},{personality:{type:Pt.PROTOTYPER,description:"Fast and loose - let's get it done, boss!"},label:"Prototyper Auggie",name:"auggie-personality-prototyper",id:"auggie-personality-prototyper"},{personality:{type:Pt.BRAINSTORM,description:"Thoughtful and creative - thinking through all possibilities..."},label:"Brainstorm Auggie",name:"auggie-personality-brainstorm",id:"auggie-personality-brainstorm"},{personality:{type:Pt.REVIEWER,description:"Code detective - finding issues and analyzing implications"},label:"Reviewer Auggie",name:"auggie-personality-reviewer",id:"auggie-personality-reviewer"}];function dg(s){return fe(s,"group")}function fg(s){const n=new Map;return s.forEach(i=>{Pc(i)?n.set("file",[...n.get("file")??[],i]):va(i)?n.set("recentFile",[...n.get("recentFile")??[],i]):Nc(i)?n.set("folder",[...n.get("folder")??[],i]):Uc(i)?n.set("externalSource",[...n.get("externalSource")??[],i]):ya(i)?n.set("sourceFolder",[...n.get("sourceFolder")??[],i]):Aa(i)&&n.set("personality",[...n.get("personality")??[],i])}),[{label:"Personalities",id:"personalities",group:{type:"personality",materialIcon:"person",items:n.get("personality")??[]}},{label:"Files",id:"files",group:{type:"file",materialIcon:"insert_drive_file",items:n.get("file")??[]}},{label:"Folders",id:"folders",group:{type:"folder",materialIcon:"folder",items:n.get("folder")??[]}},{label:"Source Folders",id:"sourceFolders",group:{type:"sourceFolder",materialIcon:"folder_managed",items:n.get("sourceFolder")??[]}},{label:"Recently Opened Files",id:"recentlyOpenedFiles",group:{type:"recentFile",materialIcon:"insert_drive_file",items:n.get("recentFile")??[]}},{label:"Documentation",id:"externalSources",group:{type:"externalSource",materialIcon:"link",items:n.get("externalSource")??[]}}].filter(i=>i.group.items.length>0)}function Fs(s){const n={label:qc(s.pathName).split("/").filter(i=>i.trim()!=="").pop()||"",name:s.pathName,id:nf({rootPath:s.repoRoot,relPath:s.pathName})};if(s.fullRange){const i=`:L${s.fullRange.startLineNumber}-${s.fullRange.endLineNumber}`;n.label+=i,n.name+=i,n.id+=i}else if(s.range){const i=`:L${s.range.start}-${s.range.stop}`;n.label+=i,n.name+=i,n.id+=i}return n}class lf{constructor(n,i,o){d(this,"getChatInitData",async()=>(await this._asyncMsgSender.send({type:U.chatLoaded},3e4)).data);d(this,"reportWebviewClientEvent",n=>{this._asyncMsgSender.send({type:U.reportWebviewClientMetric,data:{webviewName:Oc.chat,client_metric:n,value:1}})});d(this,"reportAgentSessionEvent",n=>{this._asyncMsgSender.sendToSidecar({type:oe.reportAgentSessionEvent,data:n})});d(this,"reportAgentRequestEvent",n=>{this._asyncMsgSender.sendToSidecar({type:oe.reportAgentRequestEvent,data:n})});d(this,"getSuggestions",async(n,i=!1)=>{const o={rootPath:"",relPath:n},l=this.findFiles(o,6),f=this.findRecentlyOpenedFiles(o,6),_=this.findFolders(o,3),b=this.findExternalSources(n,i),[S,A,q,D]=await Promise.all([Es(l,[]),Es(f,[]),Es(_,[]),Es(b,[])]),tt=(N,rt)=>({...Fs(N),[rt]:N}),et=[...S.map(N=>tt(N,"file")),...q.map(N=>tt(N,"folder")),...A.map(N=>tt(N,"recentFile")),...D.map(N=>({label:N.name,name:N.name,id:N.id,externalSource:N}))];if(this._flags.enablePersonalities){const N=this.getPersonalities(n);N.length>0&&et.push(...N)}return et});d(this,"getPersonalities",n=>{if(!this._flags.enablePersonalities)return[];if(n==="")return vc;const i=n.toLowerCase();return vc.filter(o=>{const l=o.personality.description.toLowerCase(),f=o.label.toLowerCase();return l.includes(i)||f.includes(i)})});d(this,"sendAction",n=>{this._host.postMessage({type:U.mainPanelPerformAction,data:n})});d(this,"showAugmentPanel",()=>{this._asyncMsgSender.send({type:U.showAugmentPanel})});d(this,"openConfirmationModal",async n=>(await this._asyncMsgSender.send({type:U.openConfirmationModal,data:n},1e9)).data.ok);d(this,"clearMetadataFor",n=>{this._host.postMessage({type:U.chatClearMetadata,data:n})});d(this,"resolvePath",async(n,i=void 0)=>{const o=await this._asyncMsgSender.send({type:U.resolveFileRequest,data:{...n,exactMatch:!0,maxResults:1,searchScope:i}},5e3);if(o.data)return o.data});d(this,"resolveSymbols",async(n,i)=>(await this._asyncMsgSender.send({type:U.findSymbolRequest,data:{query:n,searchScope:i}},3e4)).data);d(this,"getDiagnostics",async()=>(await this._asyncMsgSender.send({type:U.getDiagnosticsRequest},1e3)).data);d(this,"findFiles",async(n,i=12)=>(await this._asyncMsgSender.send({type:U.findFileRequest,data:{...n,maxResults:i}},5e3)).data);d(this,"findFolders",async(n,i=12)=>(await this._asyncMsgSender.send({type:U.findFolderRequest,data:{...n,maxResults:i}},5e3)).data);d(this,"findRecentlyOpenedFiles",async(n,i=12)=>(await this._asyncMsgSender.send({type:U.findRecentlyOpenedFilesRequest,data:{...n,maxResults:i}},5e3)).data);d(this,"findExternalSources",async(n,i=!1)=>this._flags.enableExternalSourcesInChat?i?[]:(await this._asyncMsgSender.send({type:U.findExternalSourcesRequest,data:{query:n,source_types:[]}},5e3)).data.sources??[]:[]);d(this,"openFile",n=>{this._host.postMessage({type:U.openFile,data:n})});d(this,"openMemoriesFile",()=>{this._host.postMessage({type:U.openMemoriesFile})});d(this,"createFile",(n,i)=>{this._host.postMessage({type:U.chatCreateFile,data:{code:n,relPath:i}})});d(this,"openScratchFile",async(n,i="shellscript")=>{await this._asyncMsgSender.send({type:U.openScratchFileRequest,data:{content:n,language:i}},1e4)});d(this,"resolveWorkspaceFileChunk",async n=>{try{return(await this._asyncMsgSender.send({type:U.resolveWorkspaceFileChunkRequest,data:n},5e3)).data}catch{return}});d(this,"smartPaste",n=>{this._host.postMessage({type:U.chatSmartPaste,data:n})});d(this,"saveChat",async(n,i,o)=>this._asyncMsgSender.send({type:U.saveChat,data:{conversationId:n,chatHistory:i,title:o}}));d(this,"launchAutofixPanel",async(n,i,o)=>this._asyncMsgSender.send({type:U.chatLaunchAutofixPanel,data:{conversationId:n,iterationId:i,stage:o}}));d(this,"updateUserGuidelines",n=>{this._host.postMessage({type:U.updateUserGuidelines,data:n})});d(this,"openSettingsPage",n=>{this._host.postMessage({type:U.openSettingsPage,data:n})});d(this,"_activeRetryStreams",new Map);d(this,"cancelChatStream",async n=>{var i;(i=this._activeRetryStreams.get(n))==null||i.cancel(),await this._asyncMsgSender.send({type:U.chatUserCancel,data:{requestId:n}},1e4)});d(this,"sendUserRating",async(n,i,o,l="")=>{const f={requestId:n,rating:o,note:l,mode:i?_a.agent:_a.chat},_={type:U.chatRating,data:f};return(await this._asyncMsgSender.send(_,3e4)).data});d(this,"triggerUsedChatMetric",()=>{this._host.postMessage({type:U.usedChat})});d(this,"createProject",n=>{this._host.postMessage({type:U.mainPanelCreateProject,data:{name:n}})});d(this,"openProjectFolder",()=>{this._host.postMessage({type:U.mainPanelPerformAction,data:"open-folder"})});d(this,"closeProjectFolder",()=>{this._host.postMessage({type:U.mainPanelPerformAction,data:"close-folder"})});d(this,"cloneRepository",()=>{this._host.postMessage({type:U.mainPanelPerformAction,data:"clone-repository"})});d(this,"grantSyncPermission",()=>{this._host.postMessage({type:U.mainPanelPerformAction,data:"grant-sync-permission"})});d(this,"callTool",async(n,i,o,l,f,_)=>{const b={type:U.callTool,data:{chatRequestId:n,toolUseId:i,name:o,input:l,chatHistory:f,conversationId:_}};return(await this._asyncMsgSender.send(b,0)).data});d(this,"cancelToolRun",async(n,i)=>{const o={type:U.cancelToolRun,data:{requestId:n,toolUseId:i}};await this._asyncMsgSender.send(o,0)});d(this,"checkSafe",async(n,i)=>{const o={type:U.toolCheckSafe,data:{name:n,input:i}};return(await this._asyncMsgSender.send(o,0)).data.isSafe});d(this,"closeAllToolProcesses",async()=>{await this._asyncMsgSender.sendToSidecar({type:ma.closeAllToolProcesses},0)});d(this,"getToolIdentifier",async n=>{const i={type:ma.getToolIdentifierRequest,data:{toolName:n}};return(await this._asyncMsgSender.sendToSidecar(i,0)).data});d(this,"executeCommand",async(n,i,o)=>{try{const l=await this._asyncMsgSender.send({type:U.chatAutofixExecuteCommandRequest,data:{iterationId:n,command:i,args:o}},6e5);return{output:l.data.output,returnCode:l.data.returnCode}}catch(l){throw console.error("[ExtensionClient] Execute command failed:",l),l}});d(this,"sendAutofixStateUpdate",async n=>{await this._asyncMsgSender.send({type:U.chatAutofixStateUpdate,data:n})});d(this,"autofixPlan",async(n,i)=>(await this._asyncMsgSender.send({type:U.chatAutofixPlanRequest,data:{command:n,steeringHistory:i}},6e4)).data.plan);d(this,"setChatMode",n=>{this._asyncMsgSender.send({type:U.chatModeChanged,data:{mode:n}})});d(this,"getAgentEditList",async(n,i)=>{const o={type:oe.getEditListRequest,data:{fromTimestamp:n,toTimestamp:i}};return(await this._asyncMsgSender.sendToSidecar(o,3e4)).data});d(this,"hasChangesSince",async n=>{const i={type:oe.getEditListRequest,data:{fromTimestamp:n,toTimestamp:Number.MAX_SAFE_INTEGER}};return(await this._asyncMsgSender.sendToSidecar(i,3e4)).data.edits.filter(o=>{var l,f;return((l=o.changesSummary)==null?void 0:l.totalAddedLines)||((f=o.changesSummary)==null?void 0:f.totalRemovedLines)}).length>0});d(this,"getToolCallCheckpoint",async n=>{const i={type:U.getToolCallCheckpoint,data:{requestId:n}};return(await this._asyncMsgSender.send(i,3e4)).data.checkpointNumber});d(this,"setCurrentConversation",n=>{this._asyncMsgSender.sendToSidecar({type:oe.setCurrentConversation,data:{conversationId:n}})});d(this,"showAgentReview",(n,i,o,l=!0)=>{this._asyncMsgSender.sendToSidecar({type:oe.chatReviewAgentFile,data:{qualifiedPathName:n,fromTimestamp:i,toTimestamp:o,retainFocus:l}})});d(this,"acceptAllAgentEdits",async()=>(await this._asyncMsgSender.sendToSidecar({type:oe.chatAgentEditAcceptAll}),!0));d(this,"revertToTimestamp",async(n,i)=>(await this._asyncMsgSender.sendToSidecar({type:oe.revertToTimestamp,data:{timestamp:n,qualifiedPathNames:i}}),!0));d(this,"getAgentOnboardingPrompt",async()=>(await this._asyncMsgSender.send({type:U.chatGetAgentOnboardingPromptRequest,data:{}},3e4)).data.prompt);d(this,"getAgentEditChangesByRequestId",async n=>{const i={type:oe.getEditChangesByRequestIdRequest,data:{requestId:n}};return(await this._asyncMsgSender.sendToSidecar(i,3e4)).data});d(this,"getAgentEditContentsByRequestId",async n=>{const i={type:oe.getAgentEditContentsByRequestId,data:{requestId:n}};return(await this._asyncMsgSender.sendToSidecar(i,3e4)).data});d(this,"triggerInitialOrientation",()=>{this._host.postMessage({type:U.triggerInitialOrientation})});d(this,"getWorkspaceInfo",async()=>{try{return(await this._asyncMsgSender.send({type:U.getWorkspaceInfoRequest},5e3)).data}catch(n){return console.error("Error getting workspace info:",n),{}}});d(this,"checkAgentAutoModeApproval",async()=>(await this._asyncMsgSender.send({type:U.checkAgentAutoModeApproval},5e3)).data);d(this,"setAgentAutoModeApproved",async n=>{await this._asyncMsgSender.send({type:U.setAgentAutoModeApproved,data:n},5e3)});d(this,"checkHasEverUsedAgent",async()=>(await this._asyncMsgSender.sendToSidecar({type:oe.checkHasEverUsedAgent},5e3)).data);d(this,"setHasEverUsedAgent",async n=>{await this._asyncMsgSender.sendToSidecar({type:oe.setHasEverUsedAgent,data:n},5e3)});d(this,"getChatRequestIdeState",async()=>{const n={type:U.getChatRequestIdeStateRequest};return(await this._asyncMsgSender.send(n,3e4)).data});d(this,"reportError",n=>{this._host.postMessage({type:U.reportError,data:n})});this._host=n,this._asyncMsgSender=i,this._flags=o}async*generateCommitMessage(){const n={type:U.generateCommitMessage},i=this._asyncMsgSender.stream(n,3e4,6e4);yield*da(i)}async*sendInstructionMessage(n,i){const o={instruction:n.request_message??"",selectedCodeDetails:i,requestId:n.request_id},l={type:U.chatInstructionMessage,data:o},f=this._asyncMsgSender.stream(l,3e4,6e4);yield*async function*(_){let b;try{for await(const S of _)b=S.data.requestId,yield{request_id:b,response_text:S.data.text,seen_state:Wt.unseen,status:ut.sent};yield{request_id:b,seen_state:Wt.unseen,status:ut.success}}catch{yield{request_id:b,seen_state:Wt.unseen,status:ut.failed}}}(f)}async openGuidelines(n){this._host.postMessage({type:U.openGuidelines,data:n})}async*getExistingChatStream(n,i){if(!n.request_id)return;const o=i==null?void 0:i.flags.enablePreferenceCollection,l=o?1e9:6e4,f=o?1e9:3e5,_={type:U.chatGetStreamRequest,data:{requestId:n.request_id}},b=this._asyncMsgSender.stream(_,l,f);yield*da(b,this.reportError)}async*startChatStream(n,i){const o=i==null?void 0:i.flags.enablePreferenceCollection,l=o?1e9:6e4,f=o?1e9:3e5,_={type:U.chatUserMessage,data:n},b=this._asyncMsgSender.stream(_,l,f);yield*da(b,this.reportError)}async checkToolExists(n){return(await this._asyncMsgSender.send({type:U.checkToolExists,toolName:n},0)).exists}async saveImage(n,i){const o=new Uint8Array(await n.arrayBuffer()),l=i??`${await async function(f){const _=await crypto.subtle.digest("SHA-256",f);return Array.from(new Uint8Array(_)).map(b=>b.toString(16).padStart(2,"0")).join("")}(o)}.${n.name.split(".").at(-1)}`;return(await this._asyncMsgSender.send({type:U.chatSaveImageRequest,data:{filename:l,data:o}},1e4)).data}async loadImage(n){const i=(await this._asyncMsgSender.send({type:U.chatLoadImageRequest,data:n},1e4)).data;if(!i)return;let o="application/octet-stream";const l=n.split(".").at(-1);l==="png"?o="image/png":l!=="jpg"&&l!=="jpeg"||(o="image/jpeg");const f=new File([i],n,{type:o});return await async function(_){return new Promise((b,S)=>{const A=new FileReader;A.onload=q=>{var D;return b((D=q.target)==null?void 0:D.result)},A.onerror=S,A.readAsDataURL(_)})}(f)}async deleteImage(n){await this._asyncMsgSender.send({type:U.chatDeleteImageRequest,data:n},1e4)}async*startChatStreamWithRetry(n,i,o){const l=new uf(n,i,(f,_)=>this.startChatStream(f,_),(o==null?void 0:o.maxRetries)??5,4e3,o==null?void 0:o.flags);this._activeRetryStreams.set(n,l);try{yield*l.getStream()}finally{this._activeRetryStreams.delete(n)}}}async function*da(s,n=()=>{}){let i;try{for await(const o of s){if(i=o.data.requestId,o.type===U.chatModelReplyFailed)return yield{request_id:i,seen_state:Wt.unseen,status:ut.failed,display_error_message:o.displayErrorMessage,isRetriable:o.isRetriable};yield{request_id:i,response_text:o.data.text,workspace_file_chunks:o.data.workspaceFileChunks,structured_output_nodes:hf(o.data.nodes),seen_state:Wt.unseen,status:ut.sent}}yield{request_id:i,seen_state:Wt.unseen,status:ut.success}}catch(o){n({originalRequestId:i||"",sanitizedMessage:o instanceof Error?o.message:String(o),stackTrace:o instanceof Error&&o.stack||"",diagnostics:[{key:"error_class",value:"Extension-WebView Error"}]}),yield{request_id:i,seen_state:Wt.unseen,status:ut.failed}}}async function Es(s,n){try{return await s}catch(i){return console.warn(`Error while resolving promise: ${i}`),n}}function hf(s){if(!s)return s;let n=!1;return s.filter(i=>i.type!==ee.TOOL_USE||!n&&(n=!0,!0))}function df(s){var n;return((n=s.extraData)==null?void 0:n.isAutofix)===!0}function Kn(s){var n;return((n=s.extraData)==null?void 0:n.isAgentConversation)===!0}var kt=(s=>(s[s.active=0]="active",s[s.inactive=1]="inactive",s))(kt||{}),ff=(s=>(s.normal="Normal",s.autofixCommand="AutofixCommand",s.autofixPrompt="AutofixPrompt",s))(ff||{});const Lc=25e4;class gf{constructor(n){d(this,"_enableEditableHistory",!1);d(this,"_enablePreferenceCollection",!1);d(this,"_enableRetrievalDataCollection",!1);d(this,"_enableDebugFeatures",!1);d(this,"_enableRichTextHistory",!1);d(this,"_modelDisplayNameToId",{});d(this,"_fullFeatured",!0);d(this,"_enableExternalSourcesInChat",!1);d(this,"_smallSyncThreshold",15);d(this,"_bigSyncThreshold",1e3);d(this,"_enableSmartPaste",!1);d(this,"_enableDirectApply",!1);d(this,"_summaryTitles",!1);d(this,"_suggestedEditsAvailable",!1);d(this,"_enableShareService",!1);d(this,"_maxTrackableFileCount",Lc);d(this,"_enableDesignSystemRichTextEditor",!1);d(this,"_enableSources",!1);d(this,"_enableChatMermaidDiagrams",!1);d(this,"_smartPastePrecomputeMode",Ac.visibleHover);d(this,"_useNewThreadsMenu",!1);d(this,"_enableChatMermaidDiagramsMinVersion",!1);d(this,"_idleNewSessionNotificationTimeoutMs");d(this,"_idleNewSessionMessageTimeoutMs");d(this,"_enableChatMultimodal",!1);d(this,"_enableAgentMode",!1);d(this,"_enableRichCheckpointInfo",!1);d(this,"_agentMemoriesFilePathName");d(this,"_userTier","unknown");d(this,"_eloModelConfiguration",{highPriorityModels:[],regularBattleModels:[],highPriorityThreshold:.5});d(this,"_truncateChatHistory",!1);d(this,"_enableBackgroundAgents",!1);d(this,"_enableVirtualizedMessageList",!1);d(this,"_customPersonalityPrompts",{});d(this,"_enablePersonalities",!1);d(this,"_memoryClassificationOnFirstToken",!1);d(this,"_subscribers",new Set);d(this,"subscribe",n=>(this._subscribers.add(n),n(this),()=>{this._subscribers.delete(n)}));d(this,"update",n=>{this._enableEditableHistory=n.enableEditableHistory??this._enableEditableHistory,this._enablePreferenceCollection=n.enablePreferenceCollection??this._enablePreferenceCollection,this._enableRetrievalDataCollection=n.enableRetrievalDataCollection??this._enableRetrievalDataCollection,this._enableDebugFeatures=n.enableDebugFeatures??this._enableDebugFeatures,this._enableRichTextHistory=n.enableRichTextHistory??this._enableRichTextHistory,this._modelDisplayNameToId={...n.modelDisplayNameToId},this._fullFeatured=n.fullFeatured??this._fullFeatured,this._enableExternalSourcesInChat=n.enableExternalSourcesInChat??this._enableExternalSourcesInChat,this._smallSyncThreshold=n.smallSyncThreshold??this._smallSyncThreshold,this._bigSyncThreshold=n.bigSyncThreshold??this._bigSyncThreshold,this._enableSmartPaste=n.enableSmartPaste??this._enableSmartPaste,this._enableDirectApply=n.enableDirectApply??this._enableDirectApply,this._summaryTitles=n.summaryTitles??this._summaryTitles,this._suggestedEditsAvailable=n.suggestedEditsAvailable??this._suggestedEditsAvailable,this._enableShareService=n.enableShareService??this._enableShareService,this._maxTrackableFileCount=n.maxTrackableFileCount??this._maxTrackableFileCount,this._enableDesignSystemRichTextEditor=n.enableDesignSystemRichTextEditor??this._enableDesignSystemRichTextEditor,this._enableSources=n.enableSources??this._enableSources,this._enableChatMermaidDiagrams=n.enableChatMermaidDiagrams??this._enableChatMermaidDiagrams,this._smartPastePrecomputeMode=n.smartPastePrecomputeMode??this._smartPastePrecomputeMode,this._useNewThreadsMenu=n.useNewThreadsMenu??this._useNewThreadsMenu,this._enableChatMermaidDiagramsMinVersion=n.enableChatMermaidDiagramsMinVersion??this._enableChatMermaidDiagramsMinVersion,this._idleNewSessionMessageTimeoutMs=n.idleNewSessionMessageTimeoutMs??(n.enableDebugFeatures?this._idleNewSessionMessageTimeoutMs??3e5:this._idleNewSessionMessageTimeoutMs),this._idleNewSessionNotificationTimeoutMs=n.idleNewSessionNotificationTimeoutMs??0,this._enableChatMultimodal=n.enableChatMultimodal??this._enableChatMultimodal,this._enableAgentMode=n.enableAgentMode??this._enableAgentMode,this._enableRichCheckpointInfo=n.enableRichCheckpointInfo??this._enableRichCheckpointInfo,this._agentMemoriesFilePathName=n.agentMemoriesFilePathName??this._agentMemoriesFilePathName,this._userTier=n.userTier??this._userTier,this._eloModelConfiguration=n.eloModelConfiguration??this._eloModelConfiguration,this._truncateChatHistory=n.truncateChatHistory??this._truncateChatHistory,this._enableBackgroundAgents=n.enableBackgroundAgents??this._enableBackgroundAgents,this._enableVirtualizedMessageList=n.enableVirtualizedMessageList??this._enableVirtualizedMessageList,this._customPersonalityPrompts=n.customPersonalityPrompts??this._customPersonalityPrompts,this._enablePersonalities=n.enablePersonalities??this._enablePersonalities,this._memoryClassificationOnFirstToken=n.memoryClassificationOnFirstToken??this._memoryClassificationOnFirstToken,this._subscribers.forEach(i=>i(this))});d(this,"isModelIdValid",n=>n!==void 0&&Object.values(this._modelDisplayNameToId).includes(n));d(this,"getModelDisplayName",n=>{if(n!==void 0)return Object.keys(this._modelDisplayNameToId).find(i=>this._modelDisplayNameToId[i]===n)});n&&this.update(n)}get enableEditableHistory(){return this._fullFeatured&&(this._enableEditableHistory||this._enableDebugFeatures)}get enablePreferenceCollection(){return this._enablePreferenceCollection}get enableRetrievalDataCollection(){return this._enableRetrievalDataCollection}get enableDebugFeatures(){return this._enableDebugFeatures}get enableGenerateCommitMessage(){return this._enableDebugFeatures}get enableRichTextHistory(){return this._enableRichTextHistory}get modelDisplayNameToId(){return this._modelDisplayNameToId}get orderedModelDisplayNames(){return Object.keys(this._modelDisplayNameToId).sort((n,i)=>{const o=n.toLowerCase(),l=i.toLowerCase();return o==="default"&&l!=="default"?-1:l==="default"&&o!=="default"?1:n.localeCompare(i)})}get fullFeatured(){return this._fullFeatured}get enableExternalSourcesInChat(){return this._enableExternalSourcesInChat}get smallSyncThreshold(){return this._smallSyncThreshold}get bigSyncThreshold(){return this._bigSyncThreshold}get enableSmartPaste(){return this._enableDebugFeatures||this._enableSmartPaste}get enableDirectApply(){return this._enableDirectApply||this._enableDebugFeatures}get enableShareService(){return this._enableShareService}get summaryTitles(){return this._summaryTitles}get suggestedEditsAvailable(){return this._suggestedEditsAvailable}get maxTrackableFileCount(){return this._maxTrackableFileCount}get enableSources(){return this._enableDebugFeatures||this._enableSources}get enableChatMermaidDiagrams(){return this._enableDebugFeatures||this._enableChatMermaidDiagrams}get smartPastePrecomputeMode(){return this._smartPastePrecomputeMode}get useNewThreadsMenu(){return this._useNewThreadsMenu}get enableChatMermaidDiagramsMinVersion(){return this._enableChatMermaidDiagramsMinVersion}get enableDesignSystemRichTextEditor(){return this._enableDesignSystemRichTextEditor}get idleNewSessionNotificationTimeoutMs(){return this._idleNewSessionNotificationTimeoutMs??0}get idleNewSessionMessageTimeoutMs(){return this._idleNewSessionMessageTimeoutMs??0}get enableChatMultimodal(){return this._enableChatMultimodal}get enableAgentMode(){return this._enableAgentMode}get enableRichCheckpointInfo(){return this._enableRichCheckpointInfo}get agentMemoriesFilePathName(){return this._agentMemoriesFilePathName}get userTier(){return this._userTier}get eloModelConfiguration(){return this._eloModelConfiguration}get truncateChatHistory(){return this._truncateChatHistory}get enableBackgroundAgents(){return this._enableBackgroundAgents}get enableVirtualizedMessageList(){return this._enableVirtualizedMessageList||this._enableDebugFeatures}get customPersonalityPrompts(){return this._customPersonalityPrompts}get enablePersonalities(){return this._enablePersonalities||this._enableDebugFeatures}get memoryClassificationOnFirstToken(){return this._memoryClassificationOnFirstToken}}class pf{constructor(n=[]){d(this,"_items",[]);d(this,"_focusedItemIdx");d(this,"_subscribers",new Set);d(this,"subscribe",n=>(this._subscribers.add(n),n(this),()=>{this._subscribers.delete(n)}));d(this,"setItems",n=>{this._items=n,this._items.length===0?this.setFocusIdx(void 0):this._focusedItemIdx!==void 0&&this._focusedItemIdx>=this._items.length?this.setFocusIdx(this._items.length-1):this._focusedItemIdx===void 0?this.setFocusIdx(void 0):this.setFocusIdx(this._focusedItemIdx)});d(this,"setFocus",n=>{if(n!==void 0&&n===this.focusedItem)return;const i=n?this._items.indexOf(n):-1;i===-1?this.setFocusIdx(void 0):this.setFocusIdx(i)});d(this,"setFocusIdx",n=>{if(n===this._focusedItemIdx||this._items.length===0)return;if(n===void 0)return this._focusedItemIdx=void 0,void this.notifySubscribers();const i=Math.floor(n/this._items.length)*this._items.length;this._focusedItemIdx=(n-i)%this._items.length,this.notifySubscribers()});d(this,"initFocusIdx",n=>this._focusedItemIdx===void 0&&(this.setFocusIdx(n),!0));d(this,"focusNext",()=>{const n=this.nextIdx();if(n!==void 0)return this.setFocus(this._items[n]),n});d(this,"focusPrev",()=>{const n=this.prevIdx();if(n!==void 0)return this.setFocus(this._items[n]),n});d(this,"prevIdx",(n={})=>{if(this._items.length!==0)return this._focusedItemIdx===void 0?this._items.length-1:n.nowrap&&this._focusedItemIdx===0?0:(this._focusedItemIdx-1+this._items.length)%this._items.length});d(this,"nextIdx",(n={})=>{if(this._items.length!==0)return this._focusedItemIdx===void 0?0:n.nowrap&&this._focusedItemIdx===this._items.length-1?this._items.length-1:(this._focusedItemIdx+1)%this._items.length});d(this,"notifySubscribers",()=>{this._subscribers.forEach(n=>n(this))});this._items=n}get items(){return this._items}get focusedItem(){if(this._focusedItemIdx!==void 0)return this._items[this._focusedItemIdx]}get focusedItemIdx(){return this._focusedItemIdx}}function _f(s){return s===void 0?{num_lines:-1,num_chars:-1}:{num_lines:s.split(`
`).length,num_chars:s.length}}class Hc{constructor(){d(this,"tracingData",{flags:{},nums:{},string_stats:{},request_ids:{}})}setFlag(n,i=!0){this.tracingData.flags[n]={value:i,timestamp:new Date().toISOString()}}getFlag(n){const i=this.tracingData.flags[n];return i==null?void 0:i.value}setNum(n,i){this.tracingData.nums[n]={value:i,timestamp:new Date().toISOString()}}getNum(n){const i=this.tracingData.nums[n];return i==null?void 0:i.value}setStringStats(n,i){this.tracingData.string_stats[n]={value:_f(i),timestamp:new Date().toISOString()}}setRequestId(n,i){this.tracingData.request_ids[n]={value:i,timestamp:new Date().toISOString()}}}var mf=(s=>(s[s.unspecified=0]="unspecified",s[s.classify_and_distill=1]="classify_and_distill",s[s.orientation=2]="orientation",s))(mf||{}),vf=(s=>(s.start="start",s.end="end",s.memoriesRequestId="memoriesRequestId",s.exceptionThrown="exceptionThrown",s.lastUserExchangeRequestId="lastUserExchangeRequestId",s.noMemoryData="noMemoryData",s.agenticTurnHasRememberToolCall="agenticTurnHasRememberToolCall",s.emptyMemory="emptyMemory",s.removeUserExchangeMemoryFailed="removeUserExchangeMemoryFailed",s))(vf||{});class jc extends Hc{constructor(){super()}static create(){return new jc}}var Fa=(s=>(s.openedAgentConversation="opened-agent-conversation",s.revertCheckpoint="revert-checkpoint",s.agentInterruption="agent-interruption",s.sentUserMessage="sent-user-message",s.rememberToolCall="remember-tool-call",s.openedMemoriesFile="opened-memories-file",s.initialOrientation="initial-orientation",s.classifyAndDistill="classify-and-distill",s.flushMemories="flush-memories",s.vsCodeTerminalShellIntegrationNotAvailable="vs-code-terminal-shell-integration-not-available",s.vsCodeTerminalReadingApproximateOutput="vs-code-terminal-reading-approximate-output",s.vsCodeTerminalTimedOutWaitingForNoopCommand="vs-code-terminal-timed-out-waiting-for-noop-command",s.vsCodeTerminalFailedToUseShellIntegration="vs-code-terminal-failed-to-use-shell-integration",s.vsCodeTerminalLastCommandIsSameAsCurrent="vs-code-terminal-last-command-is-same-as-current",s.vsCodeTerminalPollingDeterminedProcessIsDone="vs-code-terminal-polling-determined-process-is-done",s.vsCodeTerminalFailedToReadOutput="vs-code-terminal-failed-to-read-output",s.vsCodeTerminalBuggyOutput="vs-code-terminal-buggy-output",s.vsCodeTerminalBuggyExecutionEvents="vs-code-terminal-buggy-execution-events",s.vsCodeTerminalUnsupportedVSCodeShell="vs-code-terminal-unsupported-vscode-shell",s.vsCodeTerminalFailedToFindGitBash="vs-code-terminal-failed-to-find-git-bash",s.vsCodeTerminalFailedToFindPowerShell="vs-code-terminal-failed-to-find-powershell",s.vsCodeTerminalNoSupportedShellsFound="vs-code-terminal-no-supported-shells-found",s.vsCodeTerminalSettingsChanged="vs-code-terminal-settings-changed",s.vsCodeTerminalWaitTimeout="vs-code-terminal-wait-timeout",s.vsCodeTerminalErrorLoadingSettings="vs-code-terminal-error-loading-settings",s.vsCodeTerminalErrorCheckingForShellUpdates="vs-code-terminal-error-checking-for-shell-updates",s.vsCodeTerminalErrorCleaningUpTempDir="vs-code-terminal-error-cleaning-up-temp-dir",s.vsCodeTerminalErrorInitializingShells="vs-code-terminal-error-initializing-shells",s.vsCodeTerminalErrorCheckingShellCapability="vs-code-terminal-error-checking-shell-capability",s.vsCodeTerminalErrorCreatingZshEnvironment="vs-code-terminal-error-creating-zsh-environment",s.chatHistoryTruncated="chat-history-truncated",s.enhancedPrompt="enhanced-prompt",s))(Fa||{}),zc=(s=>(s.sentUserMessage="sent-user-message",s))(zc||{}),Lt=(s=>(s.memoriesRequestId="memoriesRequestId",s.exceptionThrown="exceptionThrown",s.start="start",s.end="end",s.noPendingUserMessage="noPendingUserMessage",s.startSendSilentExchange="startSendSilentExchange",s.sendSilentExchangeRequestId="sendSilentExchangeRequestId",s.sendSilentExchangeResponseStats="sendSilentExchangeResponseStats",s.noRequestId="noRequestId",s.conversationChanged="conversationChanged",s.explanationStats="explanationStats",s.contentStats="contentStats",s.invalidResponse="invalidResponse",s.worthRemembering="worthRemembering",s.lastUserExchangeRequestId="lastUserExchangeRequestId",s.noLastUserExchangeRequestId="noLastUserExchangeRequestId",s))(Lt||{});class Ra extends Hc{constructor(){super()}static create(){return new Ra}}var Gc=(s=>(s[s.unset=0]="unset",s[s.positive=1]="positive",s[s.negative=2]="negative",s))(Gc||{}),Qe=(s=>(s[s.unknown=0]="unknown",s[s.new=1]="new",s[s.checkingSafety=2]="checkingSafety",s[s.runnable=3]="runnable",s[s.running=4]="running",s[s.completed=5]="completed",s[s.error=6]="error",s[s.cancelling=7]="cancelling",s[s.cancelled=8]="cancelled",s))(Qe||{});function fa(s){return s.requestId+";"+s.toolUseId}function yc(s){const[n,i]=s.split(";");return{requestId:n,toolUseId:i}}function gg(s,n){return s==null?n:typeof s=="string"?s:n}const pg=async(s,n)=>{if(!Kn(s)||n.chatItemType!==void 0||!(n!=null&&n.request_message))return;const i=Ra.create();i.setFlag(Lt.start);try{await yf(s,n,i)}catch(o){i.setFlag(Lt.exceptionThrown),console.error("Failed to classify and distill memories",o)}finally{i.setFlag(Lt.end),s.extensionClient.reportAgentSessionEvent({eventName:Fa.classifyAndDistill,conversationId:s.id,eventData:{classifyAndDistillData:i}})}},yf=async(s,n,i)=>{const o=crypto.randomUUID();i.setRequestId(Lt.memoriesRequestId,o);const l=xr(s).id;i.setFlag(Lt.startSendSilentExchange);const{responseText:f,requestId:_}=await s.sendSilentExchange({request_message:n.request_message,disableRetrieval:!0,disableHistory:!1,disableSelectedCodeDetails:!0,memoriesInfo:{isClassifyAndDistill:!0}});if(i.setStringStats(Lt.sendSilentExchangeResponseStats,f),_?i.setRequestId(Lt.sendSilentExchangeRequestId,_):i.setFlag(Lt.noRequestId),xr(s).id!==l)return void i.setFlag(Lt.conversationChanged);let b;try{b=JSON.parse(f)}catch{throw i.setFlag(Lt.invalidResponse),new Error("Invalid response from classify and distill")}if(typeof b.explanation!="string"||typeof b.content!="string"||typeof b.worthRemembering!="boolean")throw i.setFlag(Lt.invalidResponse),new Error("Invalid response from classify and distill");i.setStringStats(Lt.explanationStats,b.explanation),i.setStringStats(Lt.contentStats,b.content),i.setFlag(Lt.worthRemembering,b.worthRemembering);const S=b.worthRemembering?b.content:void 0;S&&Sf(s,S,o,i)},_g=s=>{var o;const n=s.chatHistory.at(-1);if(!n||!de(n))return Tn.notRunning;if(!(n.status===ut.success||n.status===ut.failed||n.status===ut.cancelled))return Tn.running;const i=(((o=n.structured_output_nodes)==null?void 0:o.filter(l=>l.type===ee.TOOL_USE&&!!l.tool_use))??[]).at(-1);if(!i)return Tn.notRunning;switch(s.getToolUseState(n.request_id,i.tool_use.tool_use_id).phase){case Qe.runnable:return Tn.awaitingUserAction;case Qe.cancelled:return Tn.notRunning;default:return Tn.running}},ba=s=>de(s)&&!!s.request_message,Ls=s=>s.chatHistory.findLast(n=>ba(n)),mg=s=>{const n=Ls(s);if(n!=null&&n.structured_output_nodes){const i=n.structured_output_nodes.find(o=>o.type===ee.AGENT_MEMORY);if(i)try{const{memoriesRequestId:o,memory:l}=JSON.parse(i.content);return{memoriesRequestId:o,memory:l}}catch(o){return void console.error("Failed to parse JSON from agent memory node",o)}}},vg=s=>bf(s,n=>{var i;return!!((i=n.structured_output_nodes)!=null&&i.some(o=>{var l;return o.type===ee.TOOL_USE&&((l=o.tool_use)==null?void 0:l.tool_name)==="remember"}))}).length>0,bf=(s,n)=>{const i=Ls(s);return i!=null&&i.request_id?s.historyFrom(i.request_id,!0).filter(o=>de(o)&&(!n||n(o))):[]},yg=s=>{var o;const n=s.chatHistory.at(-1);if(!(n!=null&&n.request_id)||!de(n))return!1;const i=((o=n.structured_output_nodes)==null?void 0:o.filter(l=>l.type===ee.TOOL_USE))??[];for(const l of i)if(l.tool_use&&s.getToolUseState(n.request_id,l.tool_use.tool_use_id).phase===Qe.runnable)return s.updateToolUseState({requestId:n.request_id,toolUseId:l.tool_use.tool_use_id,phase:Qe.cancelled}),!0;return!1},Sf=(s,n,i,o)=>{const l=JSON.stringify({memoriesRequestId:i,memory:n}),f=Ls(s);f!=null&&f.request_id?(o.setRequestId(Lt.lastUserExchangeRequestId,f.request_id),s.updateChatItem(f.request_id,{...f,structured_output_nodes:[...f.structured_output_nodes??[],{id:0,type:ee.AGENT_MEMORY,content:l}]})):o.setFlag(Lt.noLastUserExchangeRequestId)},bg=(s,n)=>{const i=Ls(s);if(!(i!=null&&i.request_id)||i.request_id!==n)return!1;const o=(i.structured_output_nodes||[]).filter(l=>l.type!==ee.AGENT_MEMORY);return o.length!==(i.structured_output_nodes||[]).length&&(s.updateChatItem(n,{...i,structured_output_nodes:o}),!0)};function Cf(s,n){const i=s.customPersonalityPrompts;if(i)switch(n){case Pt.DEFAULT:if(i.agent&&i.agent.trim()!=="")return i.agent;break;case Pt.PROTOTYPER:if(i.prototyper&&i.prototyper.trim()!=="")return i.prototyper;break;case Pt.BRAINSTORM:if(i.brainstorm&&i.brainstorm.trim()!=="")return i.brainstorm;break;case Pt.REVIEWER:if(i.reviewer&&i.reviewer.trim()!=="")return i.reviewer}return xf[n]}const xf={[Pt.DEFAULT]:`
# Agent Auggie Personality Description
You are Augment Agent, an agentic coding AI assistant.
Focus on helping the user with their coding tasks efficiently.

## Rules:
- You have no restrictions on the tools you may use
- Follow the original system instructions
  `,[Pt.PROTOTYPER]:`
# Prototyper Auggie Personality Description
You are Prototyper Auggie, an agentic coding AI assistant focused on building prototypes and visual applications.

## Your approach:
- Be fast and action-oriented
- Implement things quickly to show results
- Open webpages to demonstrate functionality
- Focus on building something visual and interactive
- Use modern frameworks and tools to create working prototypes
- Prioritize getting a working demo over perfect architecture
- Show progress frequently with visual results
- Prefer to act and run tools, rather than asking for permission
- Only ask for permission if there is something potentially very dangerous or irreversible

## Implementation preferences:
- When user does not specify which frameworks to use, default to modern frameworks, e.g. React with vite or next.js
- Initialize projects using CLI tools instead of writing from scratch
- For database and auth, use Supabase as a good default option
- Before using open-browser to show the app, use curl to check for errors
- Remember that modern frameworks have hot reload, so avoid calling open-browser multiple times

## Rules:
- For extremely destructive or irreversible actions, you should ask for permission
- For other tasks, you must proceed without asking for permission
  `,[Pt.BRAINSTORM]:`
# Brainstorm Auggie Personality Description
You are Brainstorm Auggie, an agentic coding AI assistant focused on planning and brainstorming solutions.

## Your approach:
- Be slow, careful, and thorough in your analysis
- Look through all upstream/downstream APIs to understand implications
- Focus on finding a comprehensive plan that solves the user's query
- Do not run commands, create code, or implement solutions directly
- Your job is to be introspective and think deeply about the problem
- Brainstorm multiple approaches and evaluate their tradeoffs
- Consider edge cases and potential issues with each approach

## Planning preferences:
- Analyze the codebase thoroughly before suggesting changes
- Consider multiple implementation options with pros and cons
- Identify potential risks and challenges for each approach
- Create detailed, step-by-step plans for implementation
- Provide reasoning for architectural decisions
- Consider performance, maintainability, and scalability
- Do not execute the plan - your role is to provide guidance only

## Rules:
- Prefer information gathering and non-destructive tools
- Prefer non-destructive and non-modifying tools
- You must never execute code, modify the codebase, or make changes
- Consider using Mermaid diagrams to help visualize complex concepts
- Once you have a proposal, please examine it critically, and do a revision before finalizing
  `,[Pt.REVIEWER]:`
# Reviewer Auggie Personality Description
You are Reviewer Auggie, an agentic coding AI assistant focused on reviewing code changes and identifying potential issues.

## Your approach:
- Act like a code detective to find potential bugs and issues
- Use git commands to analyze changes against the merge base
- Be super inquisitive and look for anything suspicious
- Build a mental model of what is happening in the code change
- Analyze API implications and downstream effects
- Guard the codebase from potential negative side effects
- Focus on understanding the changes from first principles

## Review preferences:
- Use git and GitHub tools to get code history information
- Compare changes against the logical base or merge base
- Look for edge cases and potential bugs
- Analyze API contracts and potential breaking changes
- Consider performance implications
- Check for security vulnerabilities
- Verify test coverage for the changes

## Rules:
- Use git commands and GitHub API to analyze code changes
- Be thorough and methodical in your analysis
- Focus on finding potential issues rather than implementing solutions
- Provide constructive feedback with specific examples
- Consider both the technical implementation and the broader impact
  `};function wf(s,n,i=1e3){let o=null,l=0;const f=Rn(n),_=()=>{const b=(()=>{const S=Date.now();if(o!==null&&S-l<i)return o;const A=s();return o=A,l=S,A})();f.set(b)};return{subscribe:f.subscribe,resetCache:()=>{o=null,_()},updateStore:_}}class xt{constructor(n,i,o,l){d(this,"_state");d(this,"_subscribers",new Set);d(this,"_focusModel",new pf);d(this,"_onSendExchangeListeners",[]);d(this,"_onNewConversationListeners",[]);d(this,"_onHistoryDeleteListeners",[]);d(this,"_onBeforeChangeConversationListeners",[]);d(this,"_truncatedChatHistory",new Tf(8e5,26e4,3));d(this,"_totalCharactersCacheThrottleMs",1e3);d(this,"_totalCharactersStore");d(this,"subscribe",n=>(this._subscribers.add(n),n(this),()=>{this._subscribers.delete(n)}));d(this,"setConversation",(n,i=!0,o=!0)=>{const l=n.id!==this._state.id;l&&o&&(n.toolUseStates=Object.fromEntries(Object.entries(n.toolUseStates??{}).map(([_,b])=>{if(b.requestId&&b.toolUseId){const{requestId:S,toolUseId:A}=yc(_);return S===b.requestId&&A===b.toolUseId||console.warn("Tool use state key does not match request and tool use IDs. Got key ",_,"but object has ",fa(b)),[_,b]}return[_,{...b,...yc(_)}]})),(n=this._notifyBeforeChangeConversation(this._state,n)).lastInteractedAtIso=new Date().toISOString()),i&&l&&this.isValid&&(this.saveDraftActiveContextIds(),this._unloadContextFromConversation(this._state));const f=xt.isEmpty(n);if(l&&f){const _=this._state.draftExchange;_&&(n.draftExchange=_)}return this._state=n,this._focusModel.setItems(this._state.chatHistory.filter(de)),this._focusModel.initFocusIdx(-1),this._subscribers.forEach(_=>_(this)),this._saveConversation(this._state),l&&(this._loadContextFromConversation(n),this.loadDraftActiveContextIds(),this._onNewConversationListeners.forEach(_=>_())),!0});d(this,"update",n=>{this.setConversation({...this._state,...n}),this._totalCharactersStore.updateStore()});d(this,"toggleIsPinned",()=>{this.update({isPinned:!this.isPinned})});d(this,"setName",n=>{this.update({name:n})});d(this,"setSelectedModelId",n=>{this.update({selectedModelId:n})});d(this,"updateFeedback",(n,i)=>{this.update({feedbackStates:{...this._state.feedbackStates,[n]:i}})});d(this,"updateToolUseState",n=>{this.update({toolUseStates:{...this._state.toolUseStates,[fa(n)]:n}})});d(this,"getToolUseState",(n,i)=>n===void 0||i===void 0||this.toolUseStates===void 0?{phase:Qe.unknown,requestId:n??"",toolUseId:i??""}:this.toolUseStates[fa({requestId:n,toolUseId:i})]||{phase:Qe.new});d(this,"getLastToolUseState",()=>{var o,l;const n=this.lastExchange;if(!n)return{phase:Qe.unknown};const i=(((o=n==null?void 0:n.structured_output_nodes)==null?void 0:o.filter(f=>f.type===ee.TOOL_USE))??[]).at(-1);return i?this.getToolUseState(n.request_id,(l=i.tool_use)==null?void 0:l.tool_use_id):{phase:Qe.unknown}});d(this,"addExchange",n=>{const i=[...this._state.chatHistory,n];let o;de(n)&&(o=n.request_id?{...this._state.feedbackStates,[n.request_id]:{selectedRating:Gc.unset,feedbackNote:""}}:void 0),this.update({chatHistory:i,...o?{feedbackStates:o}:{},lastUrl:void 0})});d(this,"resetShareUrl",()=>{this.update({lastUrl:void 0})});d(this,"updateExchangeById",(n,i,o=!1)=>{var b;const l=this.exchangeWithRequestId(i);if(l===null)return console.warn("No exchange with this request ID found."),!1;o&&n.response_text!==void 0&&(n.response_text=(l.response_text??"")+(n.response_text??"")),o&&(n.structured_output_nodes=[...l.structured_output_nodes??[],...n.structured_output_nodes??[]]),o&&n.workspace_file_chunks!==void 0&&(n.workspace_file_chunks=[...l.workspace_file_chunks??[],...n.workspace_file_chunks??[]]);const f=(b=(n.structured_output_nodes||[]).find(S=>S.type===ee.MAIN_TEXT_FINISHED))==null?void 0:b.content;f&&f!==n.response_text&&(n.response_text=f);let _=this._state.isShareable||Jn({...l,...n});return this.update({chatHistory:this.chatHistory.map(S=>S.request_id===i?{...S,...n}:S),isShareable:_}),!0});d(this,"clearMessagesFromHistory",n=>{this.update({chatHistory:this.chatHistory.filter(i=>!i.request_id||!n.has(i.request_id))}),this._extensionClient.clearMetadataFor({requestIds:Array.from(n)})});d(this,"clearHistory",()=>{this._extensionClient.clearMetadataFor({requestIds:this.requestIds}),this.update({chatHistory:[]})});d(this,"clearHistoryFrom",async(n,i=!0)=>{const o=this.historyFrom(n,i),l=o.map(f=>f.request_id).filter(f=>f!==void 0);this.update({chatHistory:this.historyTo(n,!i)}),this._extensionClient.clearMetadataFor({requestIds:l}),o.forEach(f=>{this._onHistoryDeleteListeners.forEach(_=>_(f))})});d(this,"clearMessageFromHistory",n=>{this.update({chatHistory:this.chatHistory.filter(i=>i.request_id!==n)}),this._extensionClient.clearMetadataFor({requestIds:[n]})});d(this,"historyTo",(n,i=!1)=>{const o=this.chatHistory.findIndex(l=>l.request_id===n);return o===-1?[]:this.chatHistory.slice(0,i?o+1:o)});d(this,"historyFrom",(n,i=!0)=>{const o=this.chatHistory.findIndex(l=>l.request_id===n);return o===-1?[]:this.chatHistory.slice(i?o:o+1)});d(this,"resendLastExchange",async()=>{const n=this.lastExchange;if(n&&!this.awaitingReply)return this.resendTurn(n)});d(this,"resendTurn",n=>this.awaitingReply?Promise.resolve():(this._removeTurn(n),this.sendExchange({request_message:n.request_message,rich_text_json_repr:n.rich_text_json_repr,status:ut.draft,mentioned_items:n.mentioned_items,structured_request_nodes:n.structured_request_nodes})));d(this,"_removeTurn",n=>{this.update({chatHistory:this.chatHistory.filter(i=>i!==n&&(!n.request_id||i.request_id!==n.request_id))})});d(this,"exchangeWithRequestId",n=>this.chatHistory.find(i=>i.request_id===n)||null);d(this,"resetTotalCharactersCache",()=>{this._totalCharactersStore.resetCache()});d(this,"markSeen",async n=>{if(!n.request_id||!this.chatHistory.find(o=>o.request_id===n.request_id))return;const i={seen_state:Wt.seen};this.update({chatHistory:this.chatHistory.map(o=>o.request_id===n.request_id?{...o,...i}:o)})});d(this,"createStructuredRequestNodes",n=>this._jsonToStructuredRequest(n));d(this,"saveDraftMentions",n=>{if(!this.draftExchange)return;const i=n.filter(o=>!o.personality);this.update({draftExchange:{...this.draftExchange,mentioned_items:i}})});d(this,"saveDraftActiveContextIds",()=>{const n=this._specialContextInputModel.recentActiveItems.map(i=>i.id);this.update({draftActiveContextIds:n})});d(this,"loadDraftActiveContextIds",()=>{const n=new Set(this.draftActiveContextIds??[]),i=this._specialContextInputModel.recentItems.filter(l=>n.has(l.id)||l.recentFile||l.selection||l.sourceFolder),o=this._specialContextInputModel.recentItems.filter(l=>!(n.has(l.id)||l.recentFile||l.selection||l.sourceFolder));this._specialContextInputModel.markItemsActive(i.reverse()),this._specialContextInputModel.markItemsInactive(o.reverse())});d(this,"saveDraftExchange",(n,i)=>{var _,b,S;const o=n!==((_=this.draftExchange)==null?void 0:_.request_message),l=i!==((b=this.draftExchange)==null?void 0:b.rich_text_json_repr);if(!o&&!l)return;const f=(S=this.draftExchange)==null?void 0:S.mentioned_items;this.update({draftExchange:{request_message:n,rich_text_json_repr:i,mentioned_items:f,status:ut.draft}})});d(this,"clearDraftExchange",()=>{const n=this.draftExchange;return this.update({draftExchange:void 0}),n});d(this,"sendDraftExchange",()=>{if(this._extensionClient.triggerUsedChatMetric(),!this.canSendDraft||!this.draftExchange)return!1;const n=this.clearDraftExchange();if(!n)return!1;const i=this._chatFlagModel.enableChatMultimodal&&n.rich_text_json_repr?this._jsonToStructuredRequest(n.rich_text_json_repr):void 0;return this.sendExchange({...n,structured_request_nodes:i,model_id:this.selectedModelId??void 0}).then(()=>{var _,b;const o=!this.name&&this.chatHistory.length===1&&((_=this.firstExchange)==null?void 0:_.request_id)===this.chatHistory[0].request_id,l=Kn(this)&&((b=this._state.extraData)==null?void 0:b.hasAgentOnboarded)&&(f=this.chatHistory,f.filter(S=>ba(S))).length===2;var f;this._chatFlagModel.summaryTitles&&(o||l)&&this.updateConversationTitle()}).finally(()=>{var o;Kn(this)&&this._extensionClient.reportAgentRequestEvent({eventName:zc.sentUserMessage,conversationId:this.id,requestId:((o=this.lastExchange)==null?void 0:o.request_id)??"UNKNOWN_REQUEST_ID",chatHistoryLength:this.chatHistory.length})}),this.focusModel.setFocusIdx(void 0),!0});d(this,"cancelMessage",async()=>{var n;this.canCancelMessage&&((n=this.lastExchange)!=null&&n.request_id)&&(this.updateExchangeById({status:ut.cancelled},this.lastExchange.request_id),await this._extensionClient.cancelChatStream(this.lastExchange.request_id))});d(this,"sendInstructionExchange",async(n,i)=>{let o=`temp-fe-${crypto.randomUUID()}`;const l={status:ut.sent,request_id:o,request_message:n,model_id:this.selectedModelId??void 0,structured_output_nodes:[],seen_state:Wt.unseen,timestamp:new Date().toISOString()};this.addExchange(l);for await(const f of this._extensionClient.sendInstructionMessage(l,i)){if(!this.updateExchangeById(f,o,!0))return;o=f.request_id||o}});d(this,"updateConversationTitle",async()=>{const{responseText:n}=await this.sendSummaryExchange();this.update({name:n})});d(this,"sendSummaryExchange",()=>{const n={status:ut.sent,request_message:"Please provide a clear and concise summary of our conversation so far. The summary must be less than 6 words long. The summary must contain the key points of the conversation. The summary must be in the form of a title which will represent the conversation. The response should not include any additional formatting such as wrapping the response with quotation marks.",model_id:this.selectedModelId??void 0,chatItemType:Yn.summaryTitle,disableRetrieval:!0};return this.sendSilentExchange(n)});d(this,"generateCommitMessage",async()=>{let n=`temp-fe-${crypto.randomUUID()}`;const i={status:ut.sent,request_id:n,request_message:"Please generate a commit message based on the diff of my staged and unstaged changes.",model_id:this.selectedModelId??void 0,mentioned_items:[],seen_state:Wt.unseen,chatItemType:Yn.generateCommitMessage,disableSelectedCodeDetails:!0,disableHistory:!0,timestamp:new Date().toISOString()};this.addExchange(i);for await(const o of this._extensionClient.generateCommitMessage()){if(!this.updateExchangeById(o,n,!0))return;n=o.request_id||n}});d(this,"sendExchange",async n=>{var f;this.updateLastInteraction();let i=`temp-fe-${crypto.randomUUID()}`,o=this._chatFlagModel.isModelIdValid(n.model_id)?n.model_id:void 0;n=await this._addIdeStateNode(bc(n));const l={status:ut.sent,request_id:i,request_message:n.request_message,rich_text_json_repr:n.rich_text_json_repr,model_id:o,mentioned_items:n.mentioned_items,structured_output_nodes:n.structured_output_nodes,seen_state:Wt.unseen,chatItemType:n.chatItemType,disableSelectedCodeDetails:n.disableSelectedCodeDetails,disableHistory:n.disableHistory,structured_request_nodes:n.structured_request_nodes,timestamp:new Date().toISOString()};this.addExchange(l),this._loadContextFromExchange(l),this._onSendExchangeListeners.forEach(_=>_(l));for await(const _ of this.sendUserMessage(i,l)){if(((f=this.exchangeWithRequestId(i))==null?void 0:f.status)!==ut.sent||!this.updateExchangeById(_,i,!0))return;i=_.request_id||i}});d(this,"sendSuggestedQuestion",n=>{this.sendExchange({request_message:n,status:ut.draft}),this._extensionClient.triggerUsedChatMetric(),this._extensionClient.reportWebviewClientEvent(Dc.chatUseSuggestedQuestion)});d(this,"recoverAllExchanges",async()=>{await Promise.all(this.recoverableExchanges.map(this.recoverExchange))});d(this,"recoverExchange",async n=>{if(!n.request_id||n.status!==ut.sent)return;let i=n.request_id;this.updateExchangeById({...n,response_text:""},i);for await(const o of this.getChatStream(n)){if(!this.updateExchangeById(o,i,!0))return;i=o.request_id||i}});d(this,"_loadContextFromConversation",n=>{n.chatHistory.forEach(i=>{de(i)&&this._loadContextFromExchange(i)})});d(this,"_loadContextFromExchange",n=>{n.mentioned_items&&(this._specialContextInputModel.updateItems(n.mentioned_items,[]),this._specialContextInputModel.markItemsActive(n.mentioned_items))});d(this,"_unloadContextFromConversation",n=>{n.chatHistory.forEach(i=>{de(i)&&this._unloadContextFromExchange(i)})});d(this,"_unloadContextFromExchange",n=>{n.mentioned_items&&this._specialContextInputModel.updateItems([],n.mentioned_items)});d(this,"updateLastInteraction",()=>{this.update({lastInteractedAtIso:new Date().toISOString()})});d(this,"_jsonToStructuredRequest",n=>{const i=[],o=f=>{var b;const _=i.at(-1);if((_==null?void 0:_.type)===te.TEXT){const S=((b=_.text_node)==null?void 0:b.content)??"",A={..._,text_node:{content:S+f}};i[i.length-1]=A}else i.push({id:i.length,type:te.TEXT,text_node:{content:f}})},l=f=>{var _,b,S,A;if(f.type==="doc"||f.type==="paragraph")for(const q of f.content??[])l(q);else if(f.type==="hardBreak")o(`
`);else if(f.type==="text")o(f.text??"");else if(f.type==="image"){if(typeof((_=f.attrs)==null?void 0:_.src)!="string")return void console.error("Image source is not a string: ",(b=f.attrs)==null?void 0:b.src);if(f.attrs.isLoading)return;const q=(S=f.attrs)==null?void 0:S.title,D=this._fileNameToImageFormat(q);i.push({id:i.length,type:te.IMAGE_ID,image_id_node:{image_id:f.attrs.src,format:D}})}else if(f.type==="mention"){const q=(A=f.attrs)==null?void 0:A.data;q&&Aa(q)?i.push({id:i.length,type:te.TEXT,text_node:{content:Cf(this._chatFlagModel,q.personality.type)}}):o(`@${q==null?void 0:q.name}`)}};return l(n),i});this._extensionClient=n,this._chatFlagModel=i,this._specialContextInputModel=o,this._saveConversation=l,this._state={...xt.create()},this._totalCharactersStore=this._createTotalCharactersStore()}_createTotalCharactersStore(){return wf(()=>{let n=0;const i=this._state.chatHistory;return this._convertHistoryToExchanges(i).forEach(o=>{n+=JSON.stringify(o).length}),this._state.draftExchange&&(n+=JSON.stringify(this._state.draftExchange).length),n},0,this._totalCharactersCacheThrottleMs)}async decidePersonaType(){var n;try{return(((n=(await this._extensionClient.getWorkspaceInfo()).trackedFileCount)==null?void 0:n.reduce((o,l)=>o+l,0))||0)<=4?Pt.PROTOTYPER:Pt.DEFAULT}catch(i){return console.error("Error determining persona type:",i),Pt.DEFAULT}}static create(n={}){const i=new Date().toISOString();return{id:crypto.randomUUID(),name:void 0,createdAtIso:i,lastInteractedAtIso:i,chatHistory:[],feedbackStates:{},toolUseStates:{},draftExchange:void 0,draftActiveContextIds:void 0,selectedModelId:void 0,requestIds:[],isPinned:!1,lastUrl:void 0,isShareable:!1,extraData:{},personaType:Pt.DEFAULT,...n}}static toSentenceCase(n){return n.charAt(0).toUpperCase()+n.slice(1)}static getDisplayName(n){var l;const i=this._filterToExchanges(n);let o;return o=df(n)?"Autofix Chat":Kn(n)?"New Agent":"New Chat",xt.toSentenceCase(n.name||((l=i[0])==null?void 0:l.request_message)||o)}static _filterToExchanges(n){return n.chatHistory.filter(i=>de(i))}static isEmpty(n){var i;return n.chatHistory.filter(o=>de(o)).length===0&&!((i=n.draftExchange)!=null&&i.request_message)}static isNamed(n){return n.name!==void 0&&n.name!==""}static getTime(n,i){return i==="lastMessageTimestamp"?xt.lastMessageTimestamp(n):i==="lastInteractedAt"?xt.lastInteractedAt(n):xt.createdAt(n)}static createdAt(n){return new Date(n.createdAtIso)}static lastInteractedAt(n){return new Date(n.lastInteractedAtIso)}static lastMessageTimestamp(n){const i=this._filterToExchanges(n);if(i.length===0)return this.createdAt(n);const o=i[i.length-1];return o.timestamp?new Date(o.timestamp):this.createdAt(n)}static isValid(n){return n.id!==void 0&&(!xt.isEmpty(n)||xt.isNamed(n))}onBeforeChangeConversation(n){return this._onBeforeChangeConversationListeners.push(n),()=>{this._onBeforeChangeConversationListeners=this._onBeforeChangeConversationListeners.filter(i=>i!==n)}}_notifyBeforeChangeConversation(n,i){let o=i;for(const l of this._onBeforeChangeConversationListeners){const f=l(n,o);f!==void 0&&(o=f)}return o}get extraData(){return this._state.extraData}set extraData(n){this.update({extraData:n})}get focusModel(){return this._focusModel}get isValid(){return xt.isValid(this._state)}get id(){return this._state.id}get name(){return this._state.name}get personaType(){return this._state.personaType??Pt.DEFAULT}get displayName(){return xt.getDisplayName(this._state)}get createdAtIso(){return this._state.createdAtIso}get createdAt(){return xt.createdAt(this._state)}get chatHistory(){return this._state.chatHistory}get feedbackStates(){return this._state.feedbackStates}get toolUseStates(){return this._state.toolUseStates}get draftExchange(){return this._state.draftExchange}get selectedModelId(){return this._state.selectedModelId}get isPinned(){return!!this._state.isPinned}get extensionClient(){return this._extensionClient}addChatItem(n){this.addExchange(n)}get requestIds(){return this._state.chatHistory.map(n=>n.request_id).filter(n=>n!==void 0)}get hasDraft(){var o;const n=(((o=this.draftExchange)==null?void 0:o.request_message)??"").trim()!=="",i=this.hasImagesInDraft();return n||i}hasImagesInDraft(){var o;const n=(o=this.draftExchange)==null?void 0:o.rich_text_json_repr;if(!n)return!1;const i=l=>Array.isArray(l)?l.some(i):!!l&&(l.type==="image"||!(!l.content||!Array.isArray(l.content))&&l.content.some(i));return i(n)}get canSendDraft(){return this.hasDraft&&!this.awaitingReply}get canCancelMessage(){return this.awaitingReply}get firstExchange(){const n=xt._filterToExchanges(this);return n.length===0?null:n[0]}get lastExchange(){const n=xt._filterToExchanges(this);return n.length===0?null:n[n.length-1]}get canClearHistory(){return this._state.chatHistory.length!==0&&!this.awaitingReply}get recoverableExchanges(){return this._state.chatHistory.filter(n=>de(n)&&n.status===ut.sent)}get successfulMessages(){return this._state.chatHistory.filter(n=>Jn(n)||wr(n))}get totalCharactersStore(){return this._totalCharactersStore}_convertHistoryToExchanges(n){if(n.length===0)return[];const i=[];for(const o of n)if(Jn(o))i.push(Ef(o));else if(wr(o)&&o.fromTimestamp!==void 0&&o.toTimestamp!==void 0&&o.revertTarget){const l=If(o),f={request_message:"",response_text:"",request_id:o.request_id||crypto.randomUUID(),request_nodes:[l],response_nodes:[]};i.push(f)}return i}get awaitingReply(){return this.lastExchange!==null&&this.lastExchange.status===ut.sent}get lastInteractedAtIso(){return this._state.lastInteractedAtIso}get draftActiveContextIds(){return this._state.draftActiveContextIds}async sendSilentExchange(n){const i=crypto.randomUUID();let o,l="";const f=await this._addIdeStateNode(bc({...n,request_id:i,status:ut.sent,timestamp:new Date().toISOString()}));for await(const _ of this.sendUserMessage(i,f))_.response_text&&(l+=_.response_text),_.request_id&&(o=_.request_id);return{responseText:l,requestId:o}}async*getChatStream(n){n.request_id&&(yield*this._extensionClient.getExistingChatStream(n,{flags:this._chatFlagModel}))}async*sendUserMessage(n,i){var A;const o=this._specialContextInputModel.chatActiveContext;let l=this.successfulMessages;if(i.chatItemType===Yn.summaryTitle){const q=l.findIndex(D=>D.chatItemType!==Yn.agentOnboarding&&ba(D));q!==-1&&(l=l.slice(q))}const f=i.disableHistory===!0?[]:l;let _=this._convertHistoryToExchanges(f);this._chatFlagModel.truncateChatHistory&&(_=this._truncatedChatHistory.getTruncatedChatHistory(_,()=>this._extensionClient.reportAgentSessionEvent({eventName:Fa.chatHistoryTruncated,conversationId:this.id})));let b=this.personaType;if(i.structured_request_nodes){const q=i.structured_request_nodes.find(D=>D.type===te.CHANGE_PERSONALITY);q&&q.change_personality_node&&(b=q.change_personality_node.personality_type)}const S={text:i.request_message,chatHistory:_,modelId:i.model_id,context:o,userSpecifiedFiles:o.userSpecifiedFiles,externalSourceIds:(A=o.externalSources)==null?void 0:A.map(q=>q.id),disableRetrieval:i.disableRetrieval??!1,disableSelectedCodeDetails:i.disableSelectedCodeDetails??!1,nodes:i.structured_request_nodes,memoriesInfo:i.memoriesInfo,personaType:b};yield*this._extensionClient.startChatStreamWithRetry(n,S,{flags:this._chatFlagModel})}onSendExchange(n){return this._onSendExchangeListeners.push(n),()=>{this._onSendExchangeListeners=this._onSendExchangeListeners.filter(i=>i!==n)}}onNewConversation(n){return this._onNewConversationListeners.push(n),()=>{this._onNewConversationListeners=this._onNewConversationListeners.filter(i=>i!==n)}}onHistoryDelete(n){return this._onHistoryDeleteListeners.push(n),()=>{this._onHistoryDeleteListeners=this._onHistoryDeleteListeners.filter(i=>i!==n)}}updateChatItem(n,i){return this.chatHistory.find(o=>o.request_id===n)===null?(console.warn("No exchange with this request ID found."),!1):(this.update({chatHistory:this.chatHistory.map(o=>o.request_id===n?{...o,...i}:o)}),!0)}_fileNameToImageFormat(n){var o;switch((o=n.split(".").at(-1))==null?void 0:o.toLowerCase()){case"jpeg":case"jpg":return Zn.JPEG;case"png":return Zn.PNG;case"gif":return Zn.GIF;case"webp":return Zn.WEBP;default:return Zn.IMAGE_FORMAT_UNSPECIFIED}}async _addIdeStateNode(n){let i=(n.structured_request_nodes??[]).filter(l=>l.type!==te.IDE_STATE);const o=await this._extensionClient.getChatRequestIdeState();return o?(i=[...i,{id:Wc(i)+1,type:te.IDE_STATE,ide_state_node:o}],{...n,structured_request_nodes:i}):n}}function If(s){const n=(wr(s),s.fromTimestamp),i=(wr(s),s.toTimestamp),o=wr(s)&&s.revertTarget!==void 0;return{id:Date.now(),type:te.CHECKPOINT_REF,checkpoint_ref_node:{request_id:s.request_id||"",from_timestamp:n,to_timestamp:i,source:o?kc.CHECKPOINT_REVERT:void 0}}}function Ef(s){const n=(s.structured_output_nodes??[]).filter(i=>i.type===ee.RAW_RESPONSE||i.type===ee.TOOL_USE);return{request_message:s.request_message,response_text:s.response_text??"",request_id:s.request_id||"",request_nodes:s.structured_request_nodes??[],response_nodes:n}}function Wc(s){return s.length>0?Math.max(...s.map(n=>n.id)):0}function bc(s){var n;if(s.request_message.length>0&&!((n=s.structured_request_nodes)!=null&&n.some(i=>i.type===te.TEXT))){let i=s.structured_request_nodes??[];return i=[...i,{id:Wc(i)+1,type:te.TEXT,text_node:{content:s.request_message}}],{...s,structured_request_nodes:i}}return s}class Tf{constructor(n,i,o){d(this,"_cachedTruncatedHistory",[]);d(this,"_cachedTruncatedChars",[]);d(this,"_cachedUntruncatedChars",new Map);this._maxHistoryChars=n,this._truncateToChars=i,this._avoidTruncationExchangeCount=o}getTruncatedChatHistory(n,i){const o=[];n.length<this._cachedTruncatedHistory.length&&(this._cachedTruncatedHistory.splice(n.length),this._cachedTruncatedChars.splice(n.length));for(let S=0;S<this._cachedTruncatedHistory.length;S++){const A=n[S],q=this._cachedTruncatedHistory[S];if(A.request_id!==q.request_id){this._cachedTruncatedHistory.splice(S),this._cachedTruncatedChars.splice(S);break}}const l=this._cachedTruncatedHistory.length;o.push(...this._cachedTruncatedHistory);let f=this._cachedTruncatedChars.reduce((S,A)=>S+A,0);const _=n.slice(l).map(S=>this._getUntruncatedChars(S)).reduce((S,A)=>S+A,0);if(f+_<this._maxHistoryChars)return o.push(...n.slice(l)),o;i==null||i();let b=f+_-this._truncateToChars;for(let S=l;S<n.length-this._avoidTruncationExchangeCount;S++){const A=this._truncateExchange(n[S]),q=JSON.stringify(A).length;if(this._cachedTruncatedHistory.push(A),this._cachedTruncatedChars.push(q),o.push(A),f+=q,b-=this._getUntruncatedChars(n[S])-q,b<=0)break}return o.push(...n.slice(o.length)),o}_truncateExchange(n){var f,_;const i=(f=n.request_nodes)==null?void 0:f.map(b=>b.type===te.TOOL_RESULT?{...b,tool_result_node:{...b.tool_result_node,content:"[Tool result truncated...]"}}:b),o=(_=n.response_nodes)==null?void 0:_.map(b=>b.type===ee.TOOL_USE?{...b,tool_use:b.tool_use&&this._truncateToolUse(b.tool_use)}:b),l={...n,request_nodes:i,response_nodes:o};return JSON.stringify(l).length>JSON.stringify(n).length?n:l}_truncateToolUse(n){let i;try{i=JSON.parse(n.input_json)}catch{return{...n,input_json:JSON.stringify({message:"[Tool use truncated...]"})}}for(const o of Object.keys(i))i[o].length>14&&(i[o]="[Truncated...]");return{...n,input_json:JSON.stringify(i)}}_getUntruncatedChars(n){if(this._cachedUntruncatedChars.has(n.request_id))return this._cachedUntruncatedChars.get(n.request_id);{const i=JSON.stringify(n).length;return this._cachedUntruncatedChars.set(n.request_id,i),i}}}class Mf{constructor(n=!0,i=setTimeout){d(this,"_notify",new Set);d(this,"_clearTimeout",n=>{n.timeoutId&&clearTimeout(n.timeoutId)});d(this,"_schedule",n=>{if(!this._started||n.date&&(n.timeout=n.date.getTime()-Date.now(),n.timeout<0))return;const i=this._setTimeout;n.timeoutId=i(this._handle,n.timeout,n)});d(this,"_handle",n=>{n.notify(),n.date?this._notify.delete(n):n.once||this._schedule(n)});d(this,"dispose",()=>{this._notify.forEach(this._clearTimeout),this._notify.clear()});this._started=n,this._setTimeout=i}start(){return this._started||(this._started=!0,this._notify.forEach(this._schedule)),this}stop(){return this._started=!1,this._notify.forEach(this._clearTimeout),this}get isStarted(){return this._started}set isStarted(n){n?this.start():this.stop()}once(n,i){return this._register(n,i,!0)}interval(n,i){return this._register(n,i,!1)}at(n,i){return this._register(0,i,!1,typeof n=="number"?new Date(Date.now()+n):n)}reschedule(){this._notify.forEach(n=>{this._clearTimeout(n),this._schedule(n)})}_register(n,i,o,l){if(!n&&!l)return()=>{};const f={timeout:n,notify:i,once:o,date:l};return this._notify.add(f),this._schedule(f),()=>{this._clearTimeout(f),this._notify.delete(f)}}}class Af{constructor(n=0,i=0,o=new Mf,l=Rn("busy"),f=Rn(!1)){d(this,"unsubNotify");d(this,"unsubMessage");d(this,"activity",()=>{this.idleStatus.set("busy"),this.idleScheduler.reschedule()});d(this,"focus",n=>{this.focusAfterIdle.set(n)});this._idleNotifyTimeout=n,this._idleMessageTimeout=i,this.idleScheduler=o,this.idleStatus=l,this.focusAfterIdle=f,this.idleNotifyTimeout=n,this.idleMessageTimeout=i}set idleMessageTimeout(n){var i;this._idleMessageTimeout!==n&&(this._idleMessageTimeout=n,(i=this.unsubMessage)==null||i.call(this),this.unsubMessage=this.idleScheduler.once(n,()=>{this.idleStatus.set("idle-message")}))}set idleNotifyTimeout(n){var i;this._idleNotifyTimeout!==n&&(this._idleNotifyTimeout=n,(i=this.unsubNotify)==null||i.call(this),this.unsubNotify=this.idleScheduler.once(n,()=>{this.idleStatus.set("idle-notify")}))}get idleMessageTimeout(){return this._idleMessageTimeout}get idleNotifyTimeout(){return this._idleNotifyTimeout}get notifyEnabled(){return this._idleNotifyTimeout>0}get messageEnabled(){return this._idleMessageTimeout>0}dispose(){var n,i;(n=this.unsubNotify)==null||n.call(this),(i=this.unsubMessage)==null||i.call(this),this.idleScheduler.dispose(),this.idleStatus.set("busy"),this.focusAfterIdle.set(!1)}}const Ts=Rn("idle");var Ff=(s=>(s.manual="manual",s.auto="auto",s))(Ff||{});class Sg{constructor(n,i,o,l={}){d(this,"_state",{currentConversationId:void 0,conversations:{},agentExecutionMode:"manual",isAgentEditsCollapsed:!0});d(this,"extensionClient");d(this,"_chatFlagsModel");d(this,"_currConversationModel");d(this,"subscribers",new Set);d(this,"idleMessageModel",new Af);d(this,"isAgentEditsCollapsed");d(this,"agentExecutionMode");d(this,"sortConversationsBy");d(this,"onLoaded",async()=>{var i,o;const n=await this.extensionClient.getChatInitData();this._chatFlagsModel.update({enableEditableHistory:n.enableEditableHistory??!1,enablePreferenceCollection:n.enablePreferenceCollection??!1,enableRetrievalDataCollection:n.enableRetrievalDataCollection??!1,enableDebugFeatures:n.enableDebugFeatures??!1,enableRichTextHistory:n.useRichTextHistory??!0,modelDisplayNameToId:n.modelDisplayNameToId??{},fullFeatured:n.fullFeatured??!0,smallSyncThreshold:n.smallSyncThreshold??15,bigSyncThreshold:n.bigSyncThreshold??1e3,enableExternalSourcesInChat:n.enableExternalSourcesInChat??!1,enableSmartPaste:n.enableSmartPaste??!1,enableDirectApply:n.enableDirectApply??!1,summaryTitles:n.summaryTitles??!1,suggestedEditsAvailable:n.suggestedEditsAvailable??!1,enableShareService:n.enableShareService??!1,maxTrackableFileCount:n.maxTrackableFileCount??Lc,enableDesignSystemRichTextEditor:n.enableDesignSystemRichTextEditor??!1,enableSources:n.enableSources??!1,enableChatMermaidDiagrams:n.enableChatMermaidDiagrams??!1,smartPastePrecomputeMode:n.smartPastePrecomputeMode??Ac.visibleHover,useNewThreadsMenu:n.useNewThreadsMenu??!1,enableChatMermaidDiagramsMinVersion:n.enableChatMermaidDiagramsMinVersion??!1,idleNewSessionMessageTimeoutMs:n.idleNewSessionMessageTimeoutMs,idleNewSessionNotificationTimeoutMs:n.idleNewSessionNotificationTimeoutMs,enableChatMultimodal:n.enableChatMultimodal??!1,enableAgentMode:n.enableAgentMode??!1,agentMemoriesFilePathName:n.agentMemoriesFilePathName,enableRichCheckpointInfo:n.enableRichCheckpointInfo??!1,userTier:n.userTier??"unknown",truncateChatHistory:n.truncateChatHistory??!1,enableBackgroundAgents:n.enableBackgroundAgents??!1,enableVirtualizedMessageList:n.enableVirtualizedMessageList??!1,customPersonalityPrompts:n.customPersonalityPrompts??{},enablePersonalities:n.enablePersonalities??!1,memoryClassificationOnFirstToken:n.memoryClassificationOnFirstToken??!1}),(o=(i=this.options).onLoaded)==null||o.call(i),this.notifySubscribers()});d(this,"subscribe",n=>(this.subscribers.add(n),n(this),()=>{this.subscribers.delete(n)}));d(this,"initialize",n=>{this._state={...this._state,...this._host.getState()},n&&(this._state.conversations[n==null?void 0:n.id]=n),this._chatFlagsModel.fullFeatured&&((n==null?void 0:n.id)!==ha&&this.currentConversationId!==ha||(delete this._state.conversations[ha],this.setCurrentConversationToWelcome())),this._chatFlagsModel.subscribe(i=>{this.idleMessageModel.idleNotifyTimeout=i.idleNewSessionNotificationTimeoutMs,this.idleMessageModel.idleMessageTimeout=i.idleNewSessionMessageTimeoutMs}),this._state.conversations=Object.fromEntries(Object.entries(this._state.conversations).filter(([i,o])=>xt.isValid(o))),this.initializeIsShareableState(),n?this.setCurrentConversation(n.id):this.setCurrentConversation(this.currentConversationId),this.subscribe(()=>this.idleMessageModel.activity()),this.setState(this._state)});d(this,"initializeIsShareableState",()=>{const n={...this._state.conversations};for(const[i,o]of Object.entries(n)){if(o.isShareable)continue;const l=o.chatHistory.some(f=>Jn(f));n[i]={...o,isShareable:l}}this._state.conversations=n});d(this,"updateChatState",n=>{this._state={...this._state,...n};const i=this._state.conversations,o=new Set;for(const[l,f]of Object.entries(i))f.isPinned&&o.add(l);this.setState(this._state),this.notifySubscribers()});d(this,"saveImmediate",()=>{this._host.setState(this._state)});d(this,"setState",Yd(n=>{this._host.setState({...n,isAgentEditsCollapsed:xr(this.isAgentEditsCollapsed),agentExecutionMode:xr(this.agentExecutionMode),sortConversationsBy:xr(this.sortConversationsBy)})},1e3,{maxWait:15e3}));d(this,"notifySubscribers",()=>{this.subscribers.forEach(n=>n(this))});d(this,"withWebviewClientEvent",(n,i)=>(...o)=>(this.extensionClient.reportWebviewClientEvent(n),i(...o)));d(this,"setCurrentConversationToWelcome",()=>{this.setCurrentConversation(),this._currConversationModel.setName("Welcome to Augment"),this._currConversationModel.addChatItem({chatItemType:Yn.educateFeatures,request_id:crypto.randomUUID(),seen_state:Wt.seen})});d(this,"popCurrentConversation",async()=>{var i,o;const n=this.currentConversationId;n&&await this.deleteConversation(n,((i=this.nextConversation)==null?void 0:i.id)??((o=this.previousConversation)==null?void 0:o.id))});d(this,"setCurrentConversation",async(n,i=!0)=>{let o;n===void 0?(this.deleteInvalidConversations(Kn(this._currConversationModel)?"agent":"chat"),o=xt.create({personaType:await this._currConversationModel.decidePersonaType()})):o=this._state.conversations[n]??xt.create({personaType:await this._currConversationModel.decidePersonaType()});const l=this.conversations[this._currConversationModel.id]===void 0;this._currConversationModel.setConversation(o,!l,i),this._currConversationModel.recoverAllExchanges(),this._currConversationModel.resetTotalCharactersCache()});d(this,"saveConversation",n=>{this.updateChatState({conversations:{...this._state.conversations,[n.id]:n},currentConversationId:n.id})});d(this,"isConversationShareable",n=>{var i;return((i=this._state.conversations[n])==null?void 0:i.isShareable)??!0});d(this,"setSortConversationsBy",n=>{this.sortConversationsBy.set(n),this.updateChatState({})});d(this,"getConversationUrl",async n=>{const i=this._state.conversations[n];if(i.lastUrl)return i.lastUrl;Ts.set("copying");const o=i==null?void 0:i.chatHistory,l=o.reduce((b,S)=>(Jn(S)&&b.push({request_id:S.request_id||"",request_message:S.request_message,response_text:S.response_text||""}),b),[]);if(l.length===0)throw new Error("No chat history to share");const f=xt.getDisplayName(i),_=await this.extensionClient.saveChat(n,l,f);if(_.data){let b=_.data.url;return this.updateChatState({conversations:{...this._state.conversations,[n]:{...i,lastUrl:b}}}),b}throw new Error("Failed to create URL")});d(this,"shareConversation",async n=>{if(n!==void 0)try{const i=await this.getConversationUrl(n);if(!i)return void Ts.set("idle");navigator.clipboard.writeText(i),Ts.set("copied")}catch{Ts.set("failed")}});d(this,"deleteConversations",async(n,i=void 0)=>{if(await this.extensionClient.openConfirmationModal({title:"Delete Conversation",message:`Are you sure you want to delete ${n.length>1?"these conversations":"this conversation"}?`,confirmButtonText:"Delete",cancelButtonText:"Cancel"})){const o=new Set(n);this.deleteConversationIds(o),this.currentConversationId&&o.has(this.currentConversationId)&&this.setCurrentConversation(i)}});d(this,"deleteConversation",async(n,i=void 0)=>{await this.deleteConversations([n],i)});d(this,"deleteConversationIds",async n=>{var o;const i=[];for(const l of n){const f=((o=this._state.conversations[l])==null?void 0:o.requestIds)??[];i.push(...f)}for(const l of Object.values(this._state.conversations))if(n.has(l.id)){for(const _ of l.chatHistory)de(_)&&this.deleteImagesInExchange(_);const f=l.draftExchange;f&&this.deleteImagesInExchange(f)}this.updateChatState({conversations:Object.fromEntries(Object.entries(this._state.conversations).filter(([l])=>!n.has(l)))}),this.extensionClient.clearMetadataFor({requestIds:i,conversationIds:Array.from(n)})});d(this,"deleteImagesInExchange",n=>{const i=new Set([...n.rich_text_json_repr?this.findImagesInJson(n.rich_text_json_repr):[],...n.structured_request_nodes?this.findImagesInStructuredRequest(n.structured_request_nodes):[]]);for(const o of i)this.deleteImage(o)});d(this,"findImagesInJson",n=>{const i=[],o=l=>{var f;if(l.type==="image"&&((f=l.attrs)!=null&&f.src))i.push(l.attrs.src);else if((l.type==="doc"||l.type==="paragraph")&&l.content)for(const _ of l.content)o(_)};return o(n),i});d(this,"findImagesInStructuredRequest",n=>n.reduce((i,o)=>(o.type===te.IMAGE_ID&&o.image_id_node&&i.push(o.image_id_node.image_id),i),[]));d(this,"toggleConversationPinned",n=>{const i=this._state.conversations[n],o={...i,isPinned:!i.isPinned};this.updateChatState({conversations:{...this._state.conversations,[n]:o}}),n===this.currentConversationId&&this._currConversationModel.toggleIsPinned()});d(this,"renameConversation",(n,i)=>{const o={...this._state.conversations[n],name:i};this.updateChatState({conversations:{...this._state.conversations,[n]:o}}),n===this.currentConversationId&&this._currConversationModel.setName(i)});d(this,"smartPaste",(n,i,o,l)=>{const f=this._currConversationModel.historyTo(n,!0).filter(_=>Jn(_)).map(_=>({request_message:_.request_message,response_text:_.response_text||"",request_id:_.request_id||""}));this.extensionClient.smartPaste({generatedCode:i,chatHistory:f,targetFile:o??void 0,options:l})});d(this,"saveImage",async n=>await this.extensionClient.saveImage(n));d(this,"deleteImage",async n=>await this.extensionClient.deleteImage(n));d(this,"renderImage",async n=>await this.extensionClient.loadImage(n));this._asyncMsgSender=n,this._host=i,this._specialContextInputModel=o,this.options=l,this._chatFlagsModel=new gf(l.initialFlags),this.extensionClient=new lf(this._host,this._asyncMsgSender,this._chatFlagsModel),this._currConversationModel=new xt(this.extensionClient,this._chatFlagsModel,this._specialContextInputModel,this.saveConversation),this.initialize(l.initialConversation),this.isAgentEditsCollapsed=Rn(this._state.isAgentEditsCollapsed),this.agentExecutionMode=Rn(this._state.agentExecutionMode??"manual"),this.sortConversationsBy=Rn(this._state.sortConversationsBy??"lastMessageTimestamp"),this.onLoaded()}get flags(){return this._chatFlagsModel}get specialContextInputModel(){return this._specialContextInputModel}get currentConversationId(){return this._state.currentConversationId}get currentConversationModel(){return this._currConversationModel}get conversations(){return this._state.conversations}orderedConversations(n,i="desc",o){const l=n||this._state.sortConversationsBy||"lastMessageTimestamp";let f=Object.values(this._state.conversations);return o&&(f=f.filter(o)),f.sort((_,b)=>{const S=xt.getTime(_,l).getTime(),A=xt.getTime(b,l).getTime();return i==="asc"?S-A:A-S})}get nextConversation(){if(!this.currentConversationId)return;const n=this.orderedConversations(),i=n.findIndex(o=>o.id===this.currentConversationId);return n.length>i+1?n[i+1]:void 0}get previousConversation(){if(!this.currentConversationId)return;const n=this.orderedConversations(),i=n.findIndex(o=>o.id===this.currentConversationId);return i>0?n[i-1]:void 0}get host(){return this._host}deleteInvalidConversations(n="all"){const i=Object.keys(this.conversations).filter(o=>{const l=!xt.isValid(this.conversations[o]),f=Kn(this.conversations[o]);return l&&(n==="agent"&&f||n==="chat"&&!f||n==="all")});i.length&&this.deleteConversationIds(new Set(i))}get lastMessageTimestamp(){const n=this.currentConversationModel.lastExchange;return n==null?void 0:n.timestamp}handleMessageFromExtension(n){return n.data.type===U.newThread&&(this.setCurrentConversation(),!0)}}const Vn=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,Sc=new Set,Sa=typeof process=="object"&&process?process:{},Bc=(s,n,i,o)=>{typeof Sa.emitWarning=="function"?Sa.emitWarning(s,n,i,o):console.error(`[${i}] ${n}: ${s}`)};let ks=globalThis.AbortController,Cc=globalThis.AbortSignal;var Ec;if(ks===void 0){Cc=class{constructor(){d(this,"onabort");d(this,"_onabort",[]);d(this,"reason");d(this,"aborted",!1)}addEventListener(i,o){this._onabort.push(o)}},ks=class{constructor(){d(this,"signal",new Cc);n()}abort(i){var o,l;if(!this.signal.aborted){this.signal.reason=i,this.signal.aborted=!0;for(const f of this.signal._onabort)f(i);(l=(o=this.signal).onabort)==null||l.call(o,i)}}};let s=((Ec=Sa.env)==null?void 0:Ec.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const n=()=>{s&&(s=!1,Bc("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",n))}}const dn=s=>s&&s===Math.floor(s)&&s>0&&isFinite(s),$c=s=>dn(s)?s<=Math.pow(2,8)?Uint8Array:s<=Math.pow(2,16)?Uint16Array:s<=Math.pow(2,32)?Uint32Array:s<=Number.MAX_SAFE_INTEGER?Rs:null:null;class Rs extends Array{constructor(n){super(n),this.fill(0)}}var Xn;const Mn=class Mn{constructor(n,i){d(this,"heap");d(this,"length");if(!g(Mn,Xn))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new i(n),this.length=0}static create(n){const i=$c(n);if(!i)return[];W(Mn,Xn,!0);const o=new Mn(n,i);return W(Mn,Xn,!1),o}push(n){this.heap[this.length++]=n}pop(){return this.heap[--this.length]}};Xn=new WeakMap,it(Mn,Xn,!1);let Ca=Mn;var Tc,Mc,Te,ue,Me,Ae,Qn,tr,Ft,Fe,Et,mt,J,Zt,ce,Gt,Ot,Re,Dt,qe,Oe,le,De,_n,Yt,F,wa,An,Xe,Ir,he,Vc,Fn,er,Er,fn,gn,Ia,qs,Os,_t,Ea,Cr,pn,Ta;const qa=class qa{constructor(n){it(this,F);it(this,Te);it(this,ue);it(this,Me);it(this,Ae);it(this,Qn);it(this,tr);d(this,"ttl");d(this,"ttlResolution");d(this,"ttlAutopurge");d(this,"updateAgeOnGet");d(this,"updateAgeOnHas");d(this,"allowStale");d(this,"noDisposeOnSet");d(this,"noUpdateTTL");d(this,"maxEntrySize");d(this,"sizeCalculation");d(this,"noDeleteOnFetchRejection");d(this,"noDeleteOnStaleGet");d(this,"allowStaleOnFetchAbort");d(this,"allowStaleOnFetchRejection");d(this,"ignoreFetchAbort");it(this,Ft);it(this,Fe);it(this,Et);it(this,mt);it(this,J);it(this,Zt);it(this,ce);it(this,Gt);it(this,Ot);it(this,Re);it(this,Dt);it(this,qe);it(this,Oe);it(this,le);it(this,De);it(this,_n);it(this,Yt);it(this,An,()=>{});it(this,Xe,()=>{});it(this,Ir,()=>{});it(this,he,()=>!1);it(this,Fn,n=>{});it(this,er,(n,i,o)=>{});it(this,Er,(n,i,o,l)=>{if(o||l)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});d(this,Tc,"LRUCache");const{max:i=0,ttl:o,ttlResolution:l=1,ttlAutopurge:f,updateAgeOnGet:_,updateAgeOnHas:b,allowStale:S,dispose:A,disposeAfter:q,noDisposeOnSet:D,noUpdateTTL:tt,maxSize:et=0,maxEntrySize:N=0,sizeCalculation:rt,fetchMethod:vt,memoMethod:z,noDeleteOnFetchRejection:dt,noDeleteOnStaleGet:ze,allowStaleOnFetchRejection:ne,allowStaleOnFetchAbort:bt,ignoreFetchAbort:Ce}=n;if(i!==0&&!dn(i))throw new TypeError("max option must be a nonnegative integer");const Rt=i?$c(i):Array;if(!Rt)throw new Error("invalid max value: "+i);if(W(this,Te,i),W(this,ue,et),this.maxEntrySize=N||g(this,ue),this.sizeCalculation=rt,this.sizeCalculation){if(!g(this,ue)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(z!==void 0&&typeof z!="function")throw new TypeError("memoMethod must be a function if defined");if(W(this,tr,z),vt!==void 0&&typeof vt!="function")throw new TypeError("fetchMethod must be a function if specified");if(W(this,Qn,vt),W(this,_n,!!vt),W(this,Et,new Map),W(this,mt,new Array(i).fill(void 0)),W(this,J,new Array(i).fill(void 0)),W(this,Zt,new Rt(i)),W(this,ce,new Rt(i)),W(this,Gt,0),W(this,Ot,0),W(this,Re,Ca.create(i)),W(this,Ft,0),W(this,Fe,0),typeof A=="function"&&W(this,Me,A),typeof q=="function"?(W(this,Ae,q),W(this,Dt,[])):(W(this,Ae,void 0),W(this,Dt,void 0)),W(this,De,!!g(this,Me)),W(this,Yt,!!g(this,Ae)),this.noDisposeOnSet=!!D,this.noUpdateTTL=!!tt,this.noDeleteOnFetchRejection=!!dt,this.allowStaleOnFetchRejection=!!ne,this.allowStaleOnFetchAbort=!!bt,this.ignoreFetchAbort=!!Ce,this.maxEntrySize!==0){if(g(this,ue)!==0&&!dn(g(this,ue)))throw new TypeError("maxSize must be a positive integer if specified");if(!dn(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");k(this,F,Vc).call(this)}if(this.allowStale=!!S,this.noDeleteOnStaleGet=!!ze,this.updateAgeOnGet=!!_,this.updateAgeOnHas=!!b,this.ttlResolution=dn(l)||l===0?l:1,this.ttlAutopurge=!!f,this.ttl=o||0,this.ttl){if(!dn(this.ttl))throw new TypeError("ttl must be a positive integer if specified");k(this,F,wa).call(this)}if(g(this,Te)===0&&this.ttl===0&&g(this,ue)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!g(this,Te)&&!g(this,ue)){const Ge="LRU_CACHE_UNBOUNDED";(ke=>!Sc.has(ke))(Ge)&&(Sc.add(Ge),Bc("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",Ge,qa))}}static unsafeExposeInternals(n){return{starts:g(n,Oe),ttls:g(n,le),sizes:g(n,qe),keyMap:g(n,Et),keyList:g(n,mt),valList:g(n,J),next:g(n,Zt),prev:g(n,ce),get head(){return g(n,Gt)},get tail(){return g(n,Ot)},free:g(n,Re),isBackgroundFetch:i=>{var o;return k(o=n,F,_t).call(o,i)},backgroundFetch:(i,o,l,f)=>{var _;return k(_=n,F,Os).call(_,i,o,l,f)},moveToTail:i=>{var o;return k(o=n,F,Cr).call(o,i)},indexes:i=>{var o;return k(o=n,F,fn).call(o,i)},rindexes:i=>{var o;return k(o=n,F,gn).call(o,i)},isStale:i=>{var o;return g(o=n,he).call(o,i)}}}get max(){return g(this,Te)}get maxSize(){return g(this,ue)}get calculatedSize(){return g(this,Fe)}get size(){return g(this,Ft)}get fetchMethod(){return g(this,Qn)}get memoMethod(){return g(this,tr)}get dispose(){return g(this,Me)}get disposeAfter(){return g(this,Ae)}getRemainingTTL(n){return g(this,Et).has(n)?1/0:0}*entries(){for(const n of k(this,F,fn).call(this))g(this,J)[n]===void 0||g(this,mt)[n]===void 0||k(this,F,_t).call(this,g(this,J)[n])||(yield[g(this,mt)[n],g(this,J)[n]])}*rentries(){for(const n of k(this,F,gn).call(this))g(this,J)[n]===void 0||g(this,mt)[n]===void 0||k(this,F,_t).call(this,g(this,J)[n])||(yield[g(this,mt)[n],g(this,J)[n]])}*keys(){for(const n of k(this,F,fn).call(this)){const i=g(this,mt)[n];i===void 0||k(this,F,_t).call(this,g(this,J)[n])||(yield i)}}*rkeys(){for(const n of k(this,F,gn).call(this)){const i=g(this,mt)[n];i===void 0||k(this,F,_t).call(this,g(this,J)[n])||(yield i)}}*values(){for(const n of k(this,F,fn).call(this))g(this,J)[n]===void 0||k(this,F,_t).call(this,g(this,J)[n])||(yield g(this,J)[n])}*rvalues(){for(const n of k(this,F,gn).call(this))g(this,J)[n]===void 0||k(this,F,_t).call(this,g(this,J)[n])||(yield g(this,J)[n])}[(Mc=Symbol.iterator,Tc=Symbol.toStringTag,Mc)](){return this.entries()}find(n,i={}){for(const o of k(this,F,fn).call(this)){const l=g(this,J)[o],f=k(this,F,_t).call(this,l)?l.__staleWhileFetching:l;if(f!==void 0&&n(f,g(this,mt)[o],this))return this.get(g(this,mt)[o],i)}}forEach(n,i=this){for(const o of k(this,F,fn).call(this)){const l=g(this,J)[o],f=k(this,F,_t).call(this,l)?l.__staleWhileFetching:l;f!==void 0&&n.call(i,f,g(this,mt)[o],this)}}rforEach(n,i=this){for(const o of k(this,F,gn).call(this)){const l=g(this,J)[o],f=k(this,F,_t).call(this,l)?l.__staleWhileFetching:l;f!==void 0&&n.call(i,f,g(this,mt)[o],this)}}purgeStale(){let n=!1;for(const i of k(this,F,gn).call(this,{allowStale:!0}))g(this,he).call(this,i)&&(k(this,F,pn).call(this,g(this,mt)[i],"expire"),n=!0);return n}info(n){const i=g(this,Et).get(n);if(i===void 0)return;const o=g(this,J)[i],l=k(this,F,_t).call(this,o)?o.__staleWhileFetching:o;if(l===void 0)return;const f={value:l};if(g(this,le)&&g(this,Oe)){const _=g(this,le)[i],b=g(this,Oe)[i];if(_&&b){const S=_-(Vn.now()-b);f.ttl=S,f.start=Date.now()}}return g(this,qe)&&(f.size=g(this,qe)[i]),f}dump(){const n=[];for(const i of k(this,F,fn).call(this,{allowStale:!0})){const o=g(this,mt)[i],l=g(this,J)[i],f=k(this,F,_t).call(this,l)?l.__staleWhileFetching:l;if(f===void 0||o===void 0)continue;const _={value:f};if(g(this,le)&&g(this,Oe)){_.ttl=g(this,le)[i];const b=Vn.now()-g(this,Oe)[i];_.start=Math.floor(Date.now()-b)}g(this,qe)&&(_.size=g(this,qe)[i]),n.unshift([o,_])}return n}load(n){this.clear();for(const[i,o]of n){if(o.start){const l=Date.now()-o.start;o.start=Vn.now()-l}this.set(i,o.value,o)}}set(n,i,o={}){var tt,et,N,rt,vt;if(i===void 0)return this.delete(n),this;const{ttl:l=this.ttl,start:f,noDisposeOnSet:_=this.noDisposeOnSet,sizeCalculation:b=this.sizeCalculation,status:S}=o;let{noUpdateTTL:A=this.noUpdateTTL}=o;const q=g(this,Er).call(this,n,i,o.size||0,b);if(this.maxEntrySize&&q>this.maxEntrySize)return S&&(S.set="miss",S.maxEntrySizeExceeded=!0),k(this,F,pn).call(this,n,"set"),this;let D=g(this,Ft)===0?void 0:g(this,Et).get(n);if(D===void 0)D=g(this,Ft)===0?g(this,Ot):g(this,Re).length!==0?g(this,Re).pop():g(this,Ft)===g(this,Te)?k(this,F,qs).call(this,!1):g(this,Ft),g(this,mt)[D]=n,g(this,J)[D]=i,g(this,Et).set(n,D),g(this,Zt)[g(this,Ot)]=D,g(this,ce)[D]=g(this,Ot),W(this,Ot,D),Is(this,Ft)._++,g(this,er).call(this,D,q,S),S&&(S.set="add"),A=!1;else{k(this,F,Cr).call(this,D);const z=g(this,J)[D];if(i!==z){if(g(this,_n)&&k(this,F,_t).call(this,z)){z.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:dt}=z;dt===void 0||_||(g(this,De)&&((tt=g(this,Me))==null||tt.call(this,dt,n,"set")),g(this,Yt)&&((et=g(this,Dt))==null||et.push([dt,n,"set"])))}else _||(g(this,De)&&((N=g(this,Me))==null||N.call(this,z,n,"set")),g(this,Yt)&&((rt=g(this,Dt))==null||rt.push([z,n,"set"])));if(g(this,Fn).call(this,D),g(this,er).call(this,D,q,S),g(this,J)[D]=i,S){S.set="replace";const dt=z&&k(this,F,_t).call(this,z)?z.__staleWhileFetching:z;dt!==void 0&&(S.oldValue=dt)}}else S&&(S.set="update")}if(l===0||g(this,le)||k(this,F,wa).call(this),g(this,le)&&(A||g(this,Ir).call(this,D,l,f),S&&g(this,Xe).call(this,S,D)),!_&&g(this,Yt)&&g(this,Dt)){const z=g(this,Dt);let dt;for(;dt=z==null?void 0:z.shift();)(vt=g(this,Ae))==null||vt.call(this,...dt)}return this}pop(){var n;try{for(;g(this,Ft);){const i=g(this,J)[g(this,Gt)];if(k(this,F,qs).call(this,!0),k(this,F,_t).call(this,i)){if(i.__staleWhileFetching)return i.__staleWhileFetching}else if(i!==void 0)return i}}finally{if(g(this,Yt)&&g(this,Dt)){const i=g(this,Dt);let o;for(;o=i==null?void 0:i.shift();)(n=g(this,Ae))==null||n.call(this,...o)}}}has(n,i={}){const{updateAgeOnHas:o=this.updateAgeOnHas,status:l}=i,f=g(this,Et).get(n);if(f!==void 0){const _=g(this,J)[f];if(k(this,F,_t).call(this,_)&&_.__staleWhileFetching===void 0)return!1;if(!g(this,he).call(this,f))return o&&g(this,An).call(this,f),l&&(l.has="hit",g(this,Xe).call(this,l,f)),!0;l&&(l.has="stale",g(this,Xe).call(this,l,f))}else l&&(l.has="miss");return!1}peek(n,i={}){const{allowStale:o=this.allowStale}=i,l=g(this,Et).get(n);if(l===void 0||!o&&g(this,he).call(this,l))return;const f=g(this,J)[l];return k(this,F,_t).call(this,f)?f.__staleWhileFetching:f}async fetch(n,i={}){const{allowStale:o=this.allowStale,updateAgeOnGet:l=this.updateAgeOnGet,noDeleteOnStaleGet:f=this.noDeleteOnStaleGet,ttl:_=this.ttl,noDisposeOnSet:b=this.noDisposeOnSet,size:S=0,sizeCalculation:A=this.sizeCalculation,noUpdateTTL:q=this.noUpdateTTL,noDeleteOnFetchRejection:D=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:tt=this.allowStaleOnFetchRejection,ignoreFetchAbort:et=this.ignoreFetchAbort,allowStaleOnFetchAbort:N=this.allowStaleOnFetchAbort,context:rt,forceRefresh:vt=!1,status:z,signal:dt}=i;if(!g(this,_n))return z&&(z.fetch="get"),this.get(n,{allowStale:o,updateAgeOnGet:l,noDeleteOnStaleGet:f,status:z});const ze={allowStale:o,updateAgeOnGet:l,noDeleteOnStaleGet:f,ttl:_,noDisposeOnSet:b,size:S,sizeCalculation:A,noUpdateTTL:q,noDeleteOnFetchRejection:D,allowStaleOnFetchRejection:tt,allowStaleOnFetchAbort:N,ignoreFetchAbort:et,status:z,signal:dt};let ne=g(this,Et).get(n);if(ne===void 0){z&&(z.fetch="miss");const bt=k(this,F,Os).call(this,n,ne,ze,rt);return bt.__returned=bt}{const bt=g(this,J)[ne];if(k(this,F,_t).call(this,bt)){const ke=o&&bt.__staleWhileFetching!==void 0;return z&&(z.fetch="inflight",ke&&(z.returnedStale=!0)),ke?bt.__staleWhileFetching:bt.__returned=bt}const Ce=g(this,he).call(this,ne);if(!vt&&!Ce)return z&&(z.fetch="hit"),k(this,F,Cr).call(this,ne),l&&g(this,An).call(this,ne),z&&g(this,Xe).call(this,z,ne),bt;const Rt=k(this,F,Os).call(this,n,ne,ze,rt),Ge=Rt.__staleWhileFetching!==void 0&&o;return z&&(z.fetch=Ce?"stale":"refresh",Ge&&Ce&&(z.returnedStale=!0)),Ge?Rt.__staleWhileFetching:Rt.__returned=Rt}}async forceFetch(n,i={}){const o=await this.fetch(n,i);if(o===void 0)throw new Error("fetch() returned undefined");return o}memo(n,i={}){const o=g(this,tr);if(!o)throw new Error("no memoMethod provided to constructor");const{context:l,forceRefresh:f,..._}=i,b=this.get(n,_);if(!f&&b!==void 0)return b;const S=o(n,b,{options:_,context:l});return this.set(n,S,_),S}get(n,i={}){const{allowStale:o=this.allowStale,updateAgeOnGet:l=this.updateAgeOnGet,noDeleteOnStaleGet:f=this.noDeleteOnStaleGet,status:_}=i,b=g(this,Et).get(n);if(b!==void 0){const S=g(this,J)[b],A=k(this,F,_t).call(this,S);return _&&g(this,Xe).call(this,_,b),g(this,he).call(this,b)?(_&&(_.get="stale"),A?(_&&o&&S.__staleWhileFetching!==void 0&&(_.returnedStale=!0),o?S.__staleWhileFetching:void 0):(f||k(this,F,pn).call(this,n,"expire"),_&&o&&(_.returnedStale=!0),o?S:void 0)):(_&&(_.get="hit"),A?S.__staleWhileFetching:(k(this,F,Cr).call(this,b),l&&g(this,An).call(this,b),S))}_&&(_.get="miss")}delete(n){return k(this,F,pn).call(this,n,"delete")}clear(){return k(this,F,Ta).call(this,"delete")}};Te=new WeakMap,ue=new WeakMap,Me=new WeakMap,Ae=new WeakMap,Qn=new WeakMap,tr=new WeakMap,Ft=new WeakMap,Fe=new WeakMap,Et=new WeakMap,mt=new WeakMap,J=new WeakMap,Zt=new WeakMap,ce=new WeakMap,Gt=new WeakMap,Ot=new WeakMap,Re=new WeakMap,Dt=new WeakMap,qe=new WeakMap,Oe=new WeakMap,le=new WeakMap,De=new WeakMap,_n=new WeakMap,Yt=new WeakMap,F=new WeakSet,wa=function(){const n=new Rs(g(this,Te)),i=new Rs(g(this,Te));W(this,le,n),W(this,Oe,i),W(this,Ir,(f,_,b=Vn.now())=>{if(i[f]=_!==0?b:0,n[f]=_,_!==0&&this.ttlAutopurge){const S=setTimeout(()=>{g(this,he).call(this,f)&&k(this,F,pn).call(this,g(this,mt)[f],"expire")},_+1);S.unref&&S.unref()}}),W(this,An,f=>{i[f]=n[f]!==0?Vn.now():0}),W(this,Xe,(f,_)=>{if(n[_]){const b=n[_],S=i[_];if(!b||!S)return;f.ttl=b,f.start=S,f.now=o||l();const A=f.now-S;f.remainingTTL=b-A}});let o=0;const l=()=>{const f=Vn.now();if(this.ttlResolution>0){o=f;const _=setTimeout(()=>o=0,this.ttlResolution);_.unref&&_.unref()}return f};this.getRemainingTTL=f=>{const _=g(this,Et).get(f);if(_===void 0)return 0;const b=n[_],S=i[_];return!b||!S?1/0:b-((o||l())-S)},W(this,he,f=>{const _=i[f],b=n[f];return!!b&&!!_&&(o||l())-_>b})},An=new WeakMap,Xe=new WeakMap,Ir=new WeakMap,he=new WeakMap,Vc=function(){const n=new Rs(g(this,Te));W(this,Fe,0),W(this,qe,n),W(this,Fn,i=>{W(this,Fe,g(this,Fe)-n[i]),n[i]=0}),W(this,Er,(i,o,l,f)=>{if(k(this,F,_t).call(this,o))return 0;if(!dn(l)){if(!f)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if(typeof f!="function")throw new TypeError("sizeCalculation must be a function");if(l=f(o,i),!dn(l))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return l}),W(this,er,(i,o,l)=>{if(n[i]=o,g(this,ue)){const f=g(this,ue)-n[i];for(;g(this,Fe)>f;)k(this,F,qs).call(this,!0)}W(this,Fe,g(this,Fe)+n[i]),l&&(l.entrySize=o,l.totalCalculatedSize=g(this,Fe))})},Fn=new WeakMap,er=new WeakMap,Er=new WeakMap,fn=function*({allowStale:n=this.allowStale}={}){if(g(this,Ft))for(let i=g(this,Ot);k(this,F,Ia).call(this,i)&&(!n&&g(this,he).call(this,i)||(yield i),i!==g(this,Gt));)i=g(this,ce)[i]},gn=function*({allowStale:n=this.allowStale}={}){if(g(this,Ft))for(let i=g(this,Gt);k(this,F,Ia).call(this,i)&&(!n&&g(this,he).call(this,i)||(yield i),i!==g(this,Ot));)i=g(this,Zt)[i]},Ia=function(n){return n!==void 0&&g(this,Et).get(g(this,mt)[n])===n},qs=function(n){var f,_;const i=g(this,Gt),o=g(this,mt)[i],l=g(this,J)[i];return g(this,_n)&&k(this,F,_t).call(this,l)?l.__abortController.abort(new Error("evicted")):(g(this,De)||g(this,Yt))&&(g(this,De)&&((f=g(this,Me))==null||f.call(this,l,o,"evict")),g(this,Yt)&&((_=g(this,Dt))==null||_.push([l,o,"evict"]))),g(this,Fn).call(this,i),n&&(g(this,mt)[i]=void 0,g(this,J)[i]=void 0,g(this,Re).push(i)),g(this,Ft)===1?(W(this,Gt,W(this,Ot,0)),g(this,Re).length=0):W(this,Gt,g(this,Zt)[i]),g(this,Et).delete(o),Is(this,Ft)._--,i},Os=function(n,i,o,l){const f=i===void 0?void 0:g(this,J)[i];if(k(this,F,_t).call(this,f))return f;const _=new ks,{signal:b}=o;b==null||b.addEventListener("abort",()=>_.abort(b.reason),{signal:_.signal});const S={signal:_.signal,options:o,context:l},A=(et,N=!1)=>{const{aborted:rt}=_.signal,vt=o.ignoreFetchAbort&&et!==void 0;if(o.status&&(rt&&!N?(o.status.fetchAborted=!0,o.status.fetchError=_.signal.reason,vt&&(o.status.fetchAbortIgnored=!0)):o.status.fetchResolved=!0),rt&&!vt&&!N)return q(_.signal.reason);const z=D;return g(this,J)[i]===D&&(et===void 0?z.__staleWhileFetching?g(this,J)[i]=z.__staleWhileFetching:k(this,F,pn).call(this,n,"fetch"):(o.status&&(o.status.fetchUpdated=!0),this.set(n,et,S.options))),et},q=et=>{const{aborted:N}=_.signal,rt=N&&o.allowStaleOnFetchAbort,vt=rt||o.allowStaleOnFetchRejection,z=vt||o.noDeleteOnFetchRejection,dt=D;if(g(this,J)[i]===D&&(!z||dt.__staleWhileFetching===void 0?k(this,F,pn).call(this,n,"fetch"):rt||(g(this,J)[i]=dt.__staleWhileFetching)),vt)return o.status&&dt.__staleWhileFetching!==void 0&&(o.status.returnedStale=!0),dt.__staleWhileFetching;if(dt.__returned===dt)throw et};o.status&&(o.status.fetchDispatched=!0);const D=new Promise((et,N)=>{var vt;const rt=(vt=g(this,Qn))==null?void 0:vt.call(this,n,f,S);rt&&rt instanceof Promise&&rt.then(z=>et(z===void 0?void 0:z),N),_.signal.addEventListener("abort",()=>{o.ignoreFetchAbort&&!o.allowStaleOnFetchAbort||(et(void 0),o.allowStaleOnFetchAbort&&(et=z=>A(z,!0)))})}).then(A,et=>(o.status&&(o.status.fetchRejected=!0,o.status.fetchError=et),q(et))),tt=Object.assign(D,{__abortController:_,__staleWhileFetching:f,__returned:void 0});return i===void 0?(this.set(n,tt,{...S.options,status:void 0}),i=g(this,Et).get(n)):g(this,J)[i]=tt,tt},_t=function(n){if(!g(this,_n))return!1;const i=n;return!!i&&i instanceof Promise&&i.hasOwnProperty("__staleWhileFetching")&&i.__abortController instanceof ks},Ea=function(n,i){g(this,ce)[i]=n,g(this,Zt)[n]=i},Cr=function(n){n!==g(this,Ot)&&(n===g(this,Gt)?W(this,Gt,g(this,Zt)[n]):k(this,F,Ea).call(this,g(this,ce)[n],g(this,Zt)[n]),k(this,F,Ea).call(this,g(this,Ot),n),W(this,Ot,n))},pn=function(n,i){var l,f,_,b;let o=!1;if(g(this,Ft)!==0){const S=g(this,Et).get(n);if(S!==void 0)if(o=!0,g(this,Ft)===1)k(this,F,Ta).call(this,i);else{g(this,Fn).call(this,S);const A=g(this,J)[S];if(k(this,F,_t).call(this,A)?A.__abortController.abort(new Error("deleted")):(g(this,De)||g(this,Yt))&&(g(this,De)&&((l=g(this,Me))==null||l.call(this,A,n,i)),g(this,Yt)&&((f=g(this,Dt))==null||f.push([A,n,i]))),g(this,Et).delete(n),g(this,mt)[S]=void 0,g(this,J)[S]=void 0,S===g(this,Ot))W(this,Ot,g(this,ce)[S]);else if(S===g(this,Gt))W(this,Gt,g(this,Zt)[S]);else{const q=g(this,ce)[S];g(this,Zt)[q]=g(this,Zt)[S];const D=g(this,Zt)[S];g(this,ce)[D]=g(this,ce)[S]}Is(this,Ft)._--,g(this,Re).push(S)}}if(g(this,Yt)&&((_=g(this,Dt))!=null&&_.length)){const S=g(this,Dt);let A;for(;A=S==null?void 0:S.shift();)(b=g(this,Ae))==null||b.call(this,...A)}return o},Ta=function(n){var i,o,l;for(const f of k(this,F,gn).call(this,{allowStale:!0})){const _=g(this,J)[f];if(k(this,F,_t).call(this,_))_.__abortController.abort(new Error("deleted"));else{const b=g(this,mt)[f];g(this,De)&&((i=g(this,Me))==null||i.call(this,_,b,n)),g(this,Yt)&&((o=g(this,Dt))==null||o.push([_,b,n]))}}if(g(this,Et).clear(),g(this,J).fill(void 0),g(this,mt).fill(void 0),g(this,le)&&g(this,Oe)&&(g(this,le).fill(0),g(this,Oe).fill(0)),g(this,qe)&&g(this,qe).fill(0),W(this,Gt,0),W(this,Ot,0),g(this,Re).length=0,W(this,Fe,0),W(this,Ft,0),g(this,Yt)&&g(this,Dt)){const f=g(this,Dt);let _;for(;_=f==null?void 0:f.shift();)(l=g(this,Ae))==null||l.call(this,..._)}};let xa=qa;class Cg{constructor(){d(this,"_syncStatus",{status:rf.done,foldersProgress:[]});d(this,"_syncEnabledState",pc.initializing);d(this,"_workspaceGuidelines",[]);d(this,"_openUserGuidelinesInput",!1);d(this,"_userGuidelines");d(this,"_contextStore",new Rf);d(this,"_prevOpenFiles",[]);d(this,"_disableContext",!1);d(this,"_enableAgentMemories",!1);d(this,"subscribers",new Set);d(this,"subscribe",n=>(this.subscribers.add(n),n(this),()=>{this.subscribers.delete(n)}));d(this,"handleMessageFromExtension",n=>{const i=n.data;switch(i.type){case U.sourceFoldersUpdated:this.onSourceFoldersUpdated(i.data.sourceFolders);break;case U.sourceFoldersSyncStatus:this.onSyncStatusUpdated(i.data);break;case U.fileRangesSelected:this.updateSelections(i.data);break;case U.currentlyOpenFiles:this.setCurrentlyOpenFiles(i.data);break;case U.syncEnabledState:this.onSyncEnabledStateUpdate(i.data);break;case U.updateGuidelinesState:this.onGuidelinesStateUpdate(i.data);break;default:return!1}return!0});d(this,"onSourceFoldersUpdated",n=>{const i=this.sourceFolders;n=this.updateSourceFoldersWithGuidelines(n),this._contextStore.update(n.map(o=>({sourceFolder:o,status:kt.active,label:o.folderRoot,showWarning:o.guidelinesOverLimit,id:o.folderRoot+String(o.guidelinesEnabled)+String(o.guidelinesOverLimit)})),i,o=>o.id),this.notifySubscribers()});d(this,"onSyncStatusUpdated",n=>{this._syncStatus=n,this.notifySubscribers()});d(this,"disableContext",()=>{this._disableContext=!0,this.notifySubscribers()});d(this,"enableContext",()=>{this._disableContext=!1,this.notifySubscribers()});d(this,"addFile",n=>{this.addFiles([n])});d(this,"addFiles",n=>{this.updateFiles(n,[])});d(this,"removeFile",n=>{this.removeFiles([n])});d(this,"removeFiles",n=>{this.updateFiles([],n)});d(this,"updateItems",(n,i)=>{this.updateItemsInplace(n,i),this.notifySubscribers()});d(this,"updateItemsInplace",(n,i)=>{this._contextStore.update(n,i,o=>o.id)});d(this,"updateFiles",(n,i)=>{const o=_=>({file:_,...Fs(_)}),l=n.map(o),f=i.map(o);this._contextStore.update(l,f,_=>_.id),this.notifySubscribers()});d(this,"enableAgentMemories",()=>{this._enableAgentMemories=!0,this.notifySubscribers()});d(this,"disableAgentMemories",()=>{this._enableAgentMemories=!1,this.notifySubscribers()});d(this,"setCurrentlyOpenFiles",n=>{const i=n.map(l=>({recentFile:l,...Fs(l)})),o=this._prevOpenFiles;this._prevOpenFiles=i,this._contextStore.update(i,o,l=>l.id),o.forEach(l=>{const f=this._contextStore.peekKey(l.id);f!=null&&f.recentFile&&(f.file=f.recentFile,delete f.recentFile)}),i.forEach(l=>{const f=this._contextStore.peekKey(l.id);f!=null&&f.file&&(f.recentFile=f.file,delete f.file)}),this.notifySubscribers()});d(this,"onSyncEnabledStateUpdate",n=>{this._syncEnabledState=n,this.notifySubscribers()});d(this,"updateUserGuidelines",n=>{const i=this.userGuidelines,o={userGuidelines:n,label:"User Guidelines",id:"userGuidelines",status:kt.active,referenceCount:1,showWarning:n.overLimit};this._contextStore.update([o],i,l=>{var f,_;return l.id+String((f=l.userGuidelines)==null?void 0:f.enabled)+String((_=l.userGuidelines)==null?void 0:_.overLimit)}),this.notifySubscribers()});d(this,"onGuidelinesStateUpdate",n=>{this._userGuidelines=n.userGuidelines,this._workspaceGuidelines=n.workspaceGuidelines??[];const i=n.userGuidelines;i&&this.updateUserGuidelines(i),this.onSourceFoldersUpdated(this.sourceFolders.map(o=>o.sourceFolder))});d(this,"updateSourceFoldersWithGuidelines",n=>n.map(i=>{const o=this._workspaceGuidelines.find(l=>l.workspaceFolder===i.folderRoot);return{...i,guidelinesEnabled:(o==null?void 0:o.enabled)??!1,guidelinesOverLimit:(o==null?void 0:o.overLimit)??!1,guidelinesLengthLimit:(o==null?void 0:o.lengthLimit)??2e3}}));d(this,"toggleStatus",n=>{this._contextStore.toggleStatus(n.id),this.notifySubscribers()});d(this,"updateExternalSources",(n,i)=>{this._contextStore.update(n,i,o=>o.id),this.notifySubscribers()});d(this,"clearFiles",()=>{this._contextStore.update([],this.files,n=>n.id),this.notifySubscribers()});d(this,"updateSelections",n=>{const i=this._contextStore.values.filter(_c);this._contextStore.update(n.map(o=>({selection:o,...Fs(o)})),i,o=>o.id),this.notifySubscribers()});d(this,"maybeHandleDelete",({editor:n})=>{if(n.state.selection.empty&&n.state.selection.$anchor.pos===1&&this.recentActiveItems.length>0){const i=this.recentActiveItems[0];return this.markInactive(i),!0}return!1});d(this,"markInactive",n=>{this.markItemsInactive([n])});d(this,"markItemsInactive",n=>{n.forEach(i=>{this._contextStore.setStatus(i.id,kt.inactive)}),this.notifySubscribers()});d(this,"markAllInactive",()=>{this.markItemsInactive(this.recentActiveItems)});d(this,"markActive",n=>{this.markItemsActive([n])});d(this,"markItemsActive",n=>{n.forEach(i=>{this._contextStore.setStatus(i.id,kt.active)}),this.notifySubscribers()});d(this,"markAllActive",()=>{this.markItemsActive(this.recentInactiveItems)});d(this,"unpin",n=>{this._contextStore.unpin(n.id),this.notifySubscribers()});d(this,"togglePinned",n=>{this._contextStore.togglePinned(n.id),this.notifySubscribers()});d(this,"notifySubscribers",()=>{this.subscribers.forEach(n=>n(this))});this.clearFiles()}get files(){return this._disableContext?[]:this._contextStore.values.filter(n=>Pc(n)&&!va(n))}get recentFiles(){return this._disableContext?[]:this._contextStore.values.filter(va)}get userGuidelinesText(){var n;return((n=this._userGuidelines)==null?void 0:n.contents)??""}get selections(){return this._disableContext?[]:this._contextStore.values.filter(_c)}get folders(){return this._disableContext?[]:this._contextStore.values.filter(Nc)}get sourceFolders(){return this._disableContext?[]:this._contextStore.values.filter(ya)}get externalSources(){return this._disableContext?[]:this._contextStore.values.filter(Uc)}get userGuidelines(){return this._contextStore.values.filter(mc)}get agentMemories(){return[{...cf,status:this._enableAgentMemories?kt.active:kt.inactive,referenceCount:1}]}get activeFiles(){return this._disableContext?[]:this.files.filter(n=>n.status===kt.active)}get activeRecentFiles(){return this._disableContext?[]:this.recentFiles.filter(n=>n.status===kt.active)}get activeExternalSources(){return this._disableContext?[]:this.externalSources.filter(n=>n.status===kt.active)}get activeSelections(){return this._disableContext?[]:this.selections.filter(n=>n.status===kt.active)}get activeSourceFolders(){return this._disableContext?[]:this.sourceFolders.filter(n=>n.status===kt.active)}get syncStatus(){return this._syncStatus.status}get syncEnabledState(){return this._syncEnabledState}get syncProgress(){var S;if(this.syncEnabledState===pc.disabled||!this._syncStatus.foldersProgress)return;const n=this._syncStatus.foldersProgress.filter(A=>A.progress!==void 0);if(n.length===0)return;const i=n.reduce((A,q)=>{var D;return A+(((D=q==null?void 0:q.progress)==null?void 0:D.trackedFiles)??0)},0),o=n.reduce((A,q)=>{var D;return A+(((D=q==null?void 0:q.progress)==null?void 0:D.backlogSize)??0)},0),l=Math.max(i,0),f=Math.min(Math.max(o,0),l),_=l-f,b=[];for(const A of n)(S=A==null?void 0:A.progress)!=null&&S.newlyTracked&&b.push(A.folderRoot);return{status:this._syncStatus.status,totalFiles:l,syncedCount:_,backlogSize:f,newlyTrackedFolders:b}}get contextCounts(){return this._contextStore.values.length??0}get chatActiveContext(){return{userSpecifiedFiles:this.activeFiles.map(n=>({rootPath:n.file.repoRoot,relPath:n.file.pathName})),recentFiles:this.activeRecentFiles.map(n=>({rootPath:n.recentFile.repoRoot,relPath:n.recentFile.pathName})),externalSources:this.activeExternalSources.map(n=>n.externalSource),selections:this.activeSelections.map(n=>n.selection),sourceFolders:this.activeSourceFolders.map(n=>({rootPath:n.sourceFolder.folderRoot,relPath:""}))}}get recentItems(){return this._disableContext?this.userGuidelines:[...this._contextStore.values.filter(n=>!ya(n)&&!mc(n)&&!Aa(n)),...this.sourceFolders,...this.userGuidelines,...this.agentMemories]}get recentActiveItems(){return this.recentItems.filter(n=>n.status===kt.active)}get recentInactiveItems(){return this.recentItems.filter(n=>n.status===kt.inactive)}get isContextDisabled(){return this._disableContext}}class Rf{constructor(){d(this,"_cache",new xa({max:1e3}));d(this,"peekKey",n=>this._cache.get(n,{updateAgeOnGet:!1}));d(this,"clear",()=>{this._cache.clear()});d(this,"update",(n,i,o)=>{n.forEach(l=>this.addInPlace(l,o)),i.forEach(l=>this.removeInPlace(l,o))});d(this,"removeFromStore",(n,i)=>{const o=i(n);this._cache.delete(o)});d(this,"addInPlace",(n,i)=>{const o=i(n),l=n.referenceCount??1,f=this._cache.get(o),_=n.status??(f==null?void 0:f.status)??kt.active;f?(f.referenceCount+=l,f.status=_,f.pinned=n.pinned??f.pinned,f.showWarning=n.showWarning??f.showWarning):this._cache.set(o,{...n,pinned:void 0,referenceCount:l,status:_})});d(this,"removeInPlace",(n,i)=>{const o=i(n),l=this._cache.get(o);l&&(l.referenceCount-=1,l.referenceCount===0&&this._cache.delete(o))});d(this,"setStatus",(n,i)=>{const o=this._cache.get(n);o&&(o.status=i)});d(this,"togglePinned",n=>{const i=this._cache.peek(n);i&&(i.pinned?this.unpin(n):this.pin(n))});d(this,"pin",n=>{const i=this._cache.peek(n);i&&!i.pinned&&(i.pinned=!0,i.referenceCount+=1)});d(this,"unpin",n=>{const i=this._cache.peek(n);i&&i.pinned&&(i.pinned=!1,i.referenceCount-=1,i.referenceCount===0&&this._cache.delete(n))});d(this,"toggleStatus",n=>{const i=this._cache.get(n);i&&(i.status=i.status===kt.active?kt.inactive:kt.active)})}get store(){return Object.fromEntries(this._cache.entries())}get values(){return[...this._cache.values()]}}function qf(s){let n,i;return{c(){n=nr("svg"),i=nr("path"),ct(i,"fill-rule","evenodd"),ct(i,"clip-rule","evenodd"),ct(i,"d","M5 2V1H10V2H5ZM4.75 0C4.33579 0 4 0.335786 4 0.75V1H3.5C2.67157 1 2 1.67157 2 2.5V12.5C2 13.3284 2.67157 14 3.5 14H7V13H3.5C3.22386 13 3 12.7761 3 12.5V2.5C3 2.22386 3.22386 2 3.5 2H4V2.25C4 2.66421 4.33579 3 4.75 3H10.25C10.6642 3 11 2.66421 11 2.25V2H11.5C11.7761 2 12 2.22386 12 2.5V7H13V2.5C13 1.67157 12.3284 1 11.5 1H11V0.75C11 0.335786 10.6642 0 10.25 0H4.75ZM9 8.5C9 8.77614 8.77614 9 8.5 9C8.22386 9 8 8.77614 8 8.5C8 8.22386 8.22386 8 8.5 8C8.77614 8 9 8.22386 9 8.5ZM10.5 9C10.7761 9 11 8.77614 11 8.5C11 8.22386 10.7761 8 10.5 8C10.2239 8 10 8.22386 10 8.5C10 8.77614 10.2239 9 10.5 9ZM13 8.5C13 8.77614 12.7761 9 12.5 9C12.2239 9 12 8.77614 12 8.5C12 8.22386 12.2239 8 12.5 8C12.7761 8 13 8.22386 13 8.5ZM14.5 9C14.7761 9 15 8.77614 15 8.5C15 8.22386 14.7761 8 14.5 8C14.2239 8 14 8.22386 14 8.5C14 8.77614 14.2239 9 14.5 9ZM15 10.5C15 10.7761 14.7761 11 14.5 11C14.2239 11 14 10.7761 14 10.5C14 10.2239 14.2239 10 14.5 10C14.7761 10 15 10.2239 15 10.5ZM14.5 13C14.7761 13 15 12.7761 15 12.5C15 12.2239 14.7761 12 14.5 12C14.2239 12 14 12.2239 14 12.5C14 12.7761 14.2239 13 14.5 13ZM14.5 15C14.7761 15 15 14.7761 15 14.5C15 14.2239 14.7761 14 14.5 14C14.2239 14 14 14.2239 14 14.5C14 14.7761 14.2239 15 14.5 15ZM8.5 11C8.77614 11 9 10.7761 9 10.5C9 10.2239 8.77614 10 8.5 10C8.22386 10 8 10.2239 8 10.5C8 10.7761 8.22386 11 8.5 11ZM9 12.5C9 12.7761 8.77614 13 8.5 13C8.22386 13 8 12.7761 8 12.5C8 12.2239 8.22386 12 8.5 12C8.77614 12 9 12.2239 9 12.5ZM8.5 15C8.77614 15 9 14.7761 9 14.5C9 14.2239 8.77614 14 8.5 14C8.22386 14 8 14.2239 8 14.5C8 14.7761 8.22386 15 8.5 15ZM11 14.5C11 14.7761 10.7761 15 10.5 15C10.2239 15 10 14.7761 10 14.5C10 14.2239 10.2239 14 10.5 14C10.7761 14 11 14.2239 11 14.5ZM12.5 15C12.7761 15 13 14.7761 13 14.5C13 14.2239 12.7761 14 12.5 14C12.2239 14 12 14.2239 12 14.5C12 14.7761 12.2239 15 12.5 15Z"),ct(i,"fill","currentColor"),ct(n,"width","15"),ct(n,"height","15"),ct(n,"viewBox","0 0 15 15"),ct(n,"fill","none"),ct(n,"xmlns","http://www.w3.org/2000/svg")},m(o,l){Tr(o,n,l),je(n,i)},p:tn,i:tn,o:tn,d(o){o&&Mr(n)}}}class xg extends Ps{constructor(n){super(),Ns(this,n,null,qf,Us,{})}}var Ms,As,Ma={exports:{}};Ms=Ma,As=Ma.exports,(function(){var s,n="Expected a function",i="__lodash_hash_undefined__",o="__lodash_placeholder__",l=16,f=32,_=64,b=128,S=256,A=1/0,q=9007199254740991,D=NaN,tt=4294967295,et=[["ary",b],["bind",1],["bindKey",2],["curry",8],["curryRight",l],["flip",512],["partial",f],["partialRight",_],["rearg",S]],N="[object Arguments]",rt="[object Array]",vt="[object Boolean]",z="[object Date]",dt="[object Error]",ze="[object Function]",ne="[object GeneratorFunction]",bt="[object Map]",Ce="[object Number]",Rt="[object Object]",Ge="[object Promise]",ke="[object RegExp]",xe="[object Set]",rr="[object String]",Ar="[object Symbol]",sr="[object WeakMap]",ir="[object ArrayBuffer]",qn="[object DataView]",Hs="[object Float32Array]",js="[object Float64Array]",zs="[object Int8Array]",Gs="[object Int16Array]",Ws="[object Int32Array]",Bs="[object Uint8Array]",$s="[object Uint8ClampedArray]",Vs="[object Uint16Array]",Zs="[object Uint32Array]",Zc=/\b__p \+= '';/g,Yc=/\b(__p \+=) '' \+/g,Jc=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Oa=/&(?:amp|lt|gt|quot|#39);/g,Da=/[&<>"']/g,Kc=RegExp(Oa.source),Xc=RegExp(Da.source),Qc=/<%-([\s\S]+?)%>/g,tl=/<%([\s\S]+?)%>/g,ka=/<%=([\s\S]+?)%>/g,el=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,nl=/^\w*$/,rl=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ys=/[\\^$.*+?()[\]{}|]/g,sl=RegExp(Ys.source),Js=/^\s+/,il=/\s/,al=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ol=/\{\n\/\* \[wrapped with (.+)\] \*/,ul=/,? & /,cl=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ll=/[()=,{}\[\]\/\s]/,hl=/\\(\\)?/g,dl=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Pa=/\w*$/,fl=/^[-+]0x[0-9a-f]+$/i,gl=/^0b[01]+$/i,pl=/^\[object .+?Constructor\]$/,_l=/^0o[0-7]+$/i,ml=/^(?:0|[1-9]\d*)$/,vl=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Fr=/($^)/,yl=/['\n\r\u2028\u2029\\]/g,Rr="\\ud800-\\udfff",Na="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Ua="\\u2700-\\u27bf",La="a-z\\xdf-\\xf6\\xf8-\\xff",Ha="A-Z\\xc0-\\xd6\\xd8-\\xde",ja="\\ufe0e\\ufe0f",za="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",bl="['’]",Sl="["+Rr+"]",Ga="["+za+"]",qr="["+Na+"]",Wa="\\d+",Cl="["+Ua+"]",Ba="["+La+"]",$a="[^"+Rr+za+Wa+Ua+La+Ha+"]",Ks="\\ud83c[\\udffb-\\udfff]",Va="[^"+Rr+"]",Xs="(?:\\ud83c[\\udde6-\\uddff]){2}",Qs="[\\ud800-\\udbff][\\udc00-\\udfff]",On="["+Ha+"]",Za="\\u200d",Ya="(?:"+Ba+"|"+$a+")",xl="(?:"+On+"|"+$a+")",Ja="(?:['’](?:d|ll|m|re|s|t|ve))?",Ka="(?:['’](?:D|LL|M|RE|S|T|VE))?",Xa="(?:"+qr+"|"+Ks+")?",Qa="["+ja+"]?",to=Qa+Xa+"(?:"+Za+"(?:"+[Va,Xs,Qs].join("|")+")"+Qa+Xa+")*",wl="(?:"+[Cl,Xs,Qs].join("|")+")"+to,Il="(?:"+[Va+qr+"?",qr,Xs,Qs,Sl].join("|")+")",El=RegExp(bl,"g"),Tl=RegExp(qr,"g"),ti=RegExp(Ks+"(?="+Ks+")|"+Il+to,"g"),Ml=RegExp([On+"?"+Ba+"+"+Ja+"(?="+[Ga,On,"$"].join("|")+")",xl+"+"+Ka+"(?="+[Ga,On+Ya,"$"].join("|")+")",On+"?"+Ya+"+"+Ja,On+"+"+Ka,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Wa,wl].join("|"),"g"),Al=RegExp("["+Za+Rr+Na+ja+"]"),Fl=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Rl=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ql=-1,ft={};ft[Hs]=ft[js]=ft[zs]=ft[Gs]=ft[Ws]=ft[Bs]=ft[$s]=ft[Vs]=ft[Zs]=!0,ft[N]=ft[rt]=ft[ir]=ft[vt]=ft[qn]=ft[z]=ft[dt]=ft[ze]=ft[bt]=ft[Ce]=ft[Rt]=ft[ke]=ft[xe]=ft[rr]=ft[sr]=!1;var ht={};ht[N]=ht[rt]=ht[ir]=ht[qn]=ht[vt]=ht[z]=ht[Hs]=ht[js]=ht[zs]=ht[Gs]=ht[Ws]=ht[bt]=ht[Ce]=ht[Rt]=ht[ke]=ht[xe]=ht[rr]=ht[Ar]=ht[Bs]=ht[$s]=ht[Vs]=ht[Zs]=!0,ht[dt]=ht[ze]=ht[sr]=!1;var Ol={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Dl=parseFloat,kl=parseInt,eo=typeof Sr=="object"&&Sr&&Sr.Object===Object&&Sr,Pl=typeof self=="object"&&self&&self.Object===Object&&self,Nt=eo||Pl||Function("return this")(),ei=As&&!As.nodeType&&As,mn=ei&&Ms&&!Ms.nodeType&&Ms,no=mn&&mn.exports===ei,ni=no&&eo.process,ge=function(){try{var y=mn&&mn.require&&mn.require("util").types;return y||ni&&ni.binding&&ni.binding("util")}catch{}}(),ro=ge&&ge.isArrayBuffer,so=ge&&ge.isDate,io=ge&&ge.isMap,ao=ge&&ge.isRegExp,oo=ge&&ge.isSet,uo=ge&&ge.isTypedArray;function re(y,I,E){switch(E.length){case 0:return y.call(I);case 1:return y.call(I,E[0]);case 2:return y.call(I,E[0],E[1]);case 3:return y.call(I,E[0],E[1],E[2])}return y.apply(I,E)}function Nl(y,I,E,O){for(var Z=-1,st=y==null?0:y.length;++Z<st;){var Tt=y[Z];I(O,Tt,E(Tt),y)}return O}function pe(y,I){for(var E=-1,O=y==null?0:y.length;++E<O&&I(y[E],E,y)!==!1;);return y}function Ul(y,I){for(var E=y==null?0:y.length;E--&&I(y[E],E,y)!==!1;);return y}function co(y,I){for(var E=-1,O=y==null?0:y.length;++E<O;)if(!I(y[E],E,y))return!1;return!0}function en(y,I){for(var E=-1,O=y==null?0:y.length,Z=0,st=[];++E<O;){var Tt=y[E];I(Tt,E,y)&&(st[Z++]=Tt)}return st}function Or(y,I){return!(y==null||!y.length)&&Dn(y,I,0)>-1}function ri(y,I,E){for(var O=-1,Z=y==null?0:y.length;++O<Z;)if(E(I,y[O]))return!0;return!1}function yt(y,I){for(var E=-1,O=y==null?0:y.length,Z=Array(O);++E<O;)Z[E]=I(y[E],E,y);return Z}function nn(y,I){for(var E=-1,O=I.length,Z=y.length;++E<O;)y[Z+E]=I[E];return y}function si(y,I,E,O){var Z=-1,st=y==null?0:y.length;for(O&&st&&(E=y[++Z]);++Z<st;)E=I(E,y[Z],Z,y);return E}function Ll(y,I,E,O){var Z=y==null?0:y.length;for(O&&Z&&(E=y[--Z]);Z--;)E=I(E,y[Z],Z,y);return E}function ii(y,I){for(var E=-1,O=y==null?0:y.length;++E<O;)if(I(y[E],E,y))return!0;return!1}var Hl=ai("length");function lo(y,I,E){var O;return E(y,function(Z,st,Tt){if(I(Z,st,Tt))return O=st,!1}),O}function Dr(y,I,E,O){for(var Z=y.length,st=E+(O?1:-1);O?st--:++st<Z;)if(I(y[st],st,y))return st;return-1}function Dn(y,I,E){return I==I?function(O,Z,st){for(var Tt=st-1,Pe=O.length;++Tt<Pe;)if(O[Tt]===Z)return Tt;return-1}(y,I,E):Dr(y,ho,E)}function jl(y,I,E,O){for(var Z=E-1,st=y.length;++Z<st;)if(O(y[Z],I))return Z;return-1}function ho(y){return y!=y}function fo(y,I){var E=y==null?0:y.length;return E?ui(y,I)/E:D}function ai(y){return function(I){return I==null?s:I[y]}}function oi(y){return function(I){return y==null?s:y[I]}}function go(y,I,E,O,Z){return Z(y,function(st,Tt,Pe){E=O?(O=!1,st):I(E,st,Tt,Pe)}),E}function ui(y,I){for(var E,O=-1,Z=y.length;++O<Z;){var st=I(y[O]);st!==s&&(E=E===s?st:E+st)}return E}function ci(y,I){for(var E=-1,O=Array(y);++E<y;)O[E]=I(E);return O}function po(y){return y&&y.slice(0,yo(y)+1).replace(Js,"")}function se(y){return function(I){return y(I)}}function li(y,I){return yt(I,function(E){return y[E]})}function ar(y,I){return y.has(I)}function _o(y,I){for(var E=-1,O=y.length;++E<O&&Dn(I,y[E],0)>-1;);return E}function mo(y,I){for(var E=y.length;E--&&Dn(I,y[E],0)>-1;);return E}var zl=oi({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),Gl=oi({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Wl(y){return"\\"+Ol[y]}function kn(y){return Al.test(y)}function hi(y){var I=-1,E=Array(y.size);return y.forEach(function(O,Z){E[++I]=[Z,O]}),E}function vo(y,I){return function(E){return y(I(E))}}function rn(y,I){for(var E=-1,O=y.length,Z=0,st=[];++E<O;){var Tt=y[E];Tt!==I&&Tt!==o||(y[E]=o,st[Z++]=E)}return st}function kr(y){var I=-1,E=Array(y.size);return y.forEach(function(O){E[++I]=O}),E}function Bl(y){var I=-1,E=Array(y.size);return y.forEach(function(O){E[++I]=[O,O]}),E}function Pn(y){return kn(y)?function(I){for(var E=ti.lastIndex=0;ti.test(I);)++E;return E}(y):Hl(y)}function we(y){return kn(y)?function(I){return I.match(ti)||[]}(y):function(I){return I.split("")}(y)}function yo(y){for(var I=y.length;I--&&il.test(y.charAt(I)););return I}var $l=oi({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),Nn=function y(I){var E,O=(I=I==null?Nt:Nn.defaults(Nt.Object(),I,Nn.pick(Nt,Rl))).Array,Z=I.Date,st=I.Error,Tt=I.Function,Pe=I.Math,gt=I.Object,di=I.RegExp,Vl=I.String,_e=I.TypeError,Pr=O.prototype,Zl=Tt.prototype,Un=gt.prototype,Nr=I["__core-js_shared__"],Ur=Zl.toString,lt=Un.hasOwnProperty,Yl=0,bo=(E=/[^.]+$/.exec(Nr&&Nr.keys&&Nr.keys.IE_PROTO||""))?"Symbol(src)_1."+E:"",Lr=Un.toString,Jl=Ur.call(gt),Kl=Nt._,Xl=di("^"+Ur.call(lt).replace(Ys,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Hr=no?I.Buffer:s,sn=I.Symbol,jr=I.Uint8Array,So=Hr?Hr.allocUnsafe:s,zr=vo(gt.getPrototypeOf,gt),Co=gt.create,xo=Un.propertyIsEnumerable,Gr=Pr.splice,wo=sn?sn.isConcatSpreadable:s,or=sn?sn.iterator:s,vn=sn?sn.toStringTag:s,Wr=function(){try{var t=xn(gt,"defineProperty");return t({},"",{}),t}catch{}}(),Ql=I.clearTimeout!==Nt.clearTimeout&&I.clearTimeout,th=Z&&Z.now!==Nt.Date.now&&Z.now,eh=I.setTimeout!==Nt.setTimeout&&I.setTimeout,Br=Pe.ceil,$r=Pe.floor,fi=gt.getOwnPropertySymbols,nh=Hr?Hr.isBuffer:s,Io=I.isFinite,rh=Pr.join,sh=vo(gt.keys,gt),Mt=Pe.max,Ht=Pe.min,ih=Z.now,ah=I.parseInt,Eo=Pe.random,oh=Pr.reverse,gi=xn(I,"DataView"),ur=xn(I,"Map"),pi=xn(I,"Promise"),Ln=xn(I,"Set"),cr=xn(I,"WeakMap"),lr=xn(gt,"create"),Vr=cr&&new cr,Hn={},uh=wn(gi),ch=wn(ur),lh=wn(pi),hh=wn(Ln),dh=wn(cr),Zr=sn?sn.prototype:s,hr=Zr?Zr.valueOf:s,To=Zr?Zr.toString:s;function c(t){if(Ct(t)&&!K(t)&&!(t instanceof nt)){if(t instanceof me)return t;if(lt.call(t,"__wrapped__"))return Mu(t)}return new me(t)}var jn=function(){function t(){}return function(e){if(!St(e))return{};if(Co)return Co(e);t.prototype=e;var r=new t;return t.prototype=s,r}}();function Yr(){}function me(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=s}function nt(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=tt,this.__views__=[]}function yn(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var a=t[e];this.set(a[0],a[1])}}function We(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var a=t[e];this.set(a[0],a[1])}}function Be(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var a=t[e];this.set(a[0],a[1])}}function bn(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new Be;++e<r;)this.add(t[e])}function Ie(t){var e=this.__data__=new We(t);this.size=e.size}function Mo(t,e){var r=K(t),a=!r&&In(t),u=!r&&!a&&ln(t),h=!r&&!a&&!u&&Bn(t),p=r||a||u||h,m=p?ci(t.length,Vl):[],v=m.length;for(var x in t)!e&&!lt.call(t,x)||p&&(x=="length"||u&&(x=="offset"||x=="parent")||h&&(x=="buffer"||x=="byteLength"||x=="byteOffset")||Ye(x,v))||m.push(x);return m}function Ao(t){var e=t.length;return e?t[Ei(0,e-1)]:s}function fh(t,e){return cs(Jt(t),Sn(e,0,t.length))}function gh(t){return cs(Jt(t))}function _i(t,e,r){(r!==s&&!Ee(t[e],r)||r===s&&!(e in t))&&$e(t,e,r)}function dr(t,e,r){var a=t[e];lt.call(t,e)&&Ee(a,r)&&(r!==s||e in t)||$e(t,e,r)}function Jr(t,e){for(var r=t.length;r--;)if(Ee(t[r][0],e))return r;return-1}function ph(t,e,r,a){return an(t,function(u,h,p){e(a,u,r(u),p)}),a}function Fo(t,e){return t&&Ue(e,qt(e),t)}function $e(t,e,r){e=="__proto__"&&Wr?Wr(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function mi(t,e){for(var r=-1,a=e.length,u=O(a),h=t==null;++r<a;)u[r]=h?s:Ki(t,e[r]);return u}function Sn(t,e,r){return t==t&&(r!==s&&(t=t<=r?t:r),e!==s&&(t=t>=e?t:e)),t}function ve(t,e,r,a,u,h){var p,m=1&e,v=2&e,x=4&e;if(r&&(p=u?r(t,a,u,h):r(t)),p!==s)return p;if(!St(t))return t;var C=K(t);if(C){if(p=function(w){var M=w.length,B=new w.constructor(M);return M&&typeof w[0]=="string"&&lt.call(w,"index")&&(B.index=w.index,B.input=w.input),B}(t),!m)return Jt(t,p)}else{var T=jt(t),P=T==ze||T==ne;if(ln(t))return tu(t,m);if(T==Rt||T==N||P&&!u){if(p=v||P?{}:yu(t),!m)return v?function(w,M){return Ue(w,mu(w),M)}(t,function(w,M){return w&&Ue(M,Xt(M),w)}(p,t)):function(w,M){return Ue(w,Hi(w),M)}(t,Fo(p,t))}else{if(!ht[T])return u?t:{};p=function(w,M,B){var R,Y=w.constructor;switch(M){case ir:return Oi(w);case vt:case z:return new Y(+w);case qn:return function(V,at){var H=at?Oi(V.buffer):V.buffer;return new V.constructor(H,V.byteOffset,V.byteLength)}(w,B);case Hs:case js:case zs:case Gs:case Ws:case Bs:case $s:case Vs:case Zs:return eu(w,B);case bt:return new Y;case Ce:case rr:return new Y(w);case ke:return function(V){var at=new V.constructor(V.source,Pa.exec(V));return at.lastIndex=V.lastIndex,at}(w);case xe:return new Y;case Ar:return R=w,hr?gt(hr.call(R)):{}}}(t,T,m)}}h||(h=new Ie);var L=h.get(t);if(L)return L;h.set(t,p),$u(t)?t.forEach(function(w){p.add(ve(w,e,r,w,t,h))}):Wu(t)&&t.forEach(function(w,M){p.set(M,ve(w,e,r,M,t,h))});var j=C?s:(x?v?Ni:Pi:v?Xt:qt)(t);return pe(j||t,function(w,M){j&&(w=t[M=w]),dr(p,M,ve(w,e,r,M,t,h))}),p}function Ro(t,e,r){var a=r.length;if(t==null)return!a;for(t=gt(t);a--;){var u=r[a],h=e[u],p=t[u];if(p===s&&!(u in t)||!h(p))return!1}return!0}function qo(t,e,r){if(typeof t!="function")throw new _e(n);return yr(function(){t.apply(s,r)},e)}function fr(t,e,r,a){var u=-1,h=Or,p=!0,m=t.length,v=[],x=e.length;if(!m)return v;r&&(e=yt(e,se(r))),a?(h=ri,p=!1):e.length>=200&&(h=ar,p=!1,e=new bn(e));t:for(;++u<m;){var C=t[u],T=r==null?C:r(C);if(C=a||C!==0?C:0,p&&T==T){for(var P=x;P--;)if(e[P]===T)continue t;v.push(C)}else h(e,T,a)||v.push(C)}return v}c.templateSettings={escape:Qc,evaluate:tl,interpolate:ka,variable:"",imports:{_:c}},c.prototype=Yr.prototype,c.prototype.constructor=c,me.prototype=jn(Yr.prototype),me.prototype.constructor=me,nt.prototype=jn(Yr.prototype),nt.prototype.constructor=nt,yn.prototype.clear=function(){this.__data__=lr?lr(null):{},this.size=0},yn.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},yn.prototype.get=function(t){var e=this.__data__;if(lr){var r=e[t];return r===i?s:r}return lt.call(e,t)?e[t]:s},yn.prototype.has=function(t){var e=this.__data__;return lr?e[t]!==s:lt.call(e,t)},yn.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=lr&&e===s?i:e,this},We.prototype.clear=function(){this.__data__=[],this.size=0},We.prototype.delete=function(t){var e=this.__data__,r=Jr(e,t);return!(r<0||(r==e.length-1?e.pop():Gr.call(e,r,1),--this.size,0))},We.prototype.get=function(t){var e=this.__data__,r=Jr(e,t);return r<0?s:e[r][1]},We.prototype.has=function(t){return Jr(this.__data__,t)>-1},We.prototype.set=function(t,e){var r=this.__data__,a=Jr(r,t);return a<0?(++this.size,r.push([t,e])):r[a][1]=e,this},Be.prototype.clear=function(){this.size=0,this.__data__={hash:new yn,map:new(ur||We),string:new yn}},Be.prototype.delete=function(t){var e=us(this,t).delete(t);return this.size-=e?1:0,e},Be.prototype.get=function(t){return us(this,t).get(t)},Be.prototype.has=function(t){return us(this,t).has(t)},Be.prototype.set=function(t,e){var r=us(this,t),a=r.size;return r.set(t,e),this.size+=r.size==a?0:1,this},bn.prototype.add=bn.prototype.push=function(t){return this.__data__.set(t,i),this},bn.prototype.has=function(t){return this.__data__.has(t)},Ie.prototype.clear=function(){this.__data__=new We,this.size=0},Ie.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},Ie.prototype.get=function(t){return this.__data__.get(t)},Ie.prototype.has=function(t){return this.__data__.has(t)},Ie.prototype.set=function(t,e){var r=this.__data__;if(r instanceof We){var a=r.__data__;if(!ur||a.length<199)return a.push([t,e]),this.size=++r.size,this;r=this.__data__=new Be(a)}return r.set(t,e),this.size=r.size,this};var an=iu(Ne),Oo=iu(yi,!0);function _h(t,e){var r=!0;return an(t,function(a,u,h){return r=!!e(a,u,h)}),r}function Kr(t,e,r){for(var a=-1,u=t.length;++a<u;){var h=t[a],p=e(h);if(p!=null&&(m===s?p==p&&!ae(p):r(p,m)))var m=p,v=h}return v}function Do(t,e){var r=[];return an(t,function(a,u,h){e(a,u,h)&&r.push(a)}),r}function Ut(t,e,r,a,u){var h=-1,p=t.length;for(r||(r=Mh),u||(u=[]);++h<p;){var m=t[h];e>0&&r(m)?e>1?Ut(m,e-1,r,a,u):nn(u,m):a||(u[u.length]=m)}return u}var vi=au(),ko=au(!0);function Ne(t,e){return t&&vi(t,e,qt)}function yi(t,e){return t&&ko(t,e,qt)}function Xr(t,e){return en(e,function(r){return Je(t[r])})}function Cn(t,e){for(var r=0,a=(e=un(e,t)).length;t!=null&&r<a;)t=t[Le(e[r++])];return r&&r==a?t:s}function Po(t,e,r){var a=e(t);return K(t)?a:nn(a,r(t))}function Bt(t){return t==null?t===s?"[object Undefined]":"[object Null]":vn&&vn in gt(t)?function(e){var r=lt.call(e,vn),a=e[vn];try{e[vn]=s;var u=!0}catch{}var h=Lr.call(e);return u&&(r?e[vn]=a:delete e[vn]),h}(t):function(e){return Lr.call(e)}(t)}function bi(t,e){return t>e}function mh(t,e){return t!=null&&lt.call(t,e)}function vh(t,e){return t!=null&&e in gt(t)}function Si(t,e,r){for(var a=r?ri:Or,u=t[0].length,h=t.length,p=h,m=O(h),v=1/0,x=[];p--;){var C=t[p];p&&e&&(C=yt(C,se(e))),v=Ht(C.length,v),m[p]=!r&&(e||u>=120&&C.length>=120)?new bn(p&&C):s}C=t[0];var T=-1,P=m[0];t:for(;++T<u&&x.length<v;){var L=C[T],j=e?e(L):L;if(L=r||L!==0?L:0,!(P?ar(P,j):a(x,j,r))){for(p=h;--p;){var w=m[p];if(!(w?ar(w,j):a(t[p],j,r)))continue t}P&&P.push(j),x.push(L)}}return x}function gr(t,e,r){var a=(t=xu(t,e=un(e,t)))==null?t:t[Le(be(e))];return a==null?s:re(a,t,r)}function No(t){return Ct(t)&&Bt(t)==N}function pr(t,e,r,a,u){return t===e||(t==null||e==null||!Ct(t)&&!Ct(e)?t!=t&&e!=e:function(h,p,m,v,x,C){var T=K(h),P=K(p),L=T?rt:jt(h),j=P?rt:jt(p),w=(L=L==N?Rt:L)==Rt,M=(j=j==N?Rt:j)==Rt,B=L==j;if(B&&ln(h)){if(!ln(p))return!1;T=!0,w=!1}if(B&&!w)return C||(C=new Ie),T||Bn(h)?_u(h,p,m,v,x,C):function(H,$,At,It,Vt,pt,zt){switch(At){case qn:if(H.byteLength!=$.byteLength||H.byteOffset!=$.byteOffset)return!1;H=H.buffer,$=$.buffer;case ir:return!(H.byteLength!=$.byteLength||!pt(new jr(H),new jr($)));case vt:case z:case Ce:return Ee(+H,+$);case dt:return H.name==$.name&&H.message==$.message;case ke:case rr:return H==$+"";case bt:var He=hi;case xe:var hn=1&It;if(He||(He=kr),H.size!=$.size&&!hn)return!1;var vs=zt.get(H);if(vs)return vs==$;It|=2,zt.set(H,$);var oa=_u(He(H),He($),It,Vt,pt,zt);return zt.delete(H),oa;case Ar:if(hr)return hr.call(H)==hr.call($)}return!1}(h,p,L,m,v,x,C);if(!(1&m)){var R=w&&lt.call(h,"__wrapped__"),Y=M&&lt.call(p,"__wrapped__");if(R||Y){var V=R?h.value():h,at=Y?p.value():p;return C||(C=new Ie),x(V,at,m,v,C)}}return!!B&&(C||(C=new Ie),function(H,$,At,It,Vt,pt){var zt=1&At,He=Pi(H),hn=He.length,vs=Pi($),oa=vs.length;if(hn!=oa&&!zt)return!1;for(var ys=hn;ys--;){var En=He[ys];if(!(zt?En in $:lt.call($,En)))return!1}var ac=pt.get(H),oc=pt.get($);if(ac&&oc)return ac==$&&oc==H;var bs=!0;pt.set(H,$),pt.set($,H);for(var ua=zt;++ys<hn;){var Ss=H[En=He[ys]],Cs=$[En];if(It)var uc=zt?It(Cs,Ss,En,$,H,pt):It(Ss,Cs,En,H,$,pt);if(!(uc===s?Ss===Cs||Vt(Ss,Cs,At,It,pt):uc)){bs=!1;break}ua||(ua=En=="constructor")}if(bs&&!ua){var xs=H.constructor,ws=$.constructor;xs==ws||!("constructor"in H)||!("constructor"in $)||typeof xs=="function"&&xs instanceof xs&&typeof ws=="function"&&ws instanceof ws||(bs=!1)}return pt.delete(H),pt.delete($),bs}(h,p,m,v,x,C))}(t,e,r,a,pr,u))}function Ci(t,e,r,a){var u=r.length,h=u,p=!a;if(t==null)return!h;for(t=gt(t);u--;){var m=r[u];if(p&&m[2]?m[1]!==t[m[0]]:!(m[0]in t))return!1}for(;++u<h;){var v=(m=r[u])[0],x=t[v],C=m[1];if(p&&m[2]){if(x===s&&!(v in t))return!1}else{var T=new Ie;if(a)var P=a(x,C,v,t,e,T);if(!(P===s?pr(C,x,3,a,T):P))return!1}}return!0}function Uo(t){return!(!St(t)||(e=t,bo&&bo in e))&&(Je(t)?Xl:pl).test(wn(t));var e}function Lo(t){return typeof t=="function"?t:t==null?Qt:typeof t=="object"?K(t)?zo(t[0],t[1]):jo(t):ic(t)}function xi(t){if(!vr(t))return sh(t);var e=[];for(var r in gt(t))lt.call(t,r)&&r!="constructor"&&e.push(r);return e}function yh(t){if(!St(t))return function(u){var h=[];if(u!=null)for(var p in gt(u))h.push(p);return h}(t);var e=vr(t),r=[];for(var a in t)(a!="constructor"||!e&&lt.call(t,a))&&r.push(a);return r}function wi(t,e){return t<e}function Ho(t,e){var r=-1,a=Kt(t)?O(t.length):[];return an(t,function(u,h,p){a[++r]=e(u,h,p)}),a}function jo(t){var e=Li(t);return e.length==1&&e[0][2]?Su(e[0][0],e[0][1]):function(r){return r===t||Ci(r,t,e)}}function zo(t,e){return ji(t)&&bu(e)?Su(Le(t),e):function(r){var a=Ki(r,t);return a===s&&a===e?Xi(r,t):pr(e,a,3)}}function Qr(t,e,r,a,u){t!==e&&vi(e,function(h,p){if(u||(u=new Ie),St(h))(function(v,x,C,T,P,L,j){var w=Gi(v,C),M=Gi(x,C),B=j.get(M);if(B)_i(v,C,B);else{var R=L?L(w,M,C+"",v,x,j):s,Y=R===s;if(Y){var V=K(M),at=!V&&ln(M),H=!V&&!at&&Bn(M);R=M,V||at||H?K(w)?R=w:wt(w)?R=Jt(w):at?(Y=!1,R=tu(M,!0)):H?(Y=!1,R=eu(M,!0)):R=[]:br(M)||In(M)?(R=w,In(w)?R=Yu(w):St(w)&&!Je(w)||(R=yu(M))):Y=!1}Y&&(j.set(M,R),P(R,M,T,L,j),j.delete(M)),_i(v,C,R)}})(t,e,p,r,Qr,a,u);else{var m=a?a(Gi(t,p),h,p+"",t,e,u):s;m===s&&(m=h),_i(t,p,m)}},Xt)}function Go(t,e){var r=t.length;if(r)return Ye(e+=e<0?r:0,r)?t[e]:s}function Wo(t,e,r){e=e.length?yt(e,function(h){return K(h)?function(p){return Cn(p,h.length===1?h[0]:h)}:h}):[Qt];var a=-1;e=yt(e,se(G()));var u=Ho(t,function(h,p,m){var v=yt(e,function(x){return x(h)});return{criteria:v,index:++a,value:h}});return function(h,p){var m=h.length;for(h.sort(p);m--;)h[m]=h[m].value;return h}(u,function(h,p){return function(m,v,x){for(var C=-1,T=m.criteria,P=v.criteria,L=T.length,j=x.length;++C<L;){var w=nu(T[C],P[C]);if(w)return C>=j?w:w*(x[C]=="desc"?-1:1)}return m.index-v.index}(h,p,r)})}function Bo(t,e,r){for(var a=-1,u=e.length,h={};++a<u;){var p=e[a],m=Cn(t,p);r(m,p)&&_r(h,un(p,t),m)}return h}function Ii(t,e,r,a){var u=a?jl:Dn,h=-1,p=e.length,m=t;for(t===e&&(e=Jt(e)),r&&(m=yt(t,se(r)));++h<p;)for(var v=0,x=e[h],C=r?r(x):x;(v=u(m,C,v,a))>-1;)m!==t&&Gr.call(m,v,1),Gr.call(t,v,1);return t}function $o(t,e){for(var r=t?e.length:0,a=r-1;r--;){var u=e[r];if(r==a||u!==h){var h=u;Ye(u)?Gr.call(t,u,1):Ai(t,u)}}return t}function Ei(t,e){return t+$r(Eo()*(e-t+1))}function Ti(t,e){var r="";if(!t||e<1||e>q)return r;do e%2&&(r+=t),(e=$r(e/2))&&(t+=t);while(e);return r}function Q(t,e){return Wi(Cu(t,e,Qt),t+"")}function bh(t){return Ao($n(t))}function Sh(t,e){var r=$n(t);return cs(r,Sn(e,0,r.length))}function _r(t,e,r,a){if(!St(t))return t;for(var u=-1,h=(e=un(e,t)).length,p=h-1,m=t;m!=null&&++u<h;){var v=Le(e[u]),x=r;if(v==="__proto__"||v==="constructor"||v==="prototype")return t;if(u!=p){var C=m[v];(x=a?a(C,v,m):s)===s&&(x=St(C)?C:Ye(e[u+1])?[]:{})}dr(m,v,x),m=m[v]}return t}var Vo=Vr?function(t,e){return Vr.set(t,e),t}:Qt,Ch=Wr?function(t,e){return Wr(t,"toString",{configurable:!0,enumerable:!1,value:ta(e),writable:!0})}:Qt;function xh(t){return cs($n(t))}function ye(t,e,r){var a=-1,u=t.length;e<0&&(e=-e>u?0:u+e),(r=r>u?u:r)<0&&(r+=u),u=e>r?0:r-e>>>0,e>>>=0;for(var h=O(u);++a<u;)h[a]=t[a+e];return h}function wh(t,e){var r;return an(t,function(a,u,h){return!(r=e(a,u,h))}),!!r}function ts(t,e,r){var a=0,u=t==null?a:t.length;if(typeof e=="number"&&e==e&&u<=2147483647){for(;a<u;){var h=a+u>>>1,p=t[h];p!==null&&!ae(p)&&(r?p<=e:p<e)?a=h+1:u=h}return u}return Mi(t,e,Qt,r)}function Mi(t,e,r,a){var u=0,h=t==null?0:t.length;if(h===0)return 0;for(var p=(e=r(e))!=e,m=e===null,v=ae(e),x=e===s;u<h;){var C=$r((u+h)/2),T=r(t[C]),P=T!==s,L=T===null,j=T==T,w=ae(T);if(p)var M=a||j;else M=x?j&&(a||P):m?j&&P&&(a||!L):v?j&&P&&!L&&(a||!w):!L&&!w&&(a?T<=e:T<e);M?u=C+1:h=C}return Ht(h,4294967294)}function Zo(t,e){for(var r=-1,a=t.length,u=0,h=[];++r<a;){var p=t[r],m=e?e(p):p;if(!r||!Ee(m,v)){var v=m;h[u++]=p===0?0:p}}return h}function Yo(t){return typeof t=="number"?t:ae(t)?D:+t}function ie(t){if(typeof t=="string")return t;if(K(t))return yt(t,ie)+"";if(ae(t))return To?To.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function on(t,e,r){var a=-1,u=Or,h=t.length,p=!0,m=[],v=m;if(r)p=!1,u=ri;else if(h>=200){var x=e?null:Eh(t);if(x)return kr(x);p=!1,u=ar,v=new bn}else v=e?[]:m;t:for(;++a<h;){var C=t[a],T=e?e(C):C;if(C=r||C!==0?C:0,p&&T==T){for(var P=v.length;P--;)if(v[P]===T)continue t;e&&v.push(T),m.push(C)}else u(v,T,r)||(v!==m&&v.push(T),m.push(C))}return m}function Ai(t,e){return(t=xu(t,e=un(e,t)))==null||delete t[Le(be(e))]}function Jo(t,e,r,a){return _r(t,e,r(Cn(t,e)),a)}function es(t,e,r,a){for(var u=t.length,h=a?u:-1;(a?h--:++h<u)&&e(t[h],h,t););return r?ye(t,a?0:h,a?h+1:u):ye(t,a?h+1:0,a?u:h)}function Ko(t,e){var r=t;return r instanceof nt&&(r=r.value()),si(e,function(a,u){return u.func.apply(u.thisArg,nn([a],u.args))},r)}function Fi(t,e,r){var a=t.length;if(a<2)return a?on(t[0]):[];for(var u=-1,h=O(a);++u<a;)for(var p=t[u],m=-1;++m<a;)m!=u&&(h[u]=fr(h[u]||p,t[m],e,r));return on(Ut(h,1),e,r)}function Xo(t,e,r){for(var a=-1,u=t.length,h=e.length,p={};++a<u;){var m=a<h?e[a]:s;r(p,t[a],m)}return p}function Ri(t){return wt(t)?t:[]}function qi(t){return typeof t=="function"?t:Qt}function un(t,e){return K(t)?t:ji(t,e)?[t]:Tu(ot(t))}var Ih=Q;function cn(t,e,r){var a=t.length;return r=r===s?a:r,!e&&r>=a?t:ye(t,e,r)}var Qo=Ql||function(t){return Nt.clearTimeout(t)};function tu(t,e){if(e)return t.slice();var r=t.length,a=So?So(r):new t.constructor(r);return t.copy(a),a}function Oi(t){var e=new t.constructor(t.byteLength);return new jr(e).set(new jr(t)),e}function eu(t,e){var r=e?Oi(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}function nu(t,e){if(t!==e){var r=t!==s,a=t===null,u=t==t,h=ae(t),p=e!==s,m=e===null,v=e==e,x=ae(e);if(!m&&!x&&!h&&t>e||h&&p&&v&&!m&&!x||a&&p&&v||!r&&v||!u)return 1;if(!a&&!h&&!x&&t<e||x&&r&&u&&!a&&!h||m&&r&&u||!p&&u||!v)return-1}return 0}function ru(t,e,r,a){for(var u=-1,h=t.length,p=r.length,m=-1,v=e.length,x=Mt(h-p,0),C=O(v+x),T=!a;++m<v;)C[m]=e[m];for(;++u<p;)(T||u<h)&&(C[r[u]]=t[u]);for(;x--;)C[m++]=t[u++];return C}function su(t,e,r,a){for(var u=-1,h=t.length,p=-1,m=r.length,v=-1,x=e.length,C=Mt(h-m,0),T=O(C+x),P=!a;++u<C;)T[u]=t[u];for(var L=u;++v<x;)T[L+v]=e[v];for(;++p<m;)(P||u<h)&&(T[L+r[p]]=t[u++]);return T}function Jt(t,e){var r=-1,a=t.length;for(e||(e=O(a));++r<a;)e[r]=t[r];return e}function Ue(t,e,r,a){var u=!r;r||(r={});for(var h=-1,p=e.length;++h<p;){var m=e[h],v=a?a(r[m],t[m],m,r,t):s;v===s&&(v=t[m]),u?$e(r,m,v):dr(r,m,v)}return r}function ns(t,e){return function(r,a){var u=K(r)?Nl:ph,h=e?e():{};return u(r,t,G(a,2),h)}}function zn(t){return Q(function(e,r){var a=-1,u=r.length,h=u>1?r[u-1]:s,p=u>2?r[2]:s;for(h=t.length>3&&typeof h=="function"?(u--,h):s,p&&$t(r[0],r[1],p)&&(h=u<3?s:h,u=1),e=gt(e);++a<u;){var m=r[a];m&&t(e,m,a,h)}return e})}function iu(t,e){return function(r,a){if(r==null)return r;if(!Kt(r))return t(r,a);for(var u=r.length,h=e?u:-1,p=gt(r);(e?h--:++h<u)&&a(p[h],h,p)!==!1;);return r}}function au(t){return function(e,r,a){for(var u=-1,h=gt(e),p=a(e),m=p.length;m--;){var v=p[t?m:++u];if(r(h[v],v,h)===!1)break}return e}}function ou(t){return function(e){var r=kn(e=ot(e))?we(e):s,a=r?r[0]:e.charAt(0),u=r?cn(r,1).join(""):e.slice(1);return a[t]()+u}}function Gn(t){return function(e){return si(rc(nc(e).replace(El,"")),t,"")}}function mr(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var r=jn(t.prototype),a=t.apply(r,e);return St(a)?a:r}}function uu(t){return function(e,r,a){var u=gt(e);if(!Kt(e)){var h=G(r,3);e=qt(e),r=function(m){return h(u[m],m,u)}}var p=t(e,r,a);return p>-1?u[h?e[p]:p]:s}}function cu(t){return Ze(function(e){var r=e.length,a=r,u=me.prototype.thru;for(t&&e.reverse();a--;){var h=e[a];if(typeof h!="function")throw new _e(n);if(u&&!p&&os(h)=="wrapper")var p=new me([],!0)}for(a=p?a:r;++a<r;){var m=os(h=e[a]),v=m=="wrapper"?Ui(h):s;p=v&&zi(v[0])&&v[1]==424&&!v[4].length&&v[9]==1?p[os(v[0])].apply(p,v[3]):h.length==1&&zi(h)?p[m]():p.thru(h)}return function(){var x=arguments,C=x[0];if(p&&x.length==1&&K(C))return p.plant(C).value();for(var T=0,P=r?e[T].apply(this,x):C;++T<r;)P=e[T].call(this,P);return P}})}function rs(t,e,r,a,u,h,p,m,v,x){var C=e&b,T=1&e,P=2&e,L=24&e,j=512&e,w=P?s:mr(t);return function M(){for(var B=arguments.length,R=O(B),Y=B;Y--;)R[Y]=arguments[Y];if(L)var V=Wn(M),at=function(It,Vt){for(var pt=It.length,zt=0;pt--;)It[pt]===Vt&&++zt;return zt}(R,V);if(a&&(R=ru(R,a,u,L)),h&&(R=su(R,h,p,L)),B-=at,L&&B<x){var H=rn(R,V);return du(t,e,rs,M.placeholder,r,R,H,m,v,x-B)}var $=T?r:this,At=P?$[t]:t;return B=R.length,m?R=function(It,Vt){for(var pt=It.length,zt=Ht(Vt.length,pt),He=Jt(It);zt--;){var hn=Vt[zt];It[zt]=Ye(hn,pt)?He[hn]:s}return It}(R,m):j&&B>1&&R.reverse(),C&&v<B&&(R.length=v),this&&this!==Nt&&this instanceof M&&(At=w||mr(At)),At.apply($,R)}}function lu(t,e){return function(r,a){return function(u,h,p,m){return Ne(u,function(v,x,C){h(m,p(v),x,C)}),m}(r,t,e(a),{})}}function ss(t,e){return function(r,a){var u;if(r===s&&a===s)return e;if(r!==s&&(u=r),a!==s){if(u===s)return a;typeof r=="string"||typeof a=="string"?(r=ie(r),a=ie(a)):(r=Yo(r),a=Yo(a)),u=t(r,a)}return u}}function Di(t){return Ze(function(e){return e=yt(e,se(G())),Q(function(r){var a=this;return t(e,function(u){return re(u,a,r)})})})}function is(t,e){var r=(e=e===s?" ":ie(e)).length;if(r<2)return r?Ti(e,t):e;var a=Ti(e,Br(t/Pn(e)));return kn(e)?cn(we(a),0,t).join(""):a.slice(0,t)}function hu(t){return function(e,r,a){return a&&typeof a!="number"&&$t(e,r,a)&&(r=a=s),e=Ke(e),r===s?(r=e,e=0):r=Ke(r),function(u,h,p,m){for(var v=-1,x=Mt(Br((h-u)/(p||1)),0),C=O(x);x--;)C[m?x:++v]=u,u+=p;return C}(e,r,a=a===s?e<r?1:-1:Ke(a),t)}}function as(t){return function(e,r){return typeof e=="string"&&typeof r=="string"||(e=Se(e),r=Se(r)),t(e,r)}}function du(t,e,r,a,u,h,p,m,v,x){var C=8&e;e|=C?f:_,4&(e&=~(C?_:f))||(e&=-4);var T=[t,e,u,C?h:s,C?p:s,C?s:h,C?s:p,m,v,x],P=r.apply(s,T);return zi(t)&&wu(P,T),P.placeholder=a,Iu(P,t,e)}function ki(t){var e=Pe[t];return function(r,a){if(r=Se(r),(a=a==null?0:Ht(X(a),292))&&Io(r)){var u=(ot(r)+"e").split("e");return+((u=(ot(e(u[0]+"e"+(+u[1]+a)))+"e").split("e"))[0]+"e"+(+u[1]-a))}return e(r)}}var Eh=Ln&&1/kr(new Ln([,-0]))[1]==A?function(t){return new Ln(t)}:ra;function fu(t){return function(e){var r=jt(e);return r==bt?hi(e):r==xe?Bl(e):function(a,u){return yt(u,function(h){return[h,a[h]]})}(e,t(e))}}function Ve(t,e,r,a,u,h,p,m){var v=2&e;if(!v&&typeof t!="function")throw new _e(n);var x=a?a.length:0;if(x||(e&=-97,a=u=s),p=p===s?p:Mt(X(p),0),m=m===s?m:X(m),x-=u?u.length:0,e&_){var C=a,T=u;a=u=s}var P=v?s:Ui(t),L=[t,e,r,a,u,C,T,h,p,m];if(P&&function(w,M){var B=w[1],R=M[1],Y=B|R,V=Y<131,at=R==b&&B==8||R==b&&B==S&&w[7].length<=M[8]||R==384&&M[7].length<=M[8]&&B==8;if(!V&&!at)return w;1&R&&(w[2]=M[2],Y|=1&B?0:4);var H=M[3];if(H){var $=w[3];w[3]=$?ru($,H,M[4]):H,w[4]=$?rn(w[3],o):M[4]}(H=M[5])&&($=w[5],w[5]=$?su($,H,M[6]):H,w[6]=$?rn(w[5],o):M[6]),(H=M[7])&&(w[7]=H),R&b&&(w[8]=w[8]==null?M[8]:Ht(w[8],M[8])),w[9]==null&&(w[9]=M[9]),w[0]=M[0],w[1]=Y}(L,P),t=L[0],e=L[1],r=L[2],a=L[3],u=L[4],!(m=L[9]=L[9]===s?v?0:t.length:Mt(L[9]-x,0))&&24&e&&(e&=-25),e&&e!=1)j=e==8||e==l?function(w,M,B){var R=mr(w);return function Y(){for(var V=arguments.length,at=O(V),H=V,$=Wn(Y);H--;)at[H]=arguments[H];var At=V<3&&at[0]!==$&&at[V-1]!==$?[]:rn(at,$);return(V-=At.length)<B?du(w,M,rs,Y.placeholder,s,at,At,s,s,B-V):re(this&&this!==Nt&&this instanceof Y?R:w,this,at)}}(t,e,m):e!=f&&e!=33||u.length?rs.apply(s,L):function(w,M,B,R){var Y=1&M,V=mr(w);return function at(){for(var H=-1,$=arguments.length,At=-1,It=R.length,Vt=O(It+$),pt=this&&this!==Nt&&this instanceof at?V:w;++At<It;)Vt[At]=R[At];for(;$--;)Vt[At++]=arguments[++H];return re(pt,Y?B:this,Vt)}}(t,e,r,a);else var j=function(w,M,B){var R=1&M,Y=mr(w);return function V(){return(this&&this!==Nt&&this instanceof V?Y:w).apply(R?B:this,arguments)}}(t,e,r);return Iu((P?Vo:wu)(j,L),t,e)}function gu(t,e,r,a){return t===s||Ee(t,Un[r])&&!lt.call(a,r)?e:t}function pu(t,e,r,a,u,h){return St(t)&&St(e)&&(h.set(e,t),Qr(t,e,s,pu,h),h.delete(e)),t}function Th(t){return br(t)?s:t}function _u(t,e,r,a,u,h){var p=1&r,m=t.length,v=e.length;if(m!=v&&!(p&&v>m))return!1;var x=h.get(t),C=h.get(e);if(x&&C)return x==e&&C==t;var T=-1,P=!0,L=2&r?new bn:s;for(h.set(t,e),h.set(e,t);++T<m;){var j=t[T],w=e[T];if(a)var M=p?a(w,j,T,e,t,h):a(j,w,T,t,e,h);if(M!==s){if(M)continue;P=!1;break}if(L){if(!ii(e,function(B,R){if(!ar(L,R)&&(j===B||u(j,B,r,a,h)))return L.push(R)})){P=!1;break}}else if(j!==w&&!u(j,w,r,a,h)){P=!1;break}}return h.delete(t),h.delete(e),P}function Ze(t){return Wi(Cu(t,s,Ru),t+"")}function Pi(t){return Po(t,qt,Hi)}function Ni(t){return Po(t,Xt,mu)}var Ui=Vr?function(t){return Vr.get(t)}:ra;function os(t){for(var e=t.name+"",r=Hn[e],a=lt.call(Hn,e)?r.length:0;a--;){var u=r[a],h=u.func;if(h==null||h==t)return u.name}return e}function Wn(t){return(lt.call(c,"placeholder")?c:t).placeholder}function G(){var t=c.iteratee||ea;return t=t===ea?Lo:t,arguments.length?t(arguments[0],arguments[1]):t}function us(t,e){var r,a,u=t.__data__;return((a=typeof(r=e))=="string"||a=="number"||a=="symbol"||a=="boolean"?r!=="__proto__":r===null)?u[typeof e=="string"?"string":"hash"]:u.map}function Li(t){for(var e=qt(t),r=e.length;r--;){var a=e[r],u=t[a];e[r]=[a,u,bu(u)]}return e}function xn(t,e){var r=function(a,u){return a==null?s:a[u]}(t,e);return Uo(r)?r:s}var Hi=fi?function(t){return t==null?[]:(t=gt(t),en(fi(t),function(e){return xo.call(t,e)}))}:sa,mu=fi?function(t){for(var e=[];t;)nn(e,Hi(t)),t=zr(t);return e}:sa,jt=Bt;function vu(t,e,r){for(var a=-1,u=(e=un(e,t)).length,h=!1;++a<u;){var p=Le(e[a]);if(!(h=t!=null&&r(t,p)))break;t=t[p]}return h||++a!=u?h:!!(u=t==null?0:t.length)&&ps(u)&&Ye(p,u)&&(K(t)||In(t))}function yu(t){return typeof t.constructor!="function"||vr(t)?{}:jn(zr(t))}function Mh(t){return K(t)||In(t)||!!(wo&&t&&t[wo])}function Ye(t,e){var r=typeof t;return!!(e=e??q)&&(r=="number"||r!="symbol"&&ml.test(t))&&t>-1&&t%1==0&&t<e}function $t(t,e,r){if(!St(r))return!1;var a=typeof e;return!!(a=="number"?Kt(r)&&Ye(e,r.length):a=="string"&&e in r)&&Ee(r[e],t)}function ji(t,e){if(K(t))return!1;var r=typeof t;return!(r!="number"&&r!="symbol"&&r!="boolean"&&t!=null&&!ae(t))||nl.test(t)||!el.test(t)||e!=null&&t in gt(e)}function zi(t){var e=os(t),r=c[e];if(typeof r!="function"||!(e in nt.prototype))return!1;if(t===r)return!0;var a=Ui(r);return!!a&&t===a[0]}(gi&&jt(new gi(new ArrayBuffer(1)))!=qn||ur&&jt(new ur)!=bt||pi&&jt(pi.resolve())!=Ge||Ln&&jt(new Ln)!=xe||cr&&jt(new cr)!=sr)&&(jt=function(t){var e=Bt(t),r=e==Rt?t.constructor:s,a=r?wn(r):"";if(a)switch(a){case uh:return qn;case ch:return bt;case lh:return Ge;case hh:return xe;case dh:return sr}return e});var Ah=Nr?Je:ia;function vr(t){var e=t&&t.constructor;return t===(typeof e=="function"&&e.prototype||Un)}function bu(t){return t==t&&!St(t)}function Su(t,e){return function(r){return r!=null&&r[t]===e&&(e!==s||t in gt(r))}}function Cu(t,e,r){return e=Mt(e===s?t.length-1:e,0),function(){for(var a=arguments,u=-1,h=Mt(a.length-e,0),p=O(h);++u<h;)p[u]=a[e+u];u=-1;for(var m=O(e+1);++u<e;)m[u]=a[u];return m[e]=r(p),re(t,this,m)}}function xu(t,e){return e.length<2?t:Cn(t,ye(e,0,-1))}function Gi(t,e){if((e!=="constructor"||typeof t[e]!="function")&&e!="__proto__")return t[e]}var wu=Eu(Vo),yr=eh||function(t,e){return Nt.setTimeout(t,e)},Wi=Eu(Ch);function Iu(t,e,r){var a=e+"";return Wi(t,function(u,h){var p=h.length;if(!p)return u;var m=p-1;return h[m]=(p>1?"& ":"")+h[m],h=h.join(p>2?", ":" "),u.replace(al,`{
/* [wrapped with `+h+`] */
`)}(a,function(u,h){return pe(et,function(p){var m="_."+p[0];h&p[1]&&!Or(u,m)&&u.push(m)}),u.sort()}(function(u){var h=u.match(ol);return h?h[1].split(ul):[]}(a),r)))}function Eu(t){var e=0,r=0;return function(){var a=ih(),u=16-(a-r);if(r=a,u>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(s,arguments)}}function cs(t,e){var r=-1,a=t.length,u=a-1;for(e=e===s?a:e;++r<e;){var h=Ei(r,u),p=t[h];t[h]=t[r],t[r]=p}return t.length=e,t}var Tu=function(t){var e=fs(t,function(a){return r.size===500&&r.clear(),a}),r=e.cache;return e}(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(rl,function(r,a,u,h){e.push(u?h.replace(hl,"$1"):a||r)}),e});function Le(t){if(typeof t=="string"||ae(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function wn(t){if(t!=null){try{return Ur.call(t)}catch{}try{return t+""}catch{}}return""}function Mu(t){if(t instanceof nt)return t.clone();var e=new me(t.__wrapped__,t.__chain__);return e.__actions__=Jt(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var Fh=Q(function(t,e){return wt(t)?fr(t,Ut(e,1,wt,!0)):[]}),Rh=Q(function(t,e){var r=be(e);return wt(r)&&(r=s),wt(t)?fr(t,Ut(e,1,wt,!0),G(r,2)):[]}),qh=Q(function(t,e){var r=be(e);return wt(r)&&(r=s),wt(t)?fr(t,Ut(e,1,wt,!0),s,r):[]});function Au(t,e,r){var a=t==null?0:t.length;if(!a)return-1;var u=r==null?0:X(r);return u<0&&(u=Mt(a+u,0)),Dr(t,G(e,3),u)}function Fu(t,e,r){var a=t==null?0:t.length;if(!a)return-1;var u=a-1;return r!==s&&(u=X(r),u=r<0?Mt(a+u,0):Ht(u,a-1)),Dr(t,G(e,3),u,!0)}function Ru(t){return t!=null&&t.length?Ut(t,1):[]}function qu(t){return t&&t.length?t[0]:s}var Oh=Q(function(t){var e=yt(t,Ri);return e.length&&e[0]===t[0]?Si(e):[]}),Dh=Q(function(t){var e=be(t),r=yt(t,Ri);return e===be(r)?e=s:r.pop(),r.length&&r[0]===t[0]?Si(r,G(e,2)):[]}),kh=Q(function(t){var e=be(t),r=yt(t,Ri);return(e=typeof e=="function"?e:s)&&r.pop(),r.length&&r[0]===t[0]?Si(r,s,e):[]});function be(t){var e=t==null?0:t.length;return e?t[e-1]:s}var Ph=Q(Ou);function Ou(t,e){return t&&t.length&&e&&e.length?Ii(t,e):t}var Nh=Ze(function(t,e){var r=t==null?0:t.length,a=mi(t,e);return $o(t,yt(e,function(u){return Ye(u,r)?+u:u}).sort(nu)),a});function Bi(t){return t==null?t:oh.call(t)}var Uh=Q(function(t){return on(Ut(t,1,wt,!0))}),Lh=Q(function(t){var e=be(t);return wt(e)&&(e=s),on(Ut(t,1,wt,!0),G(e,2))}),Hh=Q(function(t){var e=be(t);return e=typeof e=="function"?e:s,on(Ut(t,1,wt,!0),s,e)});function $i(t){if(!t||!t.length)return[];var e=0;return t=en(t,function(r){if(wt(r))return e=Mt(r.length,e),!0}),ci(e,function(r){return yt(t,ai(r))})}function Du(t,e){if(!t||!t.length)return[];var r=$i(t);return e==null?r:yt(r,function(a){return re(e,s,a)})}var jh=Q(function(t,e){return wt(t)?fr(t,e):[]}),zh=Q(function(t){return Fi(en(t,wt))}),Gh=Q(function(t){var e=be(t);return wt(e)&&(e=s),Fi(en(t,wt),G(e,2))}),Wh=Q(function(t){var e=be(t);return e=typeof e=="function"?e:s,Fi(en(t,wt),s,e)}),Bh=Q($i),$h=Q(function(t){var e=t.length,r=e>1?t[e-1]:s;return r=typeof r=="function"?(t.pop(),r):s,Du(t,r)});function ku(t){var e=c(t);return e.__chain__=!0,e}function ls(t,e){return e(t)}var Vh=Ze(function(t){var e=t.length,r=e?t[0]:0,a=this.__wrapped__,u=function(h){return mi(h,t)};return!(e>1||this.__actions__.length)&&a instanceof nt&&Ye(r)?((a=a.slice(r,+r+(e?1:0))).__actions__.push({func:ls,args:[u],thisArg:s}),new me(a,this.__chain__).thru(function(h){return e&&!h.length&&h.push(s),h})):this.thru(u)}),Zh=ns(function(t,e,r){lt.call(t,r)?++t[r]:$e(t,r,1)}),Yh=uu(Au),Jh=uu(Fu);function Pu(t,e){return(K(t)?pe:an)(t,G(e,3))}function Nu(t,e){return(K(t)?Ul:Oo)(t,G(e,3))}var Kh=ns(function(t,e,r){lt.call(t,r)?t[r].push(e):$e(t,r,[e])}),Xh=Q(function(t,e,r){var a=-1,u=typeof e=="function",h=Kt(t)?O(t.length):[];return an(t,function(p){h[++a]=u?re(e,p,r):gr(p,e,r)}),h}),Qh=ns(function(t,e,r){$e(t,r,e)});function hs(t,e){return(K(t)?yt:Ho)(t,G(e,3))}var td=ns(function(t,e,r){t[r?0:1].push(e)},function(){return[[],[]]}),ed=Q(function(t,e){if(t==null)return[];var r=e.length;return r>1&&$t(t,e[0],e[1])?e=[]:r>2&&$t(e[0],e[1],e[2])&&(e=[e[0]]),Wo(t,Ut(e,1),[])}),ds=th||function(){return Nt.Date.now()};function Uu(t,e,r){return e=r?s:e,e=t&&e==null?t.length:e,Ve(t,b,s,s,s,s,e)}function Lu(t,e){var r;if(typeof e!="function")throw new _e(n);return t=X(t),function(){return--t>0&&(r=e.apply(this,arguments)),t<=1&&(e=s),r}}var Vi=Q(function(t,e,r){var a=1;if(r.length){var u=rn(r,Wn(Vi));a|=f}return Ve(t,a,e,r,u)}),Hu=Q(function(t,e,r){var a=3;if(r.length){var u=rn(r,Wn(Hu));a|=f}return Ve(e,a,t,r,u)});function ju(t,e,r){var a,u,h,p,m,v,x=0,C=!1,T=!1,P=!0;if(typeof t!="function")throw new _e(n);function L(R){var Y=a,V=u;return a=u=s,x=R,p=t.apply(V,Y)}function j(R){var Y=R-v;return v===s||Y>=e||Y<0||T&&R-x>=h}function w(){var R=ds();if(j(R))return M(R);m=yr(w,function(Y){var V=e-(Y-v);return T?Ht(V,h-(Y-x)):V}(R))}function M(R){return m=s,P&&a?L(R):(a=u=s,p)}function B(){var R=ds(),Y=j(R);if(a=arguments,u=this,v=R,Y){if(m===s)return function(V){return x=V,m=yr(w,e),C?L(V):p}(v);if(T)return Qo(m),m=yr(w,e),L(v)}return m===s&&(m=yr(w,e)),p}return e=Se(e)||0,St(r)&&(C=!!r.leading,h=(T="maxWait"in r)?Mt(Se(r.maxWait)||0,e):h,P="trailing"in r?!!r.trailing:P),B.cancel=function(){m!==s&&Qo(m),x=0,a=v=u=m=s},B.flush=function(){return m===s?p:M(ds())},B}var nd=Q(function(t,e){return qo(t,1,e)}),rd=Q(function(t,e,r){return qo(t,Se(e)||0,r)});function fs(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new _e(n);var r=function(){var a=arguments,u=e?e.apply(this,a):a[0],h=r.cache;if(h.has(u))return h.get(u);var p=t.apply(this,a);return r.cache=h.set(u,p)||h,p};return r.cache=new(fs.Cache||Be),r}function gs(t){if(typeof t!="function")throw new _e(n);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}fs.Cache=Be;var sd=Ih(function(t,e){var r=(e=e.length==1&&K(e[0])?yt(e[0],se(G())):yt(Ut(e,1),se(G()))).length;return Q(function(a){for(var u=-1,h=Ht(a.length,r);++u<h;)a[u]=e[u].call(this,a[u]);return re(t,this,a)})}),Zi=Q(function(t,e){var r=rn(e,Wn(Zi));return Ve(t,f,s,e,r)}),zu=Q(function(t,e){var r=rn(e,Wn(zu));return Ve(t,_,s,e,r)}),id=Ze(function(t,e){return Ve(t,S,s,s,s,e)});function Ee(t,e){return t===e||t!=t&&e!=e}var ad=as(bi),od=as(function(t,e){return t>=e}),In=No(function(){return arguments}())?No:function(t){return Ct(t)&&lt.call(t,"callee")&&!xo.call(t,"callee")},K=O.isArray,ud=ro?se(ro):function(t){return Ct(t)&&Bt(t)==ir};function Kt(t){return t!=null&&ps(t.length)&&!Je(t)}function wt(t){return Ct(t)&&Kt(t)}var ln=nh||ia,cd=so?se(so):function(t){return Ct(t)&&Bt(t)==z};function Yi(t){if(!Ct(t))return!1;var e=Bt(t);return e==dt||e=="[object DOMException]"||typeof t.message=="string"&&typeof t.name=="string"&&!br(t)}function Je(t){if(!St(t))return!1;var e=Bt(t);return e==ze||e==ne||e=="[object AsyncFunction]"||e=="[object Proxy]"}function Gu(t){return typeof t=="number"&&t==X(t)}function ps(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=q}function St(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function Ct(t){return t!=null&&typeof t=="object"}var Wu=io?se(io):function(t){return Ct(t)&&jt(t)==bt};function Bu(t){return typeof t=="number"||Ct(t)&&Bt(t)==Ce}function br(t){if(!Ct(t)||Bt(t)!=Rt)return!1;var e=zr(t);if(e===null)return!0;var r=lt.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&Ur.call(r)==Jl}var Ji=ao?se(ao):function(t){return Ct(t)&&Bt(t)==ke},$u=oo?se(oo):function(t){return Ct(t)&&jt(t)==xe};function _s(t){return typeof t=="string"||!K(t)&&Ct(t)&&Bt(t)==rr}function ae(t){return typeof t=="symbol"||Ct(t)&&Bt(t)==Ar}var Bn=uo?se(uo):function(t){return Ct(t)&&ps(t.length)&&!!ft[Bt(t)]},ld=as(wi),hd=as(function(t,e){return t<=e});function Vu(t){if(!t)return[];if(Kt(t))return _s(t)?we(t):Jt(t);if(or&&t[or])return function(r){for(var a,u=[];!(a=r.next()).done;)u.push(a.value);return u}(t[or]());var e=jt(t);return(e==bt?hi:e==xe?kr:$n)(t)}function Ke(t){return t?(t=Se(t))===A||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:t===0?t:0}function X(t){var e=Ke(t),r=e%1;return e==e?r?e-r:e:0}function Zu(t){return t?Sn(X(t),0,tt):0}function Se(t){if(typeof t=="number")return t;if(ae(t))return D;if(St(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=St(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=po(t);var r=gl.test(t);return r||_l.test(t)?kl(t.slice(2),r?2:8):fl.test(t)?D:+t}function Yu(t){return Ue(t,Xt(t))}function ot(t){return t==null?"":ie(t)}var dd=zn(function(t,e){if(vr(e)||Kt(e))Ue(e,qt(e),t);else for(var r in e)lt.call(e,r)&&dr(t,r,e[r])}),Ju=zn(function(t,e){Ue(e,Xt(e),t)}),ms=zn(function(t,e,r,a){Ue(e,Xt(e),t,a)}),fd=zn(function(t,e,r,a){Ue(e,qt(e),t,a)}),gd=Ze(mi),pd=Q(function(t,e){t=gt(t);var r=-1,a=e.length,u=a>2?e[2]:s;for(u&&$t(e[0],e[1],u)&&(a=1);++r<a;)for(var h=e[r],p=Xt(h),m=-1,v=p.length;++m<v;){var x=p[m],C=t[x];(C===s||Ee(C,Un[x])&&!lt.call(t,x))&&(t[x]=h[x])}return t}),_d=Q(function(t){return t.push(s,pu),re(Ku,s,t)});function Ki(t,e,r){var a=t==null?s:Cn(t,e);return a===s?r:a}function Xi(t,e){return t!=null&&vu(t,e,vh)}var md=lu(function(t,e,r){e!=null&&typeof e.toString!="function"&&(e=Lr.call(e)),t[e]=r},ta(Qt)),vd=lu(function(t,e,r){e!=null&&typeof e.toString!="function"&&(e=Lr.call(e)),lt.call(t,e)?t[e].push(r):t[e]=[r]},G),yd=Q(gr);function qt(t){return Kt(t)?Mo(t):xi(t)}function Xt(t){return Kt(t)?Mo(t,!0):yh(t)}var bd=zn(function(t,e,r){Qr(t,e,r)}),Ku=zn(function(t,e,r,a){Qr(t,e,r,a)}),Sd=Ze(function(t,e){var r={};if(t==null)return r;var a=!1;e=yt(e,function(h){return h=un(h,t),a||(a=h.length>1),h}),Ue(t,Ni(t),r),a&&(r=ve(r,7,Th));for(var u=e.length;u--;)Ai(r,e[u]);return r}),Cd=Ze(function(t,e){return t==null?{}:function(r,a){return Bo(r,a,function(u,h){return Xi(r,h)})}(t,e)});function Xu(t,e){if(t==null)return{};var r=yt(Ni(t),function(a){return[a]});return e=G(e),Bo(t,r,function(a,u){return e(a,u[0])})}var Qu=fu(qt),tc=fu(Xt);function $n(t){return t==null?[]:li(t,qt(t))}var xd=Gn(function(t,e,r){return e=e.toLowerCase(),t+(r?ec(e):e)});function ec(t){return Qi(ot(t).toLowerCase())}function nc(t){return(t=ot(t))&&t.replace(vl,zl).replace(Tl,"")}var wd=Gn(function(t,e,r){return t+(r?"-":"")+e.toLowerCase()}),Id=Gn(function(t,e,r){return t+(r?" ":"")+e.toLowerCase()}),Ed=ou("toLowerCase"),Td=Gn(function(t,e,r){return t+(r?"_":"")+e.toLowerCase()}),Md=Gn(function(t,e,r){return t+(r?" ":"")+Qi(e)}),Ad=Gn(function(t,e,r){return t+(r?" ":"")+e.toUpperCase()}),Qi=ou("toUpperCase");function rc(t,e,r){return t=ot(t),(e=r?s:e)===s?function(a){return Fl.test(a)}(t)?function(a){return a.match(Ml)||[]}(t):function(a){return a.match(cl)||[]}(t):t.match(e)||[]}var sc=Q(function(t,e){try{return re(t,s,e)}catch(r){return Yi(r)?r:new st(r)}}),Fd=Ze(function(t,e){return pe(e,function(r){r=Le(r),$e(t,r,Vi(t[r],t))}),t});function ta(t){return function(){return t}}var Rd=cu(),qd=cu(!0);function Qt(t){return t}function ea(t){return Lo(typeof t=="function"?t:ve(t,1))}var Od=Q(function(t,e){return function(r){return gr(r,t,e)}}),Dd=Q(function(t,e){return function(r){return gr(t,r,e)}});function na(t,e,r){var a=qt(e),u=Xr(e,a);r!=null||St(e)&&(u.length||!a.length)||(r=e,e=t,t=this,u=Xr(e,qt(e)));var h=!(St(r)&&"chain"in r&&!r.chain),p=Je(t);return pe(u,function(m){var v=e[m];t[m]=v,p&&(t.prototype[m]=function(){var x=this.__chain__;if(h||x){var C=t(this.__wrapped__);return(C.__actions__=Jt(this.__actions__)).push({func:v,args:arguments,thisArg:t}),C.__chain__=x,C}return v.apply(t,nn([this.value()],arguments))})}),t}function ra(){}var kd=Di(yt),Pd=Di(co),Nd=Di(ii);function ic(t){return ji(t)?ai(Le(t)):function(e){return function(r){return Cn(r,e)}}(t)}var Ud=hu(),Ld=hu(!0);function sa(){return[]}function ia(){return!1}var aa,Hd=ss(function(t,e){return t+e},0),jd=ki("ceil"),zd=ss(function(t,e){return t/e},1),Gd=ki("floor"),Wd=ss(function(t,e){return t*e},1),Bd=ki("round"),$d=ss(function(t,e){return t-e},0);return c.after=function(t,e){if(typeof e!="function")throw new _e(n);return t=X(t),function(){if(--t<1)return e.apply(this,arguments)}},c.ary=Uu,c.assign=dd,c.assignIn=Ju,c.assignInWith=ms,c.assignWith=fd,c.at=gd,c.before=Lu,c.bind=Vi,c.bindAll=Fd,c.bindKey=Hu,c.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return K(t)?t:[t]},c.chain=ku,c.chunk=function(t,e,r){e=(r?$t(t,e,r):e===s)?1:Mt(X(e),0);var a=t==null?0:t.length;if(!a||e<1)return[];for(var u=0,h=0,p=O(Br(a/e));u<a;)p[h++]=ye(t,u,u+=e);return p},c.compact=function(t){for(var e=-1,r=t==null?0:t.length,a=0,u=[];++e<r;){var h=t[e];h&&(u[a++]=h)}return u},c.concat=function(){var t=arguments.length;if(!t)return[];for(var e=O(t-1),r=arguments[0],a=t;a--;)e[a-1]=arguments[a];return nn(K(r)?Jt(r):[r],Ut(e,1))},c.cond=function(t){var e=t==null?0:t.length,r=G();return t=e?yt(t,function(a){if(typeof a[1]!="function")throw new _e(n);return[r(a[0]),a[1]]}):[],Q(function(a){for(var u=-1;++u<e;){var h=t[u];if(re(h[0],this,a))return re(h[1],this,a)}})},c.conforms=function(t){return function(e){var r=qt(e);return function(a){return Ro(a,e,r)}}(ve(t,1))},c.constant=ta,c.countBy=Zh,c.create=function(t,e){var r=jn(t);return e==null?r:Fo(r,e)},c.curry=function t(e,r,a){var u=Ve(e,8,s,s,s,s,s,r=a?s:r);return u.placeholder=t.placeholder,u},c.curryRight=function t(e,r,a){var u=Ve(e,l,s,s,s,s,s,r=a?s:r);return u.placeholder=t.placeholder,u},c.debounce=ju,c.defaults=pd,c.defaultsDeep=_d,c.defer=nd,c.delay=rd,c.difference=Fh,c.differenceBy=Rh,c.differenceWith=qh,c.drop=function(t,e,r){var a=t==null?0:t.length;return a?ye(t,(e=r||e===s?1:X(e))<0?0:e,a):[]},c.dropRight=function(t,e,r){var a=t==null?0:t.length;return a?ye(t,0,(e=a-(e=r||e===s?1:X(e)))<0?0:e):[]},c.dropRightWhile=function(t,e){return t&&t.length?es(t,G(e,3),!0,!0):[]},c.dropWhile=function(t,e){return t&&t.length?es(t,G(e,3),!0):[]},c.fill=function(t,e,r,a){var u=t==null?0:t.length;return u?(r&&typeof r!="number"&&$t(t,e,r)&&(r=0,a=u),function(h,p,m,v){var x=h.length;for((m=X(m))<0&&(m=-m>x?0:x+m),(v=v===s||v>x?x:X(v))<0&&(v+=x),v=m>v?0:Zu(v);m<v;)h[m++]=p;return h}(t,e,r,a)):[]},c.filter=function(t,e){return(K(t)?en:Do)(t,G(e,3))},c.flatMap=function(t,e){return Ut(hs(t,e),1)},c.flatMapDeep=function(t,e){return Ut(hs(t,e),A)},c.flatMapDepth=function(t,e,r){return r=r===s?1:X(r),Ut(hs(t,e),r)},c.flatten=Ru,c.flattenDeep=function(t){return t!=null&&t.length?Ut(t,A):[]},c.flattenDepth=function(t,e){return t!=null&&t.length?Ut(t,e=e===s?1:X(e)):[]},c.flip=function(t){return Ve(t,512)},c.flow=Rd,c.flowRight=qd,c.fromPairs=function(t){for(var e=-1,r=t==null?0:t.length,a={};++e<r;){var u=t[e];a[u[0]]=u[1]}return a},c.functions=function(t){return t==null?[]:Xr(t,qt(t))},c.functionsIn=function(t){return t==null?[]:Xr(t,Xt(t))},c.groupBy=Kh,c.initial=function(t){return t!=null&&t.length?ye(t,0,-1):[]},c.intersection=Oh,c.intersectionBy=Dh,c.intersectionWith=kh,c.invert=md,c.invertBy=vd,c.invokeMap=Xh,c.iteratee=ea,c.keyBy=Qh,c.keys=qt,c.keysIn=Xt,c.map=hs,c.mapKeys=function(t,e){var r={};return e=G(e,3),Ne(t,function(a,u,h){$e(r,e(a,u,h),a)}),r},c.mapValues=function(t,e){var r={};return e=G(e,3),Ne(t,function(a,u,h){$e(r,u,e(a,u,h))}),r},c.matches=function(t){return jo(ve(t,1))},c.matchesProperty=function(t,e){return zo(t,ve(e,1))},c.memoize=fs,c.merge=bd,c.mergeWith=Ku,c.method=Od,c.methodOf=Dd,c.mixin=na,c.negate=gs,c.nthArg=function(t){return t=X(t),Q(function(e){return Go(e,t)})},c.omit=Sd,c.omitBy=function(t,e){return Xu(t,gs(G(e)))},c.once=function(t){return Lu(2,t)},c.orderBy=function(t,e,r,a){return t==null?[]:(K(e)||(e=e==null?[]:[e]),K(r=a?s:r)||(r=r==null?[]:[r]),Wo(t,e,r))},c.over=kd,c.overArgs=sd,c.overEvery=Pd,c.overSome=Nd,c.partial=Zi,c.partialRight=zu,c.partition=td,c.pick=Cd,c.pickBy=Xu,c.property=ic,c.propertyOf=function(t){return function(e){return t==null?s:Cn(t,e)}},c.pull=Ph,c.pullAll=Ou,c.pullAllBy=function(t,e,r){return t&&t.length&&e&&e.length?Ii(t,e,G(r,2)):t},c.pullAllWith=function(t,e,r){return t&&t.length&&e&&e.length?Ii(t,e,s,r):t},c.pullAt=Nh,c.range=Ud,c.rangeRight=Ld,c.rearg=id,c.reject=function(t,e){return(K(t)?en:Do)(t,gs(G(e,3)))},c.remove=function(t,e){var r=[];if(!t||!t.length)return r;var a=-1,u=[],h=t.length;for(e=G(e,3);++a<h;){var p=t[a];e(p,a,t)&&(r.push(p),u.push(a))}return $o(t,u),r},c.rest=function(t,e){if(typeof t!="function")throw new _e(n);return Q(t,e=e===s?e:X(e))},c.reverse=Bi,c.sampleSize=function(t,e,r){return e=(r?$t(t,e,r):e===s)?1:X(e),(K(t)?fh:Sh)(t,e)},c.set=function(t,e,r){return t==null?t:_r(t,e,r)},c.setWith=function(t,e,r,a){return a=typeof a=="function"?a:s,t==null?t:_r(t,e,r,a)},c.shuffle=function(t){return(K(t)?gh:xh)(t)},c.slice=function(t,e,r){var a=t==null?0:t.length;return a?(r&&typeof r!="number"&&$t(t,e,r)?(e=0,r=a):(e=e==null?0:X(e),r=r===s?a:X(r)),ye(t,e,r)):[]},c.sortBy=ed,c.sortedUniq=function(t){return t&&t.length?Zo(t):[]},c.sortedUniqBy=function(t,e){return t&&t.length?Zo(t,G(e,2)):[]},c.split=function(t,e,r){return r&&typeof r!="number"&&$t(t,e,r)&&(e=r=s),(r=r===s?tt:r>>>0)?(t=ot(t))&&(typeof e=="string"||e!=null&&!Ji(e))&&!(e=ie(e))&&kn(t)?cn(we(t),0,r):t.split(e,r):[]},c.spread=function(t,e){if(typeof t!="function")throw new _e(n);return e=e==null?0:Mt(X(e),0),Q(function(r){var a=r[e],u=cn(r,0,e);return a&&nn(u,a),re(t,this,u)})},c.tail=function(t){var e=t==null?0:t.length;return e?ye(t,1,e):[]},c.take=function(t,e,r){return t&&t.length?ye(t,0,(e=r||e===s?1:X(e))<0?0:e):[]},c.takeRight=function(t,e,r){var a=t==null?0:t.length;return a?ye(t,(e=a-(e=r||e===s?1:X(e)))<0?0:e,a):[]},c.takeRightWhile=function(t,e){return t&&t.length?es(t,G(e,3),!1,!0):[]},c.takeWhile=function(t,e){return t&&t.length?es(t,G(e,3)):[]},c.tap=function(t,e){return e(t),t},c.throttle=function(t,e,r){var a=!0,u=!0;if(typeof t!="function")throw new _e(n);return St(r)&&(a="leading"in r?!!r.leading:a,u="trailing"in r?!!r.trailing:u),ju(t,e,{leading:a,maxWait:e,trailing:u})},c.thru=ls,c.toArray=Vu,c.toPairs=Qu,c.toPairsIn=tc,c.toPath=function(t){return K(t)?yt(t,Le):ae(t)?[t]:Jt(Tu(ot(t)))},c.toPlainObject=Yu,c.transform=function(t,e,r){var a=K(t),u=a||ln(t)||Bn(t);if(e=G(e,4),r==null){var h=t&&t.constructor;r=u?a?new h:[]:St(t)&&Je(h)?jn(zr(t)):{}}return(u?pe:Ne)(t,function(p,m,v){return e(r,p,m,v)}),r},c.unary=function(t){return Uu(t,1)},c.union=Uh,c.unionBy=Lh,c.unionWith=Hh,c.uniq=function(t){return t&&t.length?on(t):[]},c.uniqBy=function(t,e){return t&&t.length?on(t,G(e,2)):[]},c.uniqWith=function(t,e){return e=typeof e=="function"?e:s,t&&t.length?on(t,s,e):[]},c.unset=function(t,e){return t==null||Ai(t,e)},c.unzip=$i,c.unzipWith=Du,c.update=function(t,e,r){return t==null?t:Jo(t,e,qi(r))},c.updateWith=function(t,e,r,a){return a=typeof a=="function"?a:s,t==null?t:Jo(t,e,qi(r),a)},c.values=$n,c.valuesIn=function(t){return t==null?[]:li(t,Xt(t))},c.without=jh,c.words=rc,c.wrap=function(t,e){return Zi(qi(e),t)},c.xor=zh,c.xorBy=Gh,c.xorWith=Wh,c.zip=Bh,c.zipObject=function(t,e){return Xo(t||[],e||[],dr)},c.zipObjectDeep=function(t,e){return Xo(t||[],e||[],_r)},c.zipWith=$h,c.entries=Qu,c.entriesIn=tc,c.extend=Ju,c.extendWith=ms,na(c,c),c.add=Hd,c.attempt=sc,c.camelCase=xd,c.capitalize=ec,c.ceil=jd,c.clamp=function(t,e,r){return r===s&&(r=e,e=s),r!==s&&(r=(r=Se(r))==r?r:0),e!==s&&(e=(e=Se(e))==e?e:0),Sn(Se(t),e,r)},c.clone=function(t){return ve(t,4)},c.cloneDeep=function(t){return ve(t,5)},c.cloneDeepWith=function(t,e){return ve(t,5,e=typeof e=="function"?e:s)},c.cloneWith=function(t,e){return ve(t,4,e=typeof e=="function"?e:s)},c.conformsTo=function(t,e){return e==null||Ro(t,e,qt(e))},c.deburr=nc,c.defaultTo=function(t,e){return t==null||t!=t?e:t},c.divide=zd,c.endsWith=function(t,e,r){t=ot(t),e=ie(e);var a=t.length,u=r=r===s?a:Sn(X(r),0,a);return(r-=e.length)>=0&&t.slice(r,u)==e},c.eq=Ee,c.escape=function(t){return(t=ot(t))&&Xc.test(t)?t.replace(Da,Gl):t},c.escapeRegExp=function(t){return(t=ot(t))&&sl.test(t)?t.replace(Ys,"\\$&"):t},c.every=function(t,e,r){var a=K(t)?co:_h;return r&&$t(t,e,r)&&(e=s),a(t,G(e,3))},c.find=Yh,c.findIndex=Au,c.findKey=function(t,e){return lo(t,G(e,3),Ne)},c.findLast=Jh,c.findLastIndex=Fu,c.findLastKey=function(t,e){return lo(t,G(e,3),yi)},c.floor=Gd,c.forEach=Pu,c.forEachRight=Nu,c.forIn=function(t,e){return t==null?t:vi(t,G(e,3),Xt)},c.forInRight=function(t,e){return t==null?t:ko(t,G(e,3),Xt)},c.forOwn=function(t,e){return t&&Ne(t,G(e,3))},c.forOwnRight=function(t,e){return t&&yi(t,G(e,3))},c.get=Ki,c.gt=ad,c.gte=od,c.has=function(t,e){return t!=null&&vu(t,e,mh)},c.hasIn=Xi,c.head=qu,c.identity=Qt,c.includes=function(t,e,r,a){t=Kt(t)?t:$n(t),r=r&&!a?X(r):0;var u=t.length;return r<0&&(r=Mt(u+r,0)),_s(t)?r<=u&&t.indexOf(e,r)>-1:!!u&&Dn(t,e,r)>-1},c.indexOf=function(t,e,r){var a=t==null?0:t.length;if(!a)return-1;var u=r==null?0:X(r);return u<0&&(u=Mt(a+u,0)),Dn(t,e,u)},c.inRange=function(t,e,r){return e=Ke(e),r===s?(r=e,e=0):r=Ke(r),function(a,u,h){return a>=Ht(u,h)&&a<Mt(u,h)}(t=Se(t),e,r)},c.invoke=yd,c.isArguments=In,c.isArray=K,c.isArrayBuffer=ud,c.isArrayLike=Kt,c.isArrayLikeObject=wt,c.isBoolean=function(t){return t===!0||t===!1||Ct(t)&&Bt(t)==vt},c.isBuffer=ln,c.isDate=cd,c.isElement=function(t){return Ct(t)&&t.nodeType===1&&!br(t)},c.isEmpty=function(t){if(t==null)return!0;if(Kt(t)&&(K(t)||typeof t=="string"||typeof t.splice=="function"||ln(t)||Bn(t)||In(t)))return!t.length;var e=jt(t);if(e==bt||e==xe)return!t.size;if(vr(t))return!xi(t).length;for(var r in t)if(lt.call(t,r))return!1;return!0},c.isEqual=function(t,e){return pr(t,e)},c.isEqualWith=function(t,e,r){var a=(r=typeof r=="function"?r:s)?r(t,e):s;return a===s?pr(t,e,s,r):!!a},c.isError=Yi,c.isFinite=function(t){return typeof t=="number"&&Io(t)},c.isFunction=Je,c.isInteger=Gu,c.isLength=ps,c.isMap=Wu,c.isMatch=function(t,e){return t===e||Ci(t,e,Li(e))},c.isMatchWith=function(t,e,r){return r=typeof r=="function"?r:s,Ci(t,e,Li(e),r)},c.isNaN=function(t){return Bu(t)&&t!=+t},c.isNative=function(t){if(Ah(t))throw new st("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Uo(t)},c.isNil=function(t){return t==null},c.isNull=function(t){return t===null},c.isNumber=Bu,c.isObject=St,c.isObjectLike=Ct,c.isPlainObject=br,c.isRegExp=Ji,c.isSafeInteger=function(t){return Gu(t)&&t>=-9007199254740991&&t<=q},c.isSet=$u,c.isString=_s,c.isSymbol=ae,c.isTypedArray=Bn,c.isUndefined=function(t){return t===s},c.isWeakMap=function(t){return Ct(t)&&jt(t)==sr},c.isWeakSet=function(t){return Ct(t)&&Bt(t)=="[object WeakSet]"},c.join=function(t,e){return t==null?"":rh.call(t,e)},c.kebabCase=wd,c.last=be,c.lastIndexOf=function(t,e,r){var a=t==null?0:t.length;if(!a)return-1;var u=a;return r!==s&&(u=(u=X(r))<0?Mt(a+u,0):Ht(u,a-1)),e==e?function(h,p,m){for(var v=m+1;v--;)if(h[v]===p)return v;return v}(t,e,u):Dr(t,ho,u,!0)},c.lowerCase=Id,c.lowerFirst=Ed,c.lt=ld,c.lte=hd,c.max=function(t){return t&&t.length?Kr(t,Qt,bi):s},c.maxBy=function(t,e){return t&&t.length?Kr(t,G(e,2),bi):s},c.mean=function(t){return fo(t,Qt)},c.meanBy=function(t,e){return fo(t,G(e,2))},c.min=function(t){return t&&t.length?Kr(t,Qt,wi):s},c.minBy=function(t,e){return t&&t.length?Kr(t,G(e,2),wi):s},c.stubArray=sa,c.stubFalse=ia,c.stubObject=function(){return{}},c.stubString=function(){return""},c.stubTrue=function(){return!0},c.multiply=Wd,c.nth=function(t,e){return t&&t.length?Go(t,X(e)):s},c.noConflict=function(){return Nt._===this&&(Nt._=Kl),this},c.noop=ra,c.now=ds,c.pad=function(t,e,r){t=ot(t);var a=(e=X(e))?Pn(t):0;if(!e||a>=e)return t;var u=(e-a)/2;return is($r(u),r)+t+is(Br(u),r)},c.padEnd=function(t,e,r){t=ot(t);var a=(e=X(e))?Pn(t):0;return e&&a<e?t+is(e-a,r):t},c.padStart=function(t,e,r){t=ot(t);var a=(e=X(e))?Pn(t):0;return e&&a<e?is(e-a,r)+t:t},c.parseInt=function(t,e,r){return r||e==null?e=0:e&&(e=+e),ah(ot(t).replace(Js,""),e||0)},c.random=function(t,e,r){if(r&&typeof r!="boolean"&&$t(t,e,r)&&(e=r=s),r===s&&(typeof e=="boolean"?(r=e,e=s):typeof t=="boolean"&&(r=t,t=s)),t===s&&e===s?(t=0,e=1):(t=Ke(t),e===s?(e=t,t=0):e=Ke(e)),t>e){var a=t;t=e,e=a}if(r||t%1||e%1){var u=Eo();return Ht(t+u*(e-t+Dl("1e-"+((u+"").length-1))),e)}return Ei(t,e)},c.reduce=function(t,e,r){var a=K(t)?si:go,u=arguments.length<3;return a(t,G(e,4),r,u,an)},c.reduceRight=function(t,e,r){var a=K(t)?Ll:go,u=arguments.length<3;return a(t,G(e,4),r,u,Oo)},c.repeat=function(t,e,r){return e=(r?$t(t,e,r):e===s)?1:X(e),Ti(ot(t),e)},c.replace=function(){var t=arguments,e=ot(t[0]);return t.length<3?e:e.replace(t[1],t[2])},c.result=function(t,e,r){var a=-1,u=(e=un(e,t)).length;for(u||(u=1,t=s);++a<u;){var h=t==null?s:t[Le(e[a])];h===s&&(a=u,h=r),t=Je(h)?h.call(t):h}return t},c.round=Bd,c.runInContext=y,c.sample=function(t){return(K(t)?Ao:bh)(t)},c.size=function(t){if(t==null)return 0;if(Kt(t))return _s(t)?Pn(t):t.length;var e=jt(t);return e==bt||e==xe?t.size:xi(t).length},c.snakeCase=Td,c.some=function(t,e,r){var a=K(t)?ii:wh;return r&&$t(t,e,r)&&(e=s),a(t,G(e,3))},c.sortedIndex=function(t,e){return ts(t,e)},c.sortedIndexBy=function(t,e,r){return Mi(t,e,G(r,2))},c.sortedIndexOf=function(t,e){var r=t==null?0:t.length;if(r){var a=ts(t,e);if(a<r&&Ee(t[a],e))return a}return-1},c.sortedLastIndex=function(t,e){return ts(t,e,!0)},c.sortedLastIndexBy=function(t,e,r){return Mi(t,e,G(r,2),!0)},c.sortedLastIndexOf=function(t,e){if(t!=null&&t.length){var r=ts(t,e,!0)-1;if(Ee(t[r],e))return r}return-1},c.startCase=Md,c.startsWith=function(t,e,r){return t=ot(t),r=r==null?0:Sn(X(r),0,t.length),e=ie(e),t.slice(r,r+e.length)==e},c.subtract=$d,c.sum=function(t){return t&&t.length?ui(t,Qt):0},c.sumBy=function(t,e){return t&&t.length?ui(t,G(e,2)):0},c.template=function(t,e,r){var a=c.templateSettings;r&&$t(t,e,r)&&(e=s),t=ot(t),e=ms({},e,a,gu);var u,h,p=ms({},e.imports,a.imports,gu),m=qt(p),v=li(p,m),x=0,C=e.interpolate||Fr,T="__p += '",P=di((e.escape||Fr).source+"|"+C.source+"|"+(C===ka?dl:Fr).source+"|"+(e.evaluate||Fr).source+"|$","g"),L="//# sourceURL="+(lt.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ql+"]")+`
`;t.replace(P,function(M,B,R,Y,V,at){return R||(R=Y),T+=t.slice(x,at).replace(yl,Wl),B&&(u=!0,T+=`' +
__e(`+B+`) +
'`),V&&(h=!0,T+=`';
`+V+`;
__p += '`),R&&(T+=`' +
((__t = (`+R+`)) == null ? '' : __t) +
'`),x=at+M.length,M}),T+=`';
`;var j=lt.call(e,"variable")&&e.variable;if(j){if(ll.test(j))throw new st("Invalid `variable` option passed into `_.template`")}else T=`with (obj) {
`+T+`
}
`;T=(h?T.replace(Zc,""):T).replace(Yc,"$1").replace(Jc,"$1;"),T="function("+(j||"obj")+`) {
`+(j?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(u?", __e = _.escape":"")+(h?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+T+`return __p
}`;var w=sc(function(){return Tt(m,L+"return "+T).apply(s,v)});if(w.source=T,Yi(w))throw w;return w},c.times=function(t,e){if((t=X(t))<1||t>q)return[];var r=tt,a=Ht(t,tt);e=G(e),t-=tt;for(var u=ci(a,e);++r<t;)e(r);return u},c.toFinite=Ke,c.toInteger=X,c.toLength=Zu,c.toLower=function(t){return ot(t).toLowerCase()},c.toNumber=Se,c.toSafeInteger=function(t){return t?Sn(X(t),-9007199254740991,q):t===0?t:0},c.toString=ot,c.toUpper=function(t){return ot(t).toUpperCase()},c.trim=function(t,e,r){if((t=ot(t))&&(r||e===s))return po(t);if(!t||!(e=ie(e)))return t;var a=we(t),u=we(e);return cn(a,_o(a,u),mo(a,u)+1).join("")},c.trimEnd=function(t,e,r){if((t=ot(t))&&(r||e===s))return t.slice(0,yo(t)+1);if(!t||!(e=ie(e)))return t;var a=we(t);return cn(a,0,mo(a,we(e))+1).join("")},c.trimStart=function(t,e,r){if((t=ot(t))&&(r||e===s))return t.replace(Js,"");if(!t||!(e=ie(e)))return t;var a=we(t);return cn(a,_o(a,we(e))).join("")},c.truncate=function(t,e){var r=30,a="...";if(St(e)){var u="separator"in e?e.separator:u;r="length"in e?X(e.length):r,a="omission"in e?ie(e.omission):a}var h=(t=ot(t)).length;if(kn(t)){var p=we(t);h=p.length}if(r>=h)return t;var m=r-Pn(a);if(m<1)return a;var v=p?cn(p,0,m).join(""):t.slice(0,m);if(u===s)return v+a;if(p&&(m+=v.length-m),Ji(u)){if(t.slice(m).search(u)){var x,C=v;for(u.global||(u=di(u.source,ot(Pa.exec(u))+"g")),u.lastIndex=0;x=u.exec(C);)var T=x.index;v=v.slice(0,T===s?m:T)}}else if(t.indexOf(ie(u),m)!=m){var P=v.lastIndexOf(u);P>-1&&(v=v.slice(0,P))}return v+a},c.unescape=function(t){return(t=ot(t))&&Kc.test(t)?t.replace(Oa,$l):t},c.uniqueId=function(t){var e=++Yl;return ot(t)+e},c.upperCase=Ad,c.upperFirst=Qi,c.each=Pu,c.eachRight=Nu,c.first=qu,na(c,(aa={},Ne(c,function(t,e){lt.call(c.prototype,e)||(aa[e]=t)}),aa),{chain:!1}),c.VERSION="4.17.21",pe(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){c[t].placeholder=c}),pe(["drop","take"],function(t,e){nt.prototype[t]=function(r){r=r===s?1:Mt(X(r),0);var a=this.__filtered__&&!e?new nt(this):this.clone();return a.__filtered__?a.__takeCount__=Ht(r,a.__takeCount__):a.__views__.push({size:Ht(r,tt),type:t+(a.__dir__<0?"Right":"")}),a},nt.prototype[t+"Right"]=function(r){return this.reverse()[t](r).reverse()}}),pe(["filter","map","takeWhile"],function(t,e){var r=e+1,a=r==1||r==3;nt.prototype[t]=function(u){var h=this.clone();return h.__iteratees__.push({iteratee:G(u,3),type:r}),h.__filtered__=h.__filtered__||a,h}}),pe(["head","last"],function(t,e){var r="take"+(e?"Right":"");nt.prototype[t]=function(){return this[r](1).value()[0]}}),pe(["initial","tail"],function(t,e){var r="drop"+(e?"":"Right");nt.prototype[t]=function(){return this.__filtered__?new nt(this):this[r](1)}}),nt.prototype.compact=function(){return this.filter(Qt)},nt.prototype.find=function(t){return this.filter(t).head()},nt.prototype.findLast=function(t){return this.reverse().find(t)},nt.prototype.invokeMap=Q(function(t,e){return typeof t=="function"?new nt(this):this.map(function(r){return gr(r,t,e)})}),nt.prototype.reject=function(t){return this.filter(gs(G(t)))},nt.prototype.slice=function(t,e){t=X(t);var r=this;return r.__filtered__&&(t>0||e<0)?new nt(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),e!==s&&(r=(e=X(e))<0?r.dropRight(-e):r.take(e-t)),r)},nt.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},nt.prototype.toArray=function(){return this.take(tt)},Ne(nt.prototype,function(t,e){var r=/^(?:filter|find|map|reject)|While$/.test(e),a=/^(?:head|last)$/.test(e),u=c[a?"take"+(e=="last"?"Right":""):e],h=a||/^find/.test(e);u&&(c.prototype[e]=function(){var p=this.__wrapped__,m=a?[1]:arguments,v=p instanceof nt,x=m[0],C=v||K(p),T=function(B){var R=u.apply(c,nn([B],m));return a&&P?R[0]:R};C&&r&&typeof x=="function"&&x.length!=1&&(v=C=!1);var P=this.__chain__,L=!!this.__actions__.length,j=h&&!P,w=v&&!L;if(!h&&C){p=w?p:new nt(this);var M=t.apply(p,m);return M.__actions__.push({func:ls,args:[T],thisArg:s}),new me(M,P)}return j&&w?t.apply(this,m):(M=this.thru(T),j?a?M.value()[0]:M.value():M)})}),pe(["pop","push","shift","sort","splice","unshift"],function(t){var e=Pr[t],r=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",a=/^(?:pop|shift)$/.test(t);c.prototype[t]=function(){var u=arguments;if(a&&!this.__chain__){var h=this.value();return e.apply(K(h)?h:[],u)}return this[r](function(p){return e.apply(K(p)?p:[],u)})}}),Ne(nt.prototype,function(t,e){var r=c[e];if(r){var a=r.name+"";lt.call(Hn,a)||(Hn[a]=[]),Hn[a].push({name:e,func:r})}}),Hn[rs(s,2).name]=[{name:"wrapper",func:s}],nt.prototype.clone=function(){var t=new nt(this.__wrapped__);return t.__actions__=Jt(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Jt(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Jt(this.__views__),t},nt.prototype.reverse=function(){if(this.__filtered__){var t=new nt(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},nt.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,r=K(t),a=e<0,u=r?t.length:0,h=function(at,H,$){for(var At=-1,It=$.length;++At<It;){var Vt=$[At],pt=Vt.size;switch(Vt.type){case"drop":at+=pt;break;case"dropRight":H-=pt;break;case"take":H=Ht(H,at+pt);break;case"takeRight":at=Mt(at,H-pt)}}return{start:at,end:H}}(0,u,this.__views__),p=h.start,m=h.end,v=m-p,x=a?m:p-1,C=this.__iteratees__,T=C.length,P=0,L=Ht(v,this.__takeCount__);if(!r||!a&&u==v&&L==v)return Ko(t,this.__actions__);var j=[];t:for(;v--&&P<L;){for(var w=-1,M=t[x+=e];++w<T;){var B=C[w],R=B.iteratee,Y=B.type,V=R(M);if(Y==2)M=V;else if(!V){if(Y==1)continue t;break t}}j[P++]=M}return j},c.prototype.at=Vh,c.prototype.chain=function(){return ku(this)},c.prototype.commit=function(){return new me(this.value(),this.__chain__)},c.prototype.next=function(){this.__values__===s&&(this.__values__=Vu(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?s:this.__values__[this.__index__++]}},c.prototype.plant=function(t){for(var e,r=this;r instanceof Yr;){var a=Mu(r);a.__index__=0,a.__values__=s,e?u.__wrapped__=a:e=a;var u=a;r=r.__wrapped__}return u.__wrapped__=t,e},c.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof nt){var e=t;return this.__actions__.length&&(e=new nt(this)),(e=e.reverse()).__actions__.push({func:ls,args:[Bi],thisArg:s}),new me(e,this.__chain__)}return this.thru(Bi)},c.prototype.toJSON=c.prototype.valueOf=c.prototype.value=function(){return Ko(this.__wrapped__,this.__actions__)},c.prototype.first=c.prototype.head,or&&(c.prototype[or]=function(){return this}),c}();mn?((mn.exports=Nn)._=Nn,ei._=Nn):Nt._=Nn}).call(Sr);var wg=Ma.exports;const Of=s=>({}),xc=s=>({}),Df=s=>({}),wc=s=>({});function Ic(s){let n,i,o;return{c(){n=Ds("div"),i=Ds("div"),o=Fc(s[3]),ct(i,"class","c-filespan__dir-text svelte-sprpft"),ct(n,"class","c-filespan__dir svelte-sprpft")},m(l,f){Tr(l,n,f),je(n,i),je(i,o)},p(l,f){8&f&&Rc(o,l[3])},d(l){l&&Mr(n)}}}function kf(s){let n,i,o,l,f,_,b,S;const A=s[7].leftIcon,q=lc(A,s,s[8],wc);let D=!s[2]&&Ic(s);const tt=s[7].rightIcon,et=lc(tt,s,s[8],xc);return{c(){n=Ds("div"),q&&q.c(),i=la(),o=Ds("span"),l=Fc(s[4]),f=la(),D&&D.c(),_=la(),et&&et.c(),ct(o,"class","c-filespan__filename svelte-sprpft"),ct(n,"class",b=hc(`c-filespan ${s[0]}`)+" svelte-sprpft")},m(N,rt){Tr(N,n,rt),q&&q.m(n,null),je(n,i),je(n,o),je(o,l),je(n,f),D&&D.m(n,null),je(n,_),et&&et.m(n,null),S=!0},p(N,rt){q&&q.p&&(!S||256&rt)&&dc(q,A,N,N[8],S?gc(A,N[8],rt,Df):fc(N[8]),wc),(!S||16&rt)&&Rc(l,N[4]),N[2]?D&&(D.d(1),D=null):D?D.p(N,rt):(D=Ic(N),D.c(),D.m(n,_)),et&&et.p&&(!S||256&rt)&&dc(et,tt,N,N[8],S?gc(tt,N[8],rt,Of):fc(N[8]),xc),(!S||1&rt&&b!==(b=hc(`c-filespan ${N[0]}`)+" svelte-sprpft"))&&ct(n,"class",b)},i(N){S||(ga(q,N),ga(et,N),S=!0)},o(N){pa(q,N),pa(et,N),S=!1},d(N){N&&Mr(n),q&&q.d(N),D&&D.d(),et&&et.d(N)}}}function Pf(s){let n,i;return n=new Jd({props:{size:s[1],$$slots:{default:[kf]},$$scope:{ctx:s}}}),{c(){Kd(n.$$.fragment)},m(o,l){Xd(n,o,l),i=!0},p(o,[l]){const f={};2&l&&(f.size=o[1]),285&l&&(f.$$scope={dirty:l,ctx:o}),n.$set(f)},i(o){i||(ga(n.$$.fragment,o),i=!0)},o(o){pa(n.$$.fragment,o),i=!1},d(o){Qd(n,o)}}}function Nf(s,n,i){let o,l,f,{$$slots:_={},$$scope:b}=n,{class:S=""}=n,{filepath:A}=n,{size:q=1}=n,{nopath:D=!1}=n;return s.$$set=tt=>{"class"in tt&&i(0,S=tt.class),"filepath"in tt&&i(5,A=tt.filepath),"size"in tt&&i(1,q=tt.size),"nopath"in tt&&i(2,D=tt.nopath),"$$scope"in tt&&i(8,b=tt.$$scope)},s.$$.update=()=>{32&s.$$.dirty&&i(6,o=qc(A)),64&s.$$.dirty&&i(4,l=sf(o)),64&s.$$.dirty&&i(3,f=af(o))},[S,q,D,f,l,A,o,_,b]}class Ig extends Ps{constructor(n){super(),Ns(this,n,Nf,Pf,Us,{class:0,filepath:5,size:1,nopath:2})}}function Uf(s){let n,i;return{c(){n=nr("svg"),i=nr("path"),ct(i,"fill-rule","evenodd"),ct(i,"clip-rule","evenodd"),ct(i,"d","M13.71 4.29L10.71 1.29L10 1H4L3 2V14L4 15H13L14 14V5L13.71 4.29ZM13 14H4V2H9V6H13V14ZM10 5V2L13 5H10Z"),ct(i,"fill","currentColor"),ct(n,"width","16"),ct(n,"height","16"),ct(n,"viewBox","0 0 16 16"),ct(n,"fill","none"),ct(n,"xmlns","http://www.w3.org/2000/svg")},m(o,l){Tr(o,n,l),je(n,i)},p:tn,i:tn,o:tn,d(o){o&&Mr(n)}}}let Eg=class extends Ps{constructor(s){super(),Ns(this,s,null,Uf,Us,{})}};function Lf(s){let n,i;return{c(){n=nr("svg"),i=nr("path"),ct(i,"d","M1.5 14H12.5L12.98 13.63L15.61 6.63L15.13 6H14V3.5L13.5 3H7.70996L6.84998 2.15002L6.5 2H1.5L1 2.5V13.5L1.5 14ZM2 3H6.29004L7.15002 3.84998L7.5 4H13V6H8.5L8.15002 6.15002L7.29004 7H3.5L3.03003 7.33997L2.03003 10.42L2 3ZM12.13 13H2.18994L3.85999 8H7.5L7.84998 7.84998L8.70996 7H14.5L12.13 13Z"),ct(i,"fill","currentColor"),ct(n,"width","16"),ct(n,"height","16"),ct(n,"viewBox","0 0 16 16"),ct(n,"fill","none"),ct(n,"xmlns","http://www.w3.org/2000/svg")},m(o,l){Tr(o,n,l),je(n,i)},p:tn,i:tn,o:tn,d(o){o&&Mr(n)}}}class Tg extends Ps{constructor(n){super(),Ns(this,n,null,Lf,Us,{})}}function Mg(){const s=tf("chatModel");return s||console.warn("ChatModel not found in context"),s}function Ag(s){return ef("chatModel",s),s}export{jc as $,Tn as A,Pc as B,Sg as C,Nc as D,ut as E,pf as F,Uc as G,ya as H,_c as I,va as J,Aa as K,og as L,mc as M,Ig as N,Tg as O,Pt as P,Eg as Q,Yn as R,Wt as S,Qe as T,cg as U,Ff as V,_g as W,_a as X,xt as Y,pg as Z,mg as _,Yf as a,vf as a0,Ls as a1,vg as a2,mf as a3,Jn as a4,Ef as a5,bg as a6,Fa as a7,of as a8,Zn as a9,ee as aa,yg as ab,tg as ac,Mg as ad,ig as ae,ug as af,kt as ag,df as ah,ff as ai,gf as aj,lf as ak,Gc as al,gg as am,Jf as b,Xf as c,Kf as d,$f as e,Vf as f,Zf as g,Qf as h,de as i,wr as j,rg as k,sg as l,Cg as m,te as n,xg as o,ng as p,eg as q,fg as r,Ag as s,dg as t,ag as u,Dc as v,lg as w,hg as x,wg as y,Kn as z};
