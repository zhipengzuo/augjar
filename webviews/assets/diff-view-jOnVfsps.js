var en=Object.defineProperty;var nn=(r,t,e)=>t in r?en(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var _=(r,t,e)=>nn(r,typeof t!="symbol"?t+"":t,e);import{al as ge,am as rn,a9 as Lt,ay as ai,ab as ct,ac as Ae,S as me,d as _e,e as $e,Y as $t,y as H,Q as Z,z as S,j as q,E as nt,R as Tt,k as x,l as U,A as j,T as ki,G as kt,b as y,a as ut,t as b,c as dt,m as O,B as A,I as Fe,a7 as Wt,a0 as rt,K as Qt,ap as on,aq as sn,a4 as ye,n as J,af as _t,ag as wi,a2 as Ne,az as an,Z as Mi,ae as Ei,ah as cn,aj as un,a8 as dn,U as ln,aA as fn,aB as hn}from"./index-p4Dt6o3z.js";import"./design-system-init-Bqt81Pxb.js";import{g as pn}from"./globals-D0QH3NT1.js";import{h as Yt,W as Y,D as Se,a as wt,e as ci}from"./ButtonAugment-DueOA3_V.js";import{A as gn,I as mn}from"./IconButtonAugment-B0XoCIXT.js";import{d as ui,a as _n}from"./Content-7zb4jZEH.js";import{F as $n,C as xi,m as Oi,o as yn,s as vn}from"./chat-context-Dq8CyOam.js";import{r as bn,a as di}from"./monaco-render-utils-DfwV7QLY.js";import{M as Ii,T as Cn}from"./TextTooltipAugment-C0ygVke5.js";import{K as Vt,R as Si,P as kn,a as wn,b as Mn,c as En}from"./Keybindings-BPBUBuVi.js";import"./pen-to-square-DUXCbbi7.js";import"./file-paths-BEF4tZXQ.js";import"./index-CkBhOCxh.js";import"./MaterialIcon-9THX1buP.js";import"./exclamation-triangle-BQxrhBcR.js";import"./augment-logo-C66YBCMf.js";var Le={exports:{}};(function(r,t){var e="__lodash_hash_undefined__",n=1,i=2,o=9007199254740991,s="[object Arguments]",a="[object Array]",u="[object AsyncFunction]",p="[object Boolean]",l="[object Date]",f="[object Error]",h="[object Function]",m="[object GeneratorFunction]",C="[object Map]",I="[object Number]",M="[object Null]",$="[object Object]",k="[object Promise]",B="[object Proxy]",Q="[object RegExp]",P="[object Set]",et="[object String]",G="[object Symbol]",X="[object Undefined]",D="[object WeakMap]",ot="[object ArrayBuffer]",Et="[object DataView]",Jt=/^\[object .+?Constructor\]$/,st=/^(?:0|[1-9]\d*)$/,N={};N["[object Float32Array]"]=N["[object Float64Array]"]=N["[object Int8Array]"]=N["[object Int16Array]"]=N["[object Int32Array]"]=N["[object Uint8Array]"]=N["[object Uint8ClampedArray]"]=N["[object Uint16Array]"]=N["[object Uint32Array]"]=!0,N[s]=N[a]=N[ot]=N[p]=N[Et]=N[l]=N[f]=N[h]=N[C]=N[I]=N[$]=N[Q]=N[P]=N[et]=N[D]=!1;var Ft=typeof ge=="object"&&ge&&ge.Object===Object&&ge,xt=typeof self=="object"&&self&&self.Object===Object&&self,tt=Ft||xt||Function("return this")(),w=t&&!t.nodeType&&t,Ot=w&&r&&!r.nodeType&&r,Dt=Ot&&Ot.exports===w,Ut=Dt&&Ft.process,Xt=function(){try{return Ut&&Ut.binding&&Ut.binding("util")}catch{}}(),De=Xt&&Xt.isTypedArray;function Ai(c,d){for(var g=-1,v=c==null?0:c.length;++g<v;)if(d(c[g],g,c))return!0;return!1}function Ni(c){var d=-1,g=Array(c.size);return c.forEach(function(v,F){g[++d]=[F,v]}),g}function Li(c){var d=-1,g=Array(c.size);return c.forEach(function(v){g[++d]=v}),g}var Re,ze,Pe,Vi=Array.prototype,Fi=Function.prototype,te=Object.prototype,ve=tt["__core-js_shared__"],Te=Fi.toString,lt=te.hasOwnProperty,We=(Re=/[^.]+$/.exec(ve&&ve.keys&&ve.keys.IE_PROTO||""))?"Symbol(src)_1."+Re:"",Ue=te.toString,Di=RegExp("^"+Te.call(lt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),qe=Dt?tt.Buffer:void 0,ee=tt.Symbol,Be=tt.Uint8Array,He=te.propertyIsEnumerable,Ri=Vi.splice,It=ee?ee.toStringTag:void 0,Ze=Object.getOwnPropertySymbols,zi=qe?qe.isBuffer:void 0,Pi=(ze=Object.keys,Pe=Object,function(c){return ze(Pe(c))}),be=Rt(tt,"DataView"),qt=Rt(tt,"Map"),Ce=Rt(tt,"Promise"),ke=Rt(tt,"Set"),we=Rt(tt,"WeakMap"),Bt=Rt(Object,"create"),Ti=At(be),Wi=At(qt),Ui=At(Ce),qi=At(ke),Bi=At(we),Ge=ee?ee.prototype:void 0,Me=Ge?Ge.valueOf:void 0;function St(c){var d=-1,g=c==null?0:c.length;for(this.clear();++d<g;){var v=c[d];this.set(v[0],v[1])}}function ht(c){var d=-1,g=c==null?0:c.length;for(this.clear();++d<g;){var v=c[d];this.set(v[0],v[1])}}function jt(c){var d=-1,g=c==null?0:c.length;for(this.clear();++d<g;){var v=c[d];this.set(v[0],v[1])}}function ie(c){var d=-1,g=c==null?0:c.length;for(this.__data__=new jt;++d<g;)this.add(c[d])}function yt(c){var d=this.__data__=new ht(c);this.size=d.size}function Hi(c,d){var g=oe(c),v=!g&&Yi(c),F=!g&&!v&&Ee(c),E=!g&&!v&&!F&&ni(c),R=g||v||F||E,z=R?function(W,ft){for(var pt=-1,K=Array(W);++pt<W;)K[pt]=ft(pt);return K}(c.length,String):[],at=z.length;for(var T in c)!lt.call(c,T)||R&&(T=="length"||F&&(T=="offset"||T=="parent")||E&&(T=="buffer"||T=="byteLength"||T=="byteOffset")||Qi(T,at))||z.push(T);return z}function ne(c,d){for(var g=c.length;g--;)if(Xe(c[g][0],d))return g;return-1}function Ht(c){return c==null?c===void 0?X:M:It&&It in Object(c)?function(d){var g=lt.call(d,It),v=d[It];try{d[It]=void 0;var F=!0}catch{}var E=Ue.call(d);return F&&(g?d[It]=v:delete d[It]),E}(c):function(d){return Ue.call(d)}(c)}function Ke(c){return Zt(c)&&Ht(c)==s}function Qe(c,d,g,v,F){return c===d||(c==null||d==null||!Zt(c)&&!Zt(d)?c!=c&&d!=d:function(E,R,z,at,T,W){var ft=oe(E),pt=oe(R),K=ft?a:vt(E),gt=pt?a:vt(R),zt=(K=K==s?$:K)==$,se=(gt=gt==s?$:gt)==$,Pt=K==gt;if(Pt&&Ee(E)){if(!Ee(R))return!1;ft=!0,zt=!1}if(Pt&&!zt)return W||(W=new yt),ft||ni(E)?Ye(E,R,z,at,T,W):function(V,L,ae,bt,xe,it,mt){switch(ae){case Et:if(V.byteLength!=L.byteLength||V.byteOffset!=L.byteOffset)return!1;V=V.buffer,L=L.buffer;case ot:return!(V.byteLength!=L.byteLength||!it(new Be(V),new Be(L)));case p:case l:case I:return Xe(+V,+L);case f:return V.name==L.name&&V.message==L.message;case Q:case et:return V==L+"";case C:var Ct=Ni;case P:var Kt=bt&n;if(Ct||(Ct=Li),V.size!=L.size&&!Kt)return!1;var ce=mt.get(V);if(ce)return ce==L;bt|=i,mt.set(V,L);var Oe=Ye(Ct(V),Ct(L),bt,xe,it,mt);return mt.delete(V),Oe;case G:if(Me)return Me.call(V)==Me.call(L)}return!1}(E,R,K,z,at,T,W);if(!(z&n)){var Gt=zt&&lt.call(E,"__wrapped__"),ri=se&&lt.call(R,"__wrapped__");if(Gt||ri){var Xi=Gt?E.value():E,tn=ri?R.value():R;return W||(W=new yt),T(Xi,tn,z,at,W)}}return Pt?(W||(W=new yt),function(V,L,ae,bt,xe,it){var mt=ae&n,Ct=Je(V),Kt=Ct.length,ce=Je(L),Oe=ce.length;if(Kt!=Oe&&!mt)return!1;for(var ue=Kt;ue--;){var Nt=Ct[ue];if(!(mt?Nt in L:lt.call(L,Nt)))return!1}var oi=it.get(V);if(oi&&it.get(L))return oi==L;var de=!0;it.set(V,L),it.set(L,V);for(var Ie=mt;++ue<Kt;){var le=V[Nt=Ct[ue]],fe=L[Nt];if(bt)var si=mt?bt(fe,le,Nt,L,V,it):bt(le,fe,Nt,V,L,it);if(!(si===void 0?le===fe||xe(le,fe,ae,bt,it):si)){de=!1;break}Ie||(Ie=Nt=="constructor")}if(de&&!Ie){var he=V.constructor,pe=L.constructor;he==pe||!("constructor"in V)||!("constructor"in L)||typeof he=="function"&&he instanceof he&&typeof pe=="function"&&pe instanceof pe||(de=!1)}return it.delete(V),it.delete(L),de}(E,R,z,at,T,W)):!1}(c,d,g,v,Qe,F))}function Zi(c){return!(!ii(c)||function(d){return!!We&&We in d}(c))&&(ti(c)?Di:Jt).test(At(c))}function Gi(c){if(g=(d=c)&&d.constructor,v=typeof g=="function"&&g.prototype||te,d!==v)return Pi(c);var d,g,v,F=[];for(var E in Object(c))lt.call(c,E)&&E!="constructor"&&F.push(E);return F}function Ye(c,d,g,v,F,E){var R=g&n,z=c.length,at=d.length;if(z!=at&&!(R&&at>z))return!1;var T=E.get(c);if(T&&E.get(d))return T==d;var W=-1,ft=!0,pt=g&i?new ie:void 0;for(E.set(c,d),E.set(d,c);++W<z;){var K=c[W],gt=d[W];if(v)var zt=R?v(gt,K,W,d,c,E):v(K,gt,W,c,d,E);if(zt!==void 0){if(zt)continue;ft=!1;break}if(pt){if(!Ai(d,function(se,Pt){if(Gt=Pt,!pt.has(Gt)&&(K===se||F(K,se,g,v,E)))return pt.push(Pt);var Gt})){ft=!1;break}}else if(K!==gt&&!F(K,gt,g,v,E)){ft=!1;break}}return E.delete(c),E.delete(d),ft}function Je(c){return function(d,g,v){var F=g(d);return oe(d)?F:function(E,R){for(var z=-1,at=R.length,T=E.length;++z<at;)E[T+z]=R[z];return E}(F,v(d))}(c,Ji,Ki)}function re(c,d){var g,v,F=c.__data__;return((v=typeof(g=d))=="string"||v=="number"||v=="symbol"||v=="boolean"?g!=="__proto__":g===null)?F[typeof d=="string"?"string":"hash"]:F.map}function Rt(c,d){var g=function(v,F){return v==null?void 0:v[F]}(c,d);return Zi(g)?g:void 0}St.prototype.clear=function(){this.__data__=Bt?Bt(null):{},this.size=0},St.prototype.delete=function(c){var d=this.has(c)&&delete this.__data__[c];return this.size-=d?1:0,d},St.prototype.get=function(c){var d=this.__data__;if(Bt){var g=d[c];return g===e?void 0:g}return lt.call(d,c)?d[c]:void 0},St.prototype.has=function(c){var d=this.__data__;return Bt?d[c]!==void 0:lt.call(d,c)},St.prototype.set=function(c,d){var g=this.__data__;return this.size+=this.has(c)?0:1,g[c]=Bt&&d===void 0?e:d,this},ht.prototype.clear=function(){this.__data__=[],this.size=0},ht.prototype.delete=function(c){var d=this.__data__,g=ne(d,c);return!(g<0)&&(g==d.length-1?d.pop():Ri.call(d,g,1),--this.size,!0)},ht.prototype.get=function(c){var d=this.__data__,g=ne(d,c);return g<0?void 0:d[g][1]},ht.prototype.has=function(c){return ne(this.__data__,c)>-1},ht.prototype.set=function(c,d){var g=this.__data__,v=ne(g,c);return v<0?(++this.size,g.push([c,d])):g[v][1]=d,this},jt.prototype.clear=function(){this.size=0,this.__data__={hash:new St,map:new(qt||ht),string:new St}},jt.prototype.delete=function(c){var d=re(this,c).delete(c);return this.size-=d?1:0,d},jt.prototype.get=function(c){return re(this,c).get(c)},jt.prototype.has=function(c){return re(this,c).has(c)},jt.prototype.set=function(c,d){var g=re(this,c),v=g.size;return g.set(c,d),this.size+=g.size==v?0:1,this},ie.prototype.add=ie.prototype.push=function(c){return this.__data__.set(c,e),this},ie.prototype.has=function(c){return this.__data__.has(c)},yt.prototype.clear=function(){this.__data__=new ht,this.size=0},yt.prototype.delete=function(c){var d=this.__data__,g=d.delete(c);return this.size=d.size,g},yt.prototype.get=function(c){return this.__data__.get(c)},yt.prototype.has=function(c){return this.__data__.has(c)},yt.prototype.set=function(c,d){var g=this.__data__;if(g instanceof ht){var v=g.__data__;if(!qt||v.length<199)return v.push([c,d]),this.size=++g.size,this;g=this.__data__=new jt(v)}return g.set(c,d),this.size=g.size,this};var Ki=Ze?function(c){return c==null?[]:(c=Object(c),function(d,g){for(var v=-1,F=d==null?0:d.length,E=0,R=[];++v<F;){var z=d[v];g(z,v,d)&&(R[E++]=z)}return R}(Ze(c),function(d){return He.call(c,d)}))}:function(){return[]},vt=Ht;function Qi(c,d){return!!(d=d??o)&&(typeof c=="number"||st.test(c))&&c>-1&&c%1==0&&c<d}function At(c){if(c!=null){try{return Te.call(c)}catch{}try{return c+""}catch{}}return""}function Xe(c,d){return c===d||c!=c&&d!=d}(be&&vt(new be(new ArrayBuffer(1)))!=Et||qt&&vt(new qt)!=C||Ce&&vt(Ce.resolve())!=k||ke&&vt(new ke)!=P||we&&vt(new we)!=D)&&(vt=function(c){var d=Ht(c),g=d==$?c.constructor:void 0,v=g?At(g):"";if(v)switch(v){case Ti:return Et;case Wi:return C;case Ui:return k;case qi:return P;case Bi:return D}return d});var Yi=Ke(function(){return arguments}())?Ke:function(c){return Zt(c)&&lt.call(c,"callee")&&!He.call(c,"callee")},oe=Array.isArray,Ee=zi||function(){return!1};function ti(c){if(!ii(c))return!1;var d=Ht(c);return d==h||d==m||d==u||d==B}function ei(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=o}function ii(c){var d=typeof c;return c!=null&&(d=="object"||d=="function")}function Zt(c){return c!=null&&typeof c=="object"}var ni=De?function(c){return function(d){return c(d)}}(De):function(c){return Zt(c)&&ei(c.length)&&!!N[Ht(c)]};function Ji(c){return(d=c)!=null&&ei(d.length)&&!ti(d)?Hi(c):Gi(c);var d}r.exports=function(c,d){return Qe(c,d)}})(Le,Le.exports);const xn=rn(Le.exports);function ji(r){return function(t){return"unitOfCodeWork"in t&&!function(e){return e.children.length>0&&"childIds"in e}(t)}(r)?[r]:r.children.flatMap(ji)}var Mt=(r=>(r.edit="edit",r.instruction="instruction",r))(Mt||{}),Ve=(r=>(r[r.instructionDrawer=0]="instructionDrawer",r[r.chunkActionPanel=1]="chunkActionPanel",r))(Ve||{});class On{constructor(t,e,n){_(this,"_originalModel");_(this,"_modifiedModel");_(this,"_fullEdits",[]);_(this,"_currEdit");_(this,"_currOriginalEdit");_(this,"swapBaseModel",t=>{this._originalModel.setValue(t),this._modifiedModel.setValue(t),this._fullEdits.forEach(e=>{this._modifiedModel.applyEdits([e])}),this._currEdit&&this._modifiedModel.applyEdits([this._currEdit]),this._currOriginalEdit&&this._originalModel.applyEdits([this._currOriginalEdit])});_(this,"finish",()=>this._completeCurrEdit());_(this,"onReceiveChunk",t=>t.data.newChunkStart?this._startNewEdit(t.data.newChunkStart):t.data.chunkContinue&&this._currEdit?this._continueEdit(t.data.chunkContinue):t.data.chunkEnd&&this._currEdit?this._completeCurrEdit(t.data.chunkEnd):void 0);_(this,"_completeCurrEdit",t=>{const e={resetOriginal:[],original:[],modified:[]};if(!t)return e;if(this._currEdit){this._currEdit.range=new this._monaco.Range(t.stagedStartLine,0,t.stagedEndLine,0);const n=this._nextModifiedInsertPosition(),i=t.stagedEndLine-t.stagedStartLine,o={range:new this._monaco.Range(n.lineNumber,0,n.lineNumber+i,0),text:""};e.modified.push(o),this._modifiedModel.applyEdits([o]),this._fullEdits.push(this._currEdit),this._currEdit=void 0}return e});_(this,"_startNewEdit",t=>{const e={resetOriginal:[],original:[],modified:[]};return this._currOriginalEdit=void 0,this._currEdit={range:new this._monaco.Range(t.stagedStartLine,0,t.stagedStartLine,0),text:""},e.modified.push(this._currEdit),this._modifiedModel.applyEdits([this._currEdit]),e});_(this,"_continueEdit",t=>{if(!this._currEdit)throw new Error("No current edit");const e=this._nextModifiedInsertPosition(),n={...this._currEdit,text:t.newText,range:new this._monaco.Range(e.lineNumber,e.column,e.lineNumber,e.column)};return this._modifiedModel.applyEdits([n]),this._currEdit.text+=t.newText,{resetOriginal:[],original:[],modified:t.newText.length>0?[n]:[]}});_(this,"_nextModifiedInsertPosition",()=>{var e;if(!this._currEdit)throw new Error("No current edit");const t=this._modifiedModel.getOffsetAt({lineNumber:this._currEdit.range.startLineNumber,column:this._currEdit.range.startColumn})+(((e=this._currEdit.text)==null?void 0:e.length)??0);return this._modifiedModel.getPositionAt(t)});this.id=t,this.originalCode=e,this._monaco=n,this._originalModel=this._monaco.editor.createModel(e),this._modifiedModel=this._monaco.editor.createModel(e)}get hasReceivedFirstChunk(){return this._currEdit!==void 0||this._fullEdits.length>0}get originalValue(){return this._originalModel.getValue()}get modifiedValue(){return this._modifiedModel.getValue()}get currEdit(){return this._currEdit}}class In{constructor(t,e,n){_(this,"_asyncMsgSender");_(this,"_editor");_(this,"_chatModel");_(this,"_focusModel",new $n);_(this,"_hasScrolledOnInit",!1);_(this,"_markHasScrolledOnInit",ui(()=>{this._hasScrolledOnInit=!0},200));_(this,"_resetScrollOnInit",()=>{this._markHasScrolledOnInit.cancel(),this._hasScrolledOnInit=!1});_(this,"_subscribers",new Set);_(this,"_disposables",[]);_(this,"_rootChunk");_(this,"_keybindings",Lt({}));_(this,"_requestId",Lt(void 0));_(this,"requestId",this._requestId);_(this,"_disableResolution",Lt(!1));_(this,"disableResolution",ai(this._disableResolution));_(this,"_disableApply",Lt(!1));_(this,"disableApply",ai(this._disableApply));_(this,"_currStream");_(this,"_isLoadingDiffChunks",Lt(!1));_(this,"_selectionLines",Lt(void 0));_(this,"_mode",Lt(Mt.edit));_(this,"initializeEditor",t=>{var e,n,i,o,s,a,u,p,l,f,h,m;this._editor=this._monaco.editor.createDiffEditor(this._editorContainer,{automaticLayout:!0,theme:t,readOnly:!0,contextmenu:!1,renderSideBySide:!1,renderIndicators:!0,renderMarginRevertIcon:!1,originalEditable:!1,diffCodeLens:!1,renderOverviewRuler:!1,ignoreTrimWhitespace:!1,scrollBeyondLastLine:!0,maxComputationTime:0,minimap:{enabled:!1},padding:{top:16}}),this._editor.getOriginalEditor().updateOptions({lineNumbers:"off"}),this._chatModel=new xi(new Ii(Yt),Yt,new Oi),(n=(e=this._monaco.editor).registerCommand)==null||n.call(e,"acceptFocusedChunk",this.acceptFocusedChunk),(o=(i=this._monaco.editor).registerCommand)==null||o.call(i,"rejectFocusedChunk",this.rejectFocusedChunk),(a=(s=this._monaco.editor).registerCommand)==null||a.call(s,"acceptAllChunks",this.acceptAllChunks),(p=(u=this._monaco.editor).registerCommand)==null||p.call(u,"rejectAllChunks",this.rejectAllChunks),(f=(l=this._monaco.editor).registerCommand)==null||f.call(l,"focusNextChunk",this.focusNextChunk),(m=(h=this._monaco.editor).registerCommand)==null||m.call(h,"focusPrevChunk",this.focusPrevChunk),this._disposables.push(this._editor,this._editor.onDidUpdateDiff(this.onDidUpdateDiff),this._editor.getModifiedEditor().onMouseMove(this.onMouseMoveModified),{dispose:this._focusModel.subscribe(C=>this.notifySubscribers())}),this.initialize()});_(this,"subscribe",t=>(this._subscribers.add(t),t(this),()=>{this._subscribers.delete(t)}));_(this,"dispose",()=>{this._editor.dispose(),this._subscribers.clear(),this._disposables.forEach(t=>t.dispose())});_(this,"notifySubscribers",()=>{this._subscribers.forEach(t=>t(this))});_(this,"onDidUpdateDiff",()=>{var t;if(this.updateCodeChunk(),!this._hasScrolledOnInit&&((t=this.leaves)==null?void 0:t.length)){this._markHasScrolledOnInit();const e=this.leaves[0];this.revealChunk(e)}this.notifyDiffViewUpdated(),this.notifySubscribers()});_(this,"onMouseMoveModified",t=>{var i,o,s,a,u,p;if(((i=t.target.position)==null?void 0:i.lineNumber)===void 0||this.leaves===void 0)return;const e=this.editorOffset,n=(o=t.target.position)==null?void 0:o.lineNumber;for(let l=0;l<this.leaves.length;l++){const f=this.leaves[l],h=(s=f.unitOfCodeWork.lineChanges)==null?void 0:s.lineChanges[0].modifiedStart,m=(a=f.unitOfCodeWork.lineChanges)==null?void 0:a.lineChanges[0].modifiedEnd,C=(u=f.unitOfCodeWork.lineChanges)==null?void 0:u.lineChanges[0].originalStart,I=(p=f.unitOfCodeWork.lineChanges)==null?void 0:p.lineChanges[0].originalEnd;if(h!==void 0&&m!==void 0&&C!==void 0&&I!==void 0){if(h!==m||n!==h){if(h<=n&&n<m){this.setCurrFocusedChunkIdx(l,!1);break}}else if(t.target.type===this._monaco.editor.MouseTargetType.CONTENT_VIEW_ZONE){const M=this._editor.getOriginalEditor(),$=M.getOption(this._monaco.editor.EditorOption.lineHeight),k=M.getScrolledVisiblePosition({lineNumber:C,column:0}),B=M.getScrolledVisiblePosition({lineNumber:I+1,column:0});if(k===null||B===null)continue;const Q=k.top-$/2+e,P=B.top-$/2+e;if(t.event.posy>=Q&&t.event.posy<=P){this.setCurrFocusedChunkIdx(l,!1);break}break}}}});_(this,"updateIsWebviewFocused",async t=>{await this._asyncMsgSender.send({type:Y.diffViewWindowFocusChange,data:t})});_(this,"setCurrFocusedChunkIdx",(t,e=!0)=>{this._focusModel.focusedItemIdx!==t&&(this._focusModel.setFocusIdx(t),e&&this.revealCurrFocusedChunk(),this.notifySubscribers())});_(this,"revealCurrFocusedChunk",()=>{const t=this._focusModel.focusedItem;t&&this.revealChunk(t)});_(this,"revealChunk",t=>{var i;const e=(i=t.unitOfCodeWork.lineChanges)==null?void 0:i.lineChanges[0],n=e==null?void 0:e.modifiedStart;n!==void 0&&this._editor.revealLineNearTop(n-1)});_(this,"renderCentralOverlayWidget",t=>{const e=()=>({editor:this._editor,id:"central-overlay-widget"}),n=bn(t,e(),{monaco:this._monaco});return{update:()=>{n.update(e())},destroy:n.destroy}});_(this,"renderInstructionsDrawerViewZone",(t,e)=>{let n=!1,i=e;const o=e.autoFocus??!0,s=l=>{o&&!n&&(this._editor.revealLineNearTop(l),n=!0)},a=l=>({...l,ordinal:Ve.instructionDrawer,editor:this._editor,afterLineNumber:l.line}),u=di(t,a(e)),p=[];return o&&p.push(this._editor.onDidUpdateDiff(()=>{s(i.line)})),{update:l=>{const f={...i,...l};xn(f,i)||(u.update(a(f)),i=f,s(f.line))},destroy:()=>{u.destroy(),p.forEach(l=>l.dispose())}}});_(this,"renderActionsViewZone",(t,e)=>{const n=o=>{var a;let s;return s=o.chunk?(a=o.chunk.unitOfCodeWork.lineChanges)==null?void 0:a.lineChanges[0].modifiedStart:1,{...o,ordinal:Ve.chunkActionPanel,editor:this._editor,afterLineNumber:s?s-1:void 0}},i=di(t,n(e));return{update:o=>{i.update(n(o))},destroy:i.destroy}});_(this,"acceptAllChunks",()=>{this.leaves&&this.acceptChunks(this.leaves,!0)});_(this,"rejectAllChunks",()=>{this.leaves&&this.rejectChunks(this.leaves,!0)});_(this,"acceptFocusedChunk",()=>{const t=this._focusModel.focusedItem;t&&this.acceptChunk(t)});_(this,"rejectFocusedChunk",()=>{const t=this._focusModel.focusedItem;t&&this.rejectChunk(t)});_(this,"focusNextChunk",()=>{this._focusModel.focusNext(),this.revealCurrFocusedChunk()});_(this,"focusPrevChunk",()=>{this._focusModel.focusPrev(),this.revealCurrFocusedChunk()});_(this,"initialize",async()=>{var u;const t=await this._asyncMsgSender.send({type:Y.diffViewLoaded},2e3);this._resetScrollOnInit();const{file:e,instruction:n,keybindings:i,editable:o}=t.data;this._editor.updateOptions({readOnly:!o});const s=ct(this._keybindings);this._keybindings.set(i??s);const a=n==null?void 0:n.selection;a&&(a.start.line===a.end.line&&a.start.character===a.end.character&&this._mode.set(Mt.instruction),ct(this.selectionLines)===void 0&&this._selectionLines.set({start:a.start.line,end:a.end.line})),this.updateModels(e.originalCode??"",e.modifiedCode??"",{rootPath:e.repoRoot,relPath:e.pathName}),(u=this._currStream)==null||u.finish(),this._currStream=void 0,this._disableResolution.set(!!t.data.disableResolution),this._disableApply.set(!!t.data.disableApply),await this._tryFetchStream(),this._syncStreamToModels()});_(this,"disposeDiffViewPanel",async()=>{await this._asyncMsgSender.send({type:Y.disposeDiffView})});_(this,"_tryFetchStream",async()=>{var e,n,i;const t=this._asyncMsgSender.stream({type:Y.diffViewFetchPendingStream},15e3,6e4);for await(const o of t)switch(o.type){case Y.diffViewDiffStreamStarted:{this.setLoading(!0),this._requestId.set(o.data.requestId);const s=this._editor.getOriginalEditor().getValue();this._currStream=new On(o.data.streamId,s,this._monaco),this._syncStreamToModels();break}case Y.diffViewDiffStreamEnded:if(((e=this._currStream)==null?void 0:e.id)!==o.data.streamId)return;this.setLoading(!1),this._cleanupStream();break;case Y.diffViewDiffStreamChunk:{if(((n=this._currStream)==null?void 0:n.id)!==o.data.streamId)return;const s=this._editor.getOriginalEditor().getModel();if(!this._editor.getModifiedEditor().getModel()||!s)return this.setLoading(!1),void this._cleanupStream();const a=(i=this._currStream)==null?void 0:i.onReceiveChunk(o);a&&(this._applyDeltaDiff(a),ct(this._selectionLines)!=null&&this._selectionLines.set(null));break}}});_(this,"handleMessageFromExtension",async t=>{switch(t.data.type){case Y.diffViewNotifyReinit:this.setLoading(!1),this._cleanupStream(),this.initialize();break;case Y.diffViewAcceptAllChunks:this.acceptAllChunks();break;case Y.diffViewAcceptFocusedChunk:this.acceptFocusedChunk();break;case Y.diffViewRejectFocusedChunk:this.rejectFocusedChunk();break;case Y.diffViewFocusPrevChunk:this.focusPrevChunk();break;case Y.diffViewFocusNextChunk:this.focusNextChunk()}});_(this,"_applyDeltaDiff",t=>{const e=this._editor.getOriginalEditor().getModel(),n=this._editor.getModifiedEditor().getModel();e&&n&&(e.pushEditOperations([],t.resetOriginal,()=>[]),t.original.forEach(i=>{e.pushEditOperations([],[i],()=>[])}),t.modified.forEach(i=>{n.pushEditOperations([],[i],()=>[])}))});_(this,"_cleanupStream",()=>{var t;if(this._currStream){const e=(t=this._currStream)==null?void 0:t.finish();this._applyDeltaDiff(e),this._currStream=void 0,this._resetScrollOnInit()}});_(this,"_syncStreamToModels",()=>{var n,i;const t=(n=this._currStream)==null?void 0:n.originalValue,e=(i=this._currStream)==null?void 0:i.modifiedValue;t&&t!==this._editor.getOriginalEditor().getValue()&&this._editor.getOriginalEditor().setValue(t),e&&e!==this._editor.getModifiedEditor().getValue()&&this._editor.getModifiedEditor().setValue(e)});_(this,"acceptChunk",async t=>{ct(this._disableApply)||this.acceptChunks([t])});_(this,"acceptChunks",async(t,e=!1)=>{ct(this._disableApply)||(this.executeDiffChunks(t,!0),this.notifyResolvedChunks(t,Se.accept,e),await Ae(),this.areModelsEqual()&&!ct(this.isLoading)&&this.disposeDiffViewPanel())});_(this,"areModelsEqual",()=>{var n,i;const t=(n=this._editor.getModel())==null?void 0:n.original,e=(i=this._editor.getModel())==null?void 0:i.modified;return(t==null?void 0:t.getValue())===(e==null?void 0:e.getValue())});_(this,"rejectChunk",async t=>{this.rejectChunks([t])});_(this,"rejectChunks",async(t,e=!1)=>{this.executeDiffChunks(t,!1),this.notifyResolvedChunks(t,Se.reject,e),await Ae(),this.areModelsEqual()&&!ct(this.isLoading)&&this.disposeDiffViewPanel()});_(this,"notifyDiffViewUpdated",ui(()=>{this.notifyResolvedChunks([],Se.accept)},1e3));_(this,"notifyResolvedChunks",async(t,e,n=!1)=>{var o;const i=(o=this._editor.getModel())==null?void 0:o.original.uri.path;i&&await this._asyncMsgSender.send({type:Y.diffViewResolveChunk,data:{file:{repoRoot:"",pathName:i,originalCode:this._originalCode,modifiedCode:this._modifiedCode},changes:t.map(s=>s.unitOfCodeWork),resolveType:e,shouldApplyToAll:n}},2e3)});_(this,"executeDiffChunks",(t,e)=>{var l,f,h;if(ct(this._disableResolution)||e&&ct(this._disableApply))return;const n=(l=this._editor.getModel())==null?void 0:l.original,i=(f=this._editor.getModel())==null?void 0:f.modified;if(!n||!i||this._currStream!==void 0)return;const o=[],s=[];for(const m of t){const C=(h=m.unitOfCodeWork.lineChanges)==null?void 0:h.lineChanges[0];if(!C||m.unitOfCodeWork.originalCode===void 0||m.unitOfCodeWork.modifiedCode===void 0)continue;let I={startLineNumber:C.originalStart,startColumn:1,endLineNumber:C.originalEnd,endColumn:1},M={startLineNumber:C.modifiedStart,startColumn:1,endLineNumber:C.modifiedEnd,endColumn:1};const $=e?m.unitOfCodeWork.modifiedCode:m.unitOfCodeWork.originalCode;$!==void 0&&(o.push({range:I,text:$}),s.push({range:M,text:$}))}n.pushEditOperations([],o,()=>[]),i.pushEditOperations([],s,()=>[]);const a=this._focusModel.nextIdx({nowrap:!0});if(a===void 0)return;const u=a===this._focusModel.focusedItemIdx?a-1:a,p=this._focusModel.items[u];p&&this.revealChunk(p)});_(this,"updateCodeChunk",()=>{this._rootChunk=this.computeCodeChunk(),this._focusModel.setItems(this.leaves??[]),this._focusModel.initFocusIdx(0),this.notifySubscribers()});_(this,"handleInstructionSubmit",t=>{const e=this._editor.getModifiedEditor(),n=this.getSelectedCodeDetails(e);if(!n)throw Error("No selected code details found");this._chatModel.currentConversationModel.sendInstructionExchange(t,n)});_(this,"updateModels",(t,e,n)=>{var s,a;const i=(a=(s=this._editor.getModel())==null?void 0:s.original)==null?void 0:a.uri,o=(n&&this._monaco.Uri.file(n.relPath))??i;if(o)if((i==null?void 0:i.fsPath)!==o.fsPath||(i==null?void 0:i.authority)!==o.authority){const u=o.with({fragment:crypto.randomUUID()}),p=o.with({fragment:crypto.randomUUID()});this._editor.setModel({original:this._monaco.editor.createModel(t,void 0,u),modified:this._monaco.editor.createModel(e??"",void 0,p)})}else this._originalCode!==t&&this.getOriginalEditor().setValue(t),this._modifiedCode!==e&&this.getModifiedEditor().setValue(e??"");else console.warn("No URI found for diff view. Not updating models.")});_(this,"updateTheme",t=>{this._monaco.editor.setTheme(t)});this._editorContainer=t,this._monaco=n,this._asyncMsgSender=new gn(i=>Yt.postMessage(i)),this.initializeEditor(e)}get editorOffset(){return this._editorContainer.getBoundingClientRect().top}get currFocusedChunkIdx(){return this._focusModel.focusedItemIdx}get selectionLines(){return this._selectionLines}get mode(){return this._mode}get keybindings(){return this._keybindings}getOriginalEditor(){return this._editor.getOriginalEditor()}getModifiedEditor(){return this._editor.getModifiedEditor()}get isLoading(){return{subscribe:this._isLoadingDiffChunks.subscribe}}setLoading(t){this._isLoadingDiffChunks.set(t)}get _originalCode(){var t;return((t=this._currStream)==null?void 0:t.originalCode)??this._editor.getOriginalEditor().getValue()}get _modifiedCode(){return this._editor.getModifiedEditor().getValue()}get leaves(){const t=this.codeChunk;if(t)return ji(t)}get codeChunk(){return this._rootChunk}computeCodeChunk(){var o,s;const t=[],e=this._editor.getLineChanges(),n=(o=this._editor.getModel())==null?void 0:o.original,i=(s=this._editor.getModel())==null?void 0:s.modified;if(e&&n&&i){for(const a of e){const u=li({startLineNumber:a.originalStartLineNumber,startColumn:1,endLineNumber:a.originalEndLineNumber,endColumn:1}),p=li({startLineNumber:a.modifiedStartLineNumber,startColumn:1,endLineNumber:a.modifiedEndLineNumber,endColumn:1}),l=Sn(this._editor,u,p);t.push(l)}return{id:crypto.randomUUID(),name:"",title:"",description:"",generationSource:"",supportedActions:[],children:t,childIds:t.map(a=>a.id)}}}getSelectedCodeDetails(t){const e=t.getModel();if(!e)return null;const n=e.getLanguageId(),i=1,o=1,s={lineNumber:e.getLineCount(),column:e.getLineMaxColumn(e.getLineCount())},a=ct(this._selectionLines);if(!a)throw new Error("No selection lines found");const u=Math.min(a.end+1,s.lineNumber),p=new this._monaco.Range(a.start+1,1,u,e.getLineMaxColumn(u));let l=e.getValueInRange(p);u<e.getLineCount()&&(l+=e.getEOL());const f=new this._monaco.Range(i,o,p.startLineNumber,p.startColumn),h=Math.min(p.endLineNumber+1,s.lineNumber),m=new this._monaco.Range(h,1,s.lineNumber,s.column);return{selectedCode:l,prefix:e.getValueInRange(f),suffix:e.getValueInRange(m),path:e.uri.path,language:n,prefixBegin:f.startLineNumber-1,suffixEnd:m.endLineNumber-1}}}function Sn(r,t,e){var o,s;const n=(o=r.getModel())==null?void 0:o.original,i=(s=r.getModel())==null?void 0:s.modified;if(!n||!i)throw new Error("No models found");return function(a,u,p,l){return{id:crypto.randomUUID(),name:"",title:"",description:"",generationSource:"",supportedActions:[],unitOfCodeWork:{repoRoot:"",pathName:"",originalCode:a,modifiedCode:u,lineChanges:{lineChanges:[{originalStart:p.startLineNumber,originalEnd:p.endLineNumber,modifiedStart:l.startLineNumber,modifiedEnd:l.endLineNumber}],lineOffset:0}},children:[],childIds:[]}}(n.getValueInRange(t),i.getValueInRange(e),t,e)}function li(r){return r.endLineNumber===0?{startLineNumber:r.startLineNumber+1,startColumn:1,endLineNumber:r.startLineNumber+1,endColumn:1}:{startLineNumber:r.startLineNumber,startColumn:1,endLineNumber:r.endLineNumber+1,endColumn:1}}function fi(r){let t,e;return t=new wt({props:{size:1,variant:"ghost",color:"success",$$slots:{default:[jn]},$$scope:{ctx:r}}}),t.$on("click",function(){$t(r[4])&&r[4].apply(this,arguments)}),{c(){S(t.$$.fragment)},m(n,i){j(t,n,i),e=!0},p(n,i){r=n;const o={};132096&i&&(o.$$scope={dirty:i,ctx:r}),t.$set(o)},i(n){e||(y(t.$$.fragment,n),e=!0)},o(n){b(t.$$.fragment,n),e=!1},d(n){A(t,n)}}}function jn(r){let t,e,n;return t=new Vt({props:{keybinding:r[10].acceptFocusedChunk}}),{c(){S(t.$$.fragment),e=rt(`
        Accept`)},m(i,o){j(t,i,o),x(i,e,o),n=!0},p(i,o){const s={};1024&o&&(s.keybinding=i[10].acceptFocusedChunk),t.$set(s)},i(i){n||(y(t.$$.fragment,i),n=!0)},o(i){b(t.$$.fragment,i),n=!1},d(i){i&&O(e),A(t,i)}}}function An(r){let t,e,n;return t=new Vt({props:{keybinding:r[10].rejectFocusedChunk}}),{c(){S(t.$$.fragment),e=rt(`
      Reject`)},m(i,o){j(t,i,o),x(i,e,o),n=!0},p(i,o){const s={};1024&o&&(s.keybinding=i[10].rejectFocusedChunk),t.$set(s)},i(i){n||(y(t.$$.fragment,i),n=!0)},o(i){b(t.$$.fragment,i),n=!1},d(i){i&&O(e),A(t,i)}}}function Nn(r){let t,e,n,i,o,s,a,u,p,l,f=!r[3]&&fi(r);return a=new wt({props:{size:1,variant:"ghost",color:"error",$$slots:{default:[An]},$$scope:{ctx:r}}}),a.$on("click",function(){$t(r[5])&&r[5].apply(this,arguments)}),{c(){t=H("div"),n=Z(),i=H("div"),o=H("div"),f&&f.c(),s=Z(),S(a.$$.fragment),q(t,"class","svelte-zm1705"),nt(t,"c-chunk-diff-border--focused",!!r[7]&&r[1]),q(o,"class","c-button-container svelte-zm1705"),nt(o,"c-button-container--focused",r[1]),nt(o,"c-button-container--transparent",r[9]),q(i,"class","c-chunk-action-panel-anchor svelte-zm1705"),Tt(i,"top",r[8]+"px"),nt(i,"c-chunk-action-panel-anchor--left",r[0]==="left"),nt(i,"c-chunk-action-panel-anchor--right",r[0]==="right"),nt(i,"c-chunk-action-panel-anchor--focused",r[1])},m(h,m){x(h,t,m),x(h,n,m),x(h,i,m),U(i,o),f&&f.m(o,null),U(o,s),j(a,o,null),u=!0,p||(l=[ki(e=r[6].renderActionsViewZone(t,{chunk:r[7],heightInPx:r[2],onDomNodeTop:r[12]})),kt(i,"mouseenter",r[13]),kt(i,"mousemove",r[13]),kt(i,"mouseleave",r[13])],p=!0)},p(h,[m]){r=h,e&&$t(e.update)&&132&m&&e.update.call(null,{chunk:r[7],heightInPx:r[2],onDomNodeTop:r[12]}),(!u||130&m)&&nt(t,"c-chunk-diff-border--focused",!!r[7]&&r[1]),r[3]?f&&(ut(),b(f,1,1,()=>{f=null}),dt()):f?(f.p(r,m),8&m&&y(f,1)):(f=fi(r),f.c(),y(f,1),f.m(o,s));const C={};132096&m&&(C.$$scope={dirty:m,ctx:r}),a.$set(C),(!u||2&m)&&nt(o,"c-button-container--focused",r[1]),(!u||512&m)&&nt(o,"c-button-container--transparent",r[9]),(!u||256&m)&&Tt(i,"top",r[8]+"px"),(!u||1&m)&&nt(i,"c-chunk-action-panel-anchor--left",r[0]==="left"),(!u||1&m)&&nt(i,"c-chunk-action-panel-anchor--right",r[0]==="right"),(!u||2&m)&&nt(i,"c-chunk-action-panel-anchor--focused",r[1])},i(h){u||(y(f),y(a.$$.fragment,h),u=!0)},o(h){b(f),b(a.$$.fragment,h),u=!1},d(h){h&&(O(t),O(n),O(i)),f&&f.d(),A(a),p=!1,Fe(l)}}}function Ln(r,t,e){let n,{align:i="right"}=t,{isFocused:o}=t,{heightInPx:s=1}=t,{disableApply:a=!1}=t,{onAccept:u}=t,{onReject:p}=t,{diffViewModel:l}=t,{leaf:f}=t;const h=l.keybindings;Wt(r,h,$=>e(10,n=$));let m=0,C,I=!1;function M(){C&&(clearTimeout(C),C=void 0),e(9,I=!1)}return r.$$set=$=>{"align"in $&&e(0,i=$.align),"isFocused"in $&&e(1,o=$.isFocused),"heightInPx"in $&&e(2,s=$.heightInPx),"disableApply"in $&&e(3,a=$.disableApply),"onAccept"in $&&e(4,u=$.onAccept),"onReject"in $&&e(5,p=$.onReject),"diffViewModel"in $&&e(6,l=$.diffViewModel),"leaf"in $&&e(7,f=$.leaf)},[i,o,s,a,u,p,l,f,m,I,n,h,$=>{e(8,m=$)},function($){$.target.closest(".c-button-container")?M():$.type==="mouseenter"||$.type==="mousemove"?(M(),C=setTimeout(()=>{e(9,I=!0)},400)):$.type==="mouseleave"&&M()}]}class Vn extends me{constructor(t){super(),_e(this,t,Ln,Nn,$e,{align:0,isFocused:1,heightInPx:2,disableApply:3,onAccept:4,onReject:5,diffViewModel:6,leaf:7})}}function hi(r){let t,e,n;function i(s){r[18](s)}let o={onOpenChange:r[16],content:r[3],triggerOn:[_n.Hover],$$slots:{default:[Dn]},$$scope:{ctx:r}};return r[4]!==void 0&&(o.requestClose=r[4]),t=new Cn({props:o}),Qt.push(()=>on(t,"requestClose",i)),{c(){S(t.$$.fragment)},m(s,a){j(t,s,a),n=!0},p(s,a){const u={};8&a&&(u.content=s[3]),1048576&a&&(u.$$scope={dirty:a,ctx:s}),!e&&16&a&&(e=!0,u.requestClose=s[4],sn(()=>e=!1)),t.$set(u)},i(s){n||(y(t.$$.fragment,s),n=!0)},o(s){b(t.$$.fragment,s),n=!1},d(s){A(t,s)}}}function Fn(r){let t,e;return t=new yn({}),{c(){S(t.$$.fragment)},m(n,i){j(t,n,i),e=!0},i(n){e||(y(t.$$.fragment,n),e=!0)},o(n){b(t.$$.fragment,n),e=!1},d(n){A(t,n)}}}function Dn(r){let t,e;return t=new mn({props:{variant:"ghost",color:"neutral",size:1,$$slots:{default:[Fn]},$$scope:{ctx:r}}}),t.$on("click",r[17]),{c(){S(t.$$.fragment)},m(n,i){j(t,n,i),e=!0},p(n,i){const o={};1048576&i&&(o.$$scope={dirty:i,ctx:n}),t.$set(o)},i(n){e||(y(t.$$.fragment,n),e=!0)},o(n){b(t.$$.fragment,n),e=!1},d(n){A(t,n)}}}function Rn(r){let t;return{c(){t=H("span"),t.textContent="No changes",q(t,"class","c-diff-page-counter svelte-4zjwll")},m(e,n){x(e,t,n)},p:J,i:J,o:J,d(e){e&&O(t)}}}function zn(r){var p,l;let t,e,n,i,o,s,a,u=((l=(p=r[1])==null?void 0:p.leaves)==null?void 0:l.length)+"";return s=new wi({props:{size:1,loading:r[10]}}),{c(){t=H("span"),e=rt(r[2]),n=rt(" of "),i=rt(u),o=Z(),S(s.$$.fragment),q(t,"class","c-diff-page-counter svelte-4zjwll")},m(f,h){x(f,t,h),U(t,e),U(t,n),U(t,i),U(t,o),j(s,t,null),a=!0},p(f,h){var C,I;(!a||4&h)&&Ne(e,f[2]),(!a||2&h)&&u!==(u=((I=(C=f[1])==null?void 0:C.leaves)==null?void 0:I.length)+"")&&Ne(i,u);const m={};1024&h&&(m.loading=f[10]),s.$set(m)},i(f){a||(y(s.$$.fragment,f),a=!0)},o(f){b(s.$$.fragment,f),a=!1},d(f){f&&O(t),A(s)}}}function Pn(r){let t,e,n,i;return n=new wi({props:{size:1,loading:r[10]}}),{c(){t=H("span"),e=rt(`Generating changes
        `),S(n.$$.fragment),q(t,"class","c-diff-page-counter svelte-4zjwll")},m(o,s){x(o,t,s),U(t,e),j(n,t,null),i=!0},p(o,s){const a={};1024&s&&(a.loading=o[10]),n.$set(a)},i(o){i||(y(n.$$.fragment,o),i=!0)},o(o){b(n.$$.fragment,o),i=!1},d(o){o&&O(t),A(n)}}}function pi(r){let t,e,n,i,o,s;t=new wt({props:{size:1,variant:"ghost",color:"neutral",$$slots:{default:[Tn]},$$scope:{ctx:r}}}),t.$on("click",function(){$t(r[0].focusPrevChunk)&&r[0].focusPrevChunk.apply(this,arguments)}),n=new wt({props:{size:1,variant:"ghost",color:"neutral",$$slots:{default:[Wn]},$$scope:{ctx:r}}}),n.$on("click",function(){$t(r[0].focusNextChunk)&&r[0].focusNextChunk.apply(this,arguments)});let a=!r[12]&&gi(r);return{c(){S(t.$$.fragment),e=Z(),S(n.$$.fragment),i=Z(),a&&a.c(),o=ye()},m(u,p){j(t,u,p),x(u,e,p),j(n,u,p),x(u,i,p),a&&a.m(u,p),x(u,o,p),s=!0},p(u,p){r=u;const l={};1050624&p&&(l.$$scope={dirty:p,ctx:r}),t.$set(l);const f={};1050624&p&&(f.$$scope={dirty:p,ctx:r}),n.$set(f),r[12]?a&&(ut(),b(a,1,1,()=>{a=null}),dt()):a?(a.p(r,p),4096&p&&y(a,1)):(a=gi(r),a.c(),y(a,1),a.m(o.parentNode,o))},i(u){s||(y(t.$$.fragment,u),y(n.$$.fragment,u),y(a),s=!0)},o(u){b(t.$$.fragment,u),b(n.$$.fragment,u),b(a),s=!1},d(u){u&&(O(e),O(i),O(o)),A(t,u),A(n,u),a&&a.d(u)}}}function Tn(r){let t,e,n;return t=new Vt({props:{keybinding:r[11].focusPrevChunk}}),{c(){S(t.$$.fragment),e=rt(`
        Back`)},m(i,o){j(t,i,o),x(i,e,o),n=!0},p(i,o){const s={};2048&o&&(s.keybinding=i[11].focusPrevChunk),t.$set(s)},i(i){n||(y(t.$$.fragment,i),n=!0)},o(i){b(t.$$.fragment,i),n=!1},d(i){i&&O(e),A(t,i)}}}function Wn(r){let t,e,n;return t=new Vt({props:{keybinding:r[11].focusNextChunk}}),{c(){S(t.$$.fragment),e=rt(`
        Next`)},m(i,o){j(t,i,o),x(i,e,o),n=!0},p(i,o){const s={};2048&o&&(s.keybinding=i[11].focusNextChunk),t.$set(s)},i(i){n||(y(t.$$.fragment,i),n=!0)},o(i){b(t.$$.fragment,i),n=!1},d(i){i&&O(e),A(t,i)}}}function gi(r){let t,e,n,i=!r[13]&&mi(r);return e=new wt({props:{size:1,variant:"ghost",color:"error",$$slots:{default:[qn]},$$scope:{ctx:r}}}),e.$on("click",function(){$t(r[0].rejectAllChunks)&&r[0].rejectAllChunks.apply(this,arguments)}),{c(){i&&i.c(),t=Z(),S(e.$$.fragment)},m(o,s){i&&i.m(o,s),x(o,t,s),j(e,o,s),n=!0},p(o,s){(r=o)[13]?i&&(ut(),b(i,1,1,()=>{i=null}),dt()):i?(i.p(r,s),8192&s&&y(i,1)):(i=mi(r),i.c(),y(i,1),i.m(t.parentNode,t));const a={};1050624&s&&(a.$$scope={dirty:s,ctx:r}),e.$set(a)},i(o){n||(y(i),y(e.$$.fragment,o),n=!0)},o(o){b(i),b(e.$$.fragment,o),n=!1},d(o){o&&O(t),i&&i.d(o),A(e,o)}}}function mi(r){let t,e;return t=new wt({props:{size:1,variant:"ghost",color:"success",$$slots:{default:[Un]},$$scope:{ctx:r}}}),t.$on("click",function(){$t(r[0].acceptAllChunks)&&r[0].acceptAllChunks.apply(this,arguments)}),{c(){S(t.$$.fragment)},m(n,i){j(t,n,i),e=!0},p(n,i){r=n;const o={};1050624&i&&(o.$$scope={dirty:i,ctx:r}),t.$set(o)},i(n){e||(y(t.$$.fragment,n),e=!0)},o(n){b(t.$$.fragment,n),e=!1},d(n){A(t,n)}}}function Un(r){let t,e,n;return t=new Vt({props:{keybinding:r[11].acceptAllChunks}}),{c(){S(t.$$.fragment),e=rt(`
            Accept All`)},m(i,o){j(t,i,o),x(i,e,o),n=!0},p(i,o){const s={};2048&o&&(s.keybinding=i[11].acceptAllChunks),t.$set(s)},i(i){n||(y(t.$$.fragment,i),n=!0)},o(i){b(t.$$.fragment,i),n=!1},d(i){i&&O(e),A(t,i)}}}function qn(r){let t,e,n;return t=new Vt({props:{keybinding:r[11].rejectAllChunks}}),{c(){S(t.$$.fragment),e=rt(`
          Reject All`)},m(i,o){j(t,i,o),x(i,e,o),n=!0},p(i,o){const s={};2048&o&&(s.keybinding=i[11].rejectAllChunks),t.$set(s)},i(i){n||(y(t.$$.fragment,i),n=!0)},o(i){b(t.$$.fragment,i),n=!1},d(i){i&&O(e),A(t,i)}}}function Bn(r){let t,e,n,i,o,s,a,u=r[9]&&hi(r);const p=[Pn,zn,Rn],l=[];function f(m,C){return!m[5]&&m[10]?0:m[5]?1:2}i=f(r),o=l[i]=p[i](r);let h=r[5]&&pi(r);return{c(){t=H("div"),e=H("div"),u&&u.c(),n=Z(),o.c(),s=Z(),h&&h.c(),q(e,"class","c-button-container svelte-4zjwll"),q(t,"class","c-top-action-panel-anchor svelte-4zjwll")},m(m,C){x(m,t,C),U(t,e),u&&u.m(e,null),U(e,n),l[i].m(e,null),U(e,s),h&&h.m(e,null),a=!0},p(m,[C]){m[9]?u?(u.p(m,C),512&C&&y(u,1)):(u=hi(m),u.c(),y(u,1),u.m(e,n)):u&&(ut(),b(u,1,1,()=>{u=null}),dt());let I=i;i=f(m),i===I?l[i].p(m,C):(ut(),b(l[I],1,1,()=>{l[I]=null}),dt(),o=l[i],o?o.p(m,C):(o=l[i]=p[i](m),o.c()),y(o,1),o.m(e,s)),m[5]?h?(h.p(m,C),32&C&&y(h,1)):(h=pi(m),h.c(),y(h,1),h.m(e,null)):h&&(ut(),b(h,1,1,()=>{h=null}),dt())},i(m){a||(y(u),y(o),y(h),a=!0)},o(m){b(u),b(o),b(h),a=!1},d(m){m&&O(t),u&&u.d(),l[i].d(),h&&h.d()}}}function Hn(r,t,e){let n,i,o,s,a,u,p,l,f,h,m=J,C=()=>(m(),m=_t(k,D=>e(1,u=D)),k),I=J,M=J,$=J;r.$$.on_destroy.push(()=>m()),r.$$.on_destroy.push(()=>I()),r.$$.on_destroy.push(()=>M()),r.$$.on_destroy.push(()=>$());let{diffViewModel:k}=t;C();const B=k.keybindings;Wt(r,B,D=>e(11,l=D));const Q=k.requestId;Wt(r,Q,D=>e(9,a=D));let P,et="x",G="Copy request ID",X=()=>{};return r.$$set=D=>{"diffViewModel"in D&&C(e(0,k=D.diffViewModel))},r.$$.update=()=>{var D;2&r.$$.dirty&&(e(8,n=u.disableResolution),M(),M=_t(n,ot=>e(12,f=ot))),2&r.$$.dirty&&(e(7,i=u.disableApply),$(),$=_t(i,ot=>e(13,h=ot))),2&r.$$.dirty&&(u.currFocusedChunkIdx!==void 0?e(2,et=(u.currFocusedChunkIdx+1).toString()):e(2,et="x")),2&r.$$.dirty&&(e(6,o=u.isLoading),I(),I=_t(o,ot=>e(10,p=ot))),2&r.$$.dirty&&e(5,s=!!((D=u.leaves)!=null&&D.length))},[k,u,et,G,X,s,o,i,n,a,p,l,f,h,B,Q,function(D){D||(clearTimeout(P),P=void 0,e(3,G="Copy request ID"))},async function(){a&&(await navigator.clipboard.writeText(a),e(3,G="Copied!"),clearTimeout(P),P=setTimeout(X,1500))},function(D){X=D,e(4,X)}]}class Zn extends me{constructor(t){super(),_e(this,t,Hn,Bn,$e,{diffViewModel:0})}}function _i(r){let t,e,n,i,o,s,a,u,p,l,f,h,m,C,I={focusOnInit:!0,$$slots:{default:[Gn]},$$scope:{ctx:r}};return s=new Si.Root({props:I}),r[25](s),p=new wt({props:{id:"close",size:1,variant:"soft",color:"neutral",title:"Close",$$slots:{default:[Kn]},$$scope:{ctx:r}}}),p.$on("click",function(){$t(r[0].disposeDiffViewPanel)&&r[0].disposeDiffViewPanel.apply(this,arguments)}),f=new wt({props:{id:"send",size:1,variant:"solid",color:"accent",title:r[3]===Mt.instruction?"Instruct Augment":"Edit with Augment",disabled:!r[4].trim()||r[11],$$slots:{iconRight:[Yn],default:[Qn]},$$scope:{ctx:r}}}),f.$on("click",r[14]),{c(){t=H("div"),e=Z(),n=H("div"),i=H("div"),o=H("div"),S(s.$$.fragment),a=Z(),u=H("div"),S(p.$$.fragment),l=Z(),S(f.$$.fragment),q(o,"class","l-input-area__input svelte-1cxscce"),q(u,"class","c-instruction-drawer-panel__btn-container svelte-1cxscce"),q(i,"class","instruction-drawer-panel__contents svelte-1cxscce"),q(i,"tabindex","0"),q(i,"role","button"),q(n,"class","instruction-drawer-panel svelte-1cxscce"),Tt(n,"top",r[5]+"px"),Tt(n,"height",r[6]+"px")},m(M,$){x(M,t,$),x(M,e,$),x(M,n,$),U(n,i),U(i,o),j(s,o,null),r[26](o),U(i,a),U(i,u),j(p,u,null),U(u,l),j(f,u,null),h=!0,m||(C=[ki(r[15].call(null,t)),kt(i,"click",r[17]),kt(i,"keydown",r[27])],m=!0)},p(M,$){r=M;const k={};1296&$[0]|256&$[1]&&(k.$$scope={dirty:$,ctx:r}),s.$set(k);const B={};256&$[1]&&(B.$$scope={dirty:$,ctx:r}),p.$set(B);const Q={};8&$[0]&&(Q.title=r[3]===Mt.instruction?"Instruct Augment":"Edit with Augment"),2064&$[0]&&(Q.disabled=!r[4].trim()||r[11]),8&$[0]|256&$[1]&&(Q.$$scope={dirty:$,ctx:r}),f.$set(Q),(!h||32&$[0])&&Tt(n,"top",r[5]+"px"),(!h||64&$[0])&&Tt(n,"height",r[6]+"px")},i(M){h||(y(s.$$.fragment,M),y(p.$$.fragment,M),y(f.$$.fragment,M),h=!0)},o(M){b(s.$$.fragment,M),b(p.$$.fragment,M),b(f.$$.fragment,M),h=!1},d(M){M&&(O(t),O(e),O(n)),r[25](null),A(s),r[26](null),A(p),A(f),m=!1,Fe(C)}}}function Gn(r){let t,e,n,i,o,s,a,u;t=new wn({props:{shortcuts:{Enter:r[23]}}});let p={requestEditorFocus:r[16],onMentionItemsUpdated:r[18]};return n=new Mn({props:p}),r[24](n),o=new Si.Content({props:{content:r[4],onContentChanged:r[19]}}),a=new En({props:{placeholder:r[10]}}),{c(){S(t.$$.fragment),e=Z(),S(n.$$.fragment),i=Z(),S(o.$$.fragment),s=Z(),S(a.$$.fragment)},m(l,f){j(t,l,f),x(l,e,f),j(n,l,f),x(l,i,f),j(o,l,f),x(l,s,f),j(a,l,f),u=!0},p(l,f){n.$set({});const h={};16&f[0]&&(h.content=l[4]),o.$set(h);const m={};1024&f[0]&&(m.placeholder=l[10]),a.$set(m)},i(l){u||(y(t.$$.fragment,l),y(n.$$.fragment,l),y(o.$$.fragment,l),y(a.$$.fragment,l),u=!0)},o(l){b(t.$$.fragment,l),b(n.$$.fragment,l),b(o.$$.fragment,l),b(a.$$.fragment,l),u=!1},d(l){l&&(O(e),O(i),O(s)),A(t,l),r[24](null),A(n,l),A(o,l),A(a,l)}}}function Kn(r){let t,e,n;return e=new Vt({props:{keybinding:"esc"}}),{c(){t=rt(`Close
          `),S(e.$$.fragment)},m(i,o){x(i,t,o),j(e,i,o),n=!0},p:J,i(i){n||(y(e.$$.fragment,i),n=!0)},o(i){b(e.$$.fragment,i),n=!1},d(i){i&&O(t),A(e,i)}}}function Qn(r){let t,e=r[3]===Mt.instruction?"Instruct":"Edit";return{c(){t=rt(e)},m(n,i){x(n,t,i)},p(n,i){8&i[0]&&e!==(e=n[3]===Mt.instruction?"Instruct":"Edit")&&Ne(t,e)},d(n){n&&O(t)}}}function Yn(r){let t,e;return t=new kn({props:{slot:"iconRight"}}),{c(){S(t.$$.fragment)},m(n,i){j(t,n,i),e=!0},p:J,i(n){e||(y(t.$$.fragment,n),e=!0)},o(n){b(t.$$.fragment,n),e=!1},d(n){A(t,n)}}}function Jn(r){let t,e,n=r[2]&&_i(r);return{c(){n&&n.c(),t=ye()},m(i,o){n&&n.m(i,o),x(i,t,o),e=!0},p(i,o){i[2]?n?(n.p(i,o),4&o[0]&&y(n,1)):(n=_i(i),n.c(),y(n,1),n.m(t.parentNode,t)):n&&(ut(),b(n,1,1,()=>{n=null}),dt())},i(i){e||(y(n),e=!0)},o(i){b(n),e=!1},d(i){i&&O(t),n&&n.d(i)}}}function Xn(r,t,e){let n,i,o,s,a,u,p=J,l=()=>(p(),p=_t(h,w=>e(22,s=w)),h),f=J;r.$$.on_destroy.push(()=>p()),r.$$.on_destroy.push(()=>f());let{diffViewModel:h}=t;l();let{initialConversation:m}=t,{initialFlags:C}=t;const I=an.getContext().monaco,M={isWholeLine:!0,marginClassName:"instruction-edit-area-margin"},$=new Ii(Yt);let k=new Oi;$.registerConsumer(k);let B=new xi($,Yt,k,{initialConversation:m,initialFlags:C});const Q=B.currentConversationModel;let P,et;$.registerConsumer(B),vn(B);let G,X="";const D=h.mode;Wt(r,D,w=>e(3,a=w));const ot=h.selectionLines;function Et(){const w=h.getModifiedEditor(),Ot=ct(I);if(!w||!Ot||(G==null||G.clear(),!o))return;const Dt=o.start,Ut=o.end,Xt={range:new Ot.Range(Dt+1,1,Ut+1,1),options:M};G||(G=w.createDecorationsCollection()),G.set([Xt])}function Jt(){return!!(X!=null&&X.trim())&&(h.handleInstructionSubmit(X),!0)}Wt(r,ot,w=>e(2,o=w)),Mi(async()=>{await Ae(),tt(),e(5,Ft=h.editorOffset)}),Ei(()=>{P==null||P.destroy(),G==null||G.clear()});let st,N,Ft=0,xt=57;const tt=()=>st==null?void 0:st.forceFocus();return r.$$set=w=>{"diffViewModel"in w&&l(e(0,h=w.diffViewModel)),"initialConversation"in w&&e(20,m=w.initialConversation),"initialFlags"in w&&e(21,C=w.initialFlags)},r.$$.update=()=>{if(8&r.$$.dirty[0]&&e(10,n=(a===Mt.instruction?"Instruct":"Edit with")+" Augment... @ to focus on files or docs"),4194304&r.$$.dirty[0]&&(e(9,i=s.isLoading),f(),f=_t(i,w=>e(11,u=w))),6&r.$$.dirty[0]&&et){if(o==null)e(6,xt=0);else{const w=et.scrollHeight;e(6,xt=Math.min(40+w,108))}P==null||P.update({heightInPx:xt}),Et()}},[h,et,o,a,X,Ft,xt,st,N,i,n,u,D,ot,Jt,function(w){if(w){const Ot=o?o.start:1;P=h.renderInstructionsDrawerViewZone(w,{line:Ot,heightInPx:xt,onDomNodeTop:Dt=>{e(5,Ft=h.editorOffset+Dt)},autoFocus:!0}),Et()}},()=>st==null?void 0:st.requestFocus(),tt,w=>{Q.saveDraftMentions(w.current)},function(w){e(4,X=w.rawText)},m,C,s,()=>Jt(),function(w){Qt[w?"unshift":"push"](()=>{N=w,e(8,N)})},function(w){Qt[w?"unshift":"push"](()=>{st=w,e(7,st)})},function(w){Qt[w?"unshift":"push"](()=>{et=w,e(1,et)})},w=>{w.key==="Enter"&&(tt(),w.stopPropagation(),w.preventDefault())}]}class tr extends me{constructor(t){super(),_e(this,t,Xn,Jn,$e,{diffViewModel:0,initialConversation:20,initialFlags:21},null,[-1,-1])}}const{window:je}=pn;function $i(r,t,e){const n=r.slice();return n[17]=t[e],n[19]=e,n}function yi(r){let t,e,n,i,o;return e=new Zn({props:{diffViewModel:r[3]}}),i=new tr({props:{diffViewModel:r[3]}}),{c(){t=H("div"),S(e.$$.fragment),n=Z(),S(i.$$.fragment),q(t,"class","sticky-top svelte-dpt00g")},m(s,a){x(s,t,a),j(e,t,null),x(s,n,a),j(i,s,a),o=!0},p(s,a){const u={};8&a&&(u.diffViewModel=s[3]),e.$set(u);const p={};8&a&&(p.diffViewModel=s[3]),i.$set(p)},i(s){o||(y(e.$$.fragment,s),y(i.$$.fragment,s),o=!0)},o(s){b(e.$$.fragment,s),b(i.$$.fragment,s),o=!1},d(s){s&&(O(t),O(n)),A(e),A(i,s)}}}function vi(r){let t,e,n=ci(r[4]),i=[];for(let s=0;s<n.length;s+=1)i[s]=Ci($i(r,n,s));const o=s=>b(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();t=ye()},m(s,a){for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(s,a);x(s,t,a),e=!0},p(s,a){if(280&a){let u;for(n=ci(s[4]),u=0;u<n.length;u+=1){const p=$i(s,n,u);i[u]?(i[u].p(p,a),y(i[u],1)):(i[u]=Ci(p),i[u].c(),y(i[u],1),i[u].m(t.parentNode,t))}for(ut(),u=n.length;u<i.length;u+=1)o(u);dt()}},i(s){if(!e){for(let a=0;a<n.length;a+=1)y(i[a]);e=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)b(i[a]);e=!1},d(s){s&&O(t),un(i,s)}}}function bi(r){var o;let t,e;function n(){return r[14](r[17])}function i(){return r[15](r[17])}return t=new Vn({props:{isFocused:((o=r[3])==null?void 0:o.currFocusedChunkIdx)===r[19],onAccept:n,onReject:i,diffViewModel:r[3],leaf:r[17],align:"right",disableApply:r[8]}}),{c(){S(t.$$.fragment)},m(s,a){j(t,s,a),e=!0},p(s,a){var p;r=s;const u={};8&a&&(u.isFocused=((p=r[3])==null?void 0:p.currFocusedChunkIdx)===r[19]),24&a&&(u.onAccept=n),24&a&&(u.onReject=i),8&a&&(u.diffViewModel=r[3]),16&a&&(u.leaf=r[17]),256&a&&(u.disableApply=r[8]),t.$set(u)},i(s){e||(y(t.$$.fragment,s),e=!0)},o(s){b(t.$$.fragment,s),e=!1},d(s){A(t,s)}}}function Ci(r){let t,e,n=r[17].unitOfCodeWork.modifiedCode!==r[17].unitOfCodeWork.originalCode&&bi(r);return{c(){n&&n.c(),t=ye()},m(i,o){n&&n.m(i,o),x(i,t,o),e=!0},p(i,o){i[17].unitOfCodeWork.modifiedCode!==i[17].unitOfCodeWork.originalCode?n?(n.p(i,o),16&o&&y(n,1)):(n=bi(i),n.c(),y(n,1),n.m(t.parentNode,t)):n&&(ut(),b(n,1,1,()=>{n=null}),dt())},i(i){e||(y(n),e=!0)},o(i){b(n),e=!1},d(i){i&&O(t),n&&n.d(i)}}}function er(r){var p;let t,e,n,i,o,s,a=r[3]&&yi(r),u=r[3]&&((p=r[4])==null?void 0:p.length)&&!r[7]&&vi(r);return{c(){t=H("div"),a&&a.c(),e=Z(),n=H("div"),i=H("div"),o=Z(),u&&u.c(),q(i,"class","editor svelte-dpt00g"),q(n,"class","editor-container svelte-dpt00g"),q(t,"class","diff-view-container svelte-dpt00g")},m(l,f){x(l,t,f),a&&a.m(t,null),U(t,e),U(t,n),U(n,i),r[13](i),U(n,o),u&&u.m(n,null),s=!0},p(l,f){var h;l[3]?a?(a.p(l,f),8&f&&y(a,1)):(a=yi(l),a.c(),y(a,1),a.m(t,e)):a&&(ut(),b(a,1,1,()=>{a=null}),dt()),l[3]&&((h=l[4])!=null&&h.length)&&!l[7]?u?(u.p(l,f),152&f&&y(u,1)):(u=vi(l),u.c(),y(u,1),u.m(n,null)):u&&(ut(),b(u,1,1,()=>{u=null}),dt())},i(l){s||(y(a),y(u),s=!0)},o(l){b(a),b(u),s=!1},d(l){l&&O(t),a&&a.d(),r[13](null),u&&u.d()}}}function ir(r){let t,e,n,i;return t=new cn.Root({props:{$$slots:{default:[er]},$$scope:{ctx:r}}}),{c(){S(t.$$.fragment)},m(o,s){j(t,o,s),e=!0,n||(i=[kt(je,"message",function(){var a,u;$t((a=r[0])==null?void 0:a.handleMessageFromExtension)&&((u=r[0])==null||u.handleMessageFromExtension.apply(this,arguments))}),kt(je,"focus",r[11]),kt(je,"blur",r[12])],n=!0)},p(o,[s]){r=o;const a={};1048986&s&&(a.$$scope={dirty:s,ctx:r}),t.$set(a)},i(o){e||(y(t.$$.fragment,o),e=!0)},o(o){b(t.$$.fragment,o),e=!1},d(o){A(t,o),n=!1,Fe(i)}}}function nr(r,t,e){let n,i,o,s,a,u,p,l,f,h,m=J,C=J,I=J;function M(k){const B=ln.dark;return fn((k==null?void 0:k.category)||B,k==null?void 0:k.intensity)??hn.get(B)}Wt(r,dn,k=>e(10,a=k)),r.$$.on_destroy.push(()=>m()),r.$$.on_destroy.push(()=>C()),r.$$.on_destroy.push(()=>I()),Mi(async()=>{e(9,h=await window.augmentDeps.monaco),h||console.error("Monaco not loaded. Diff view cannot be initialized.")}),Ei(()=>{l==null||l.dispose()});let $=!1;return r.$$.update=()=>{if(1539&r.$$.dirty&&h&&f&&!l&&(e(0,l=new In(f,M(a),h)),m(),m=_t(l,k=>e(3,s=k))),1&r.$$.dirty&&(e(6,n=l==null?void 0:l.disableApply),I(),I=_t(n,k=>e(8,p=k))),1&r.$$.dirty&&(e(5,i=l==null?void 0:l.disableResolution),C(),C=_t(i,k=>e(7,u=k))),1025&r.$$.dirty){const k=a;l&&(l==null||l.updateTheme(M(k)))}8&r.$$.dirty&&e(4,o=s==null?void 0:s.leaves),5&r.$$.dirty&&(l==null||l.updateIsWebviewFocused($))},[l,f,$,s,o,i,n,u,p,h,a,()=>e(2,$=!0),()=>e(2,$=!1),function(k){Qt[k?"unshift":"push"](()=>{f=k,e(1,f)})},k=>s==null?void 0:s.acceptChunk(k),k=>s==null?void 0:s.rejectChunk(k)]}new class extends me{constructor(r){super(),_e(this,r,nr,ir,$e,{})}}({target:document.getElementById("app")});
