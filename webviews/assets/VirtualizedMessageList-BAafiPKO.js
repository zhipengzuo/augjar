var Ft=Object.defineProperty;var jt=(o,t,e)=>t in o?Ft(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var w=(o,t,e)=>jt(o,typeof t!="symbol"?t+"":t,e);import{a9 as J,aa as k,ab as V,ac as Dt,S as Ut,d as Wt,e as Kt,y as H,z as y,Q as j,j as D,E as Z,k as M,A as B,l as rt,b as p,t as f,m as L,B as v,ad as Qt,a7 as F,ae as Yt,Z as Jt,T as ot,a as A,c as E,Y as at,I as Zt,n as P,af as it,K as Ot,a4 as R,ag as Xt}from"./index-p4Dt6o3z.js";import{e as O,u as Pt,o as At}from"./ButtonAugment-DueOA3_V.js";import{d as te,G as ee,M as ne,t as se,a as ie,c as re,b as oe,e as ae,f as le,S as ce,A as ue,C as me,g as de,U as ge,h as Et,E as he,i as pe,R as fe,j as $e,k as _e}from"./MessageListBottomButton-DmSVyLmH.js";import"./Content-7zb4jZEH.js";import{i as X,a as ct,b as ut,c as mt,d as dt,e as gt,f as ht,g as pt,h as ft,j as tt,k as Ie,S as lt,E as Rt,T as Ht,l as wt,A as yt}from"./chat-context-Dq8CyOam.js";import{aG as Se,aH as xe}from"./AugmentMessage-x438MRdb.js";import{S as Me}from"./main-panel-BDgbRPZU.js";import"./isObjectLike-Dcghr38G.js";import"./MaterialIcon-9THX1buP.js";import"./keypress-DD1aQVr0.js";import"./autofix-state-d-ymFdyn.js";import"./Keybindings-BPBUBuVi.js";import"./index-CkBhOCxh.js";import"./TextTooltipAugment-C0ygVke5.js";import"./IconButtonAugment-B0XoCIXT.js";import"./exclamation-triangle-BQxrhBcR.js";import"./pen-to-square-DUXCbbi7.js";import"./augment-logo-C66YBCMf.js";import"./expand-Ccnb8uFO.js";import"./circle-backslash-B3nG_JMr.js";import"./CollapseButtonAugment-C3mt1EeR.js";import"./toggleHighContrast-CKn954qg.js";import"./preload-helper-Dv6uf1Os.js";import"./globals-D0QH3NT1.js";import"./file-paths-BEF4tZXQ.js";import"./github-hmyLGe0b.js";import"./await_block-CgSfNRTu.js";import"./ellipsis-Bz-dObmZ.js";import"./IconFilePath-DrTaSdRG.js";import"./LanguageIcon-e6aGriGL.js";import"./next-edit-types-904A5ehg.js";import"./mcp-logo-CiDifGtg.js";import"./play-DmB9WugJ.js";import"./design-system-init-Bqt81Pxb.js";import"./magnifying-glass-Dmz0PV9T.js";import"./index-DwagmzSc.js";import"./index-BOPL8f7w.js";class Le{constructor(t=10){w(this,"samples",[]);w(this,"maxSamples");this.maxSamples=t}addSample(t,e=performance.now()){this.samples.push({position:t,timestamp:e}),this.samples.length>this.maxSamples&&this.samples.shift()}getVelocity(){if(this.samples.length<2)return 0;const t=this.samples.at(-1),e=this.samples.at(0),n=t.position-e.position,s=t.timestamp-e.timestamp;return s>0?n/s:0}getVelocityPPS(){return 1e3*this.getVelocity()}isFastScroll(t=500){return Math.abs(this.getVelocityPPS())>t}getDirection(){const t=this.getVelocity();return t>.05?"down":t<-.05?"up":"static"}predictPositionAfter(t){if(this.samples.length===0)return 0;const e=this.getVelocity();return this.samples[this.samples.length-1].position+e*t}reset(){this.samples=[]}getCurrentPosition(){return this.samples.length===0?0:this.samples[this.samples.length-1].position}}class be{captureScrollPosition(t){const{scrollHeight:e,scrollTop:n,clientHeight:s}=t;return{scrollHeight:e,scrollTop:n,clientHeight:s,distanceFromBottom:te(t),timestamp:performance.now()}}restoreScrollPosition(t,e){const n=t.scrollHeight-e.distanceFromBottom-t.clientHeight;t.scrollTop=Math.max(0,n)}}class we{constructor(t,e={initialVisibleCount:20,batchSize:10}){w(this,"_config");w(this,"_disposables",[]);w(this,"_currentBatchSize");w(this,"_startIndex");w(this,"_endIndex");w(this,"_isLoading");w(this,"_loadingDirection");w(this,"_allItems");w(this,"_groupedAllItems");w(this,"_groupedVisibleItems");w(this,"hasMoreBefore");w(this,"hasMoreAfter");w(this,"isLoading");w(this,"loadingDirection");w(this,"totalItemCount");this._conversationModel=t,this._config={...e,minBatchSize:e.minBatchSize??e.batchSize,maxBatchSize:e.maxBatchSize??3*e.batchSize},this._currentBatchSize=this._config.batchSize,this._startIndex=J(0),this._endIndex=J(void 0),this._isLoading=J(!1),this._loadingDirection=J(null),this._allItems=k(this._conversationModel,s=>s.chatHistory.filter(i=>X(i)||ct(i)||ut(i)||mt(i)||dt(i)||gt(i)||ht(i)||pt(i)||ft(i)||tt(i))),this._groupedAllItems=k(this._allItems,s=>{const i=s.map((a,u)=>({turn:a,idx:u}));return this._groupItems(i)}),this._groupedVisibleItems=k([this._groupedAllItems,this._startIndex,this._endIndex],([s,i,a])=>{if(s.length===0)return[];let u=0;for(let r=0;r<s.length;r++){const c=s[r];if(c.turns[c.turns.length-1].idx>=i){u=r;break}if(r===s.length-1&&c.turns[c.turns.length-1].idx>=i){u=r;break}}let l=s.length-1;if(a!==void 0)for(let r=s.length-1;r>=0;r--){const c=s[r];if(c.turns[0].idx<=a){l=r;break}if(r===0&&c.turns[0].idx<=a){l=r;break}}return s.slice(u,l+1).map((r,c,m)=>({...r,isLastGroup:c===m.length-1}))}),this.hasMoreBefore=k([this._startIndex],([s])=>s>0),this.hasMoreAfter=k([this._endIndex,this._allItems],([s,i])=>s!==void 0&&s<i.length-1),this.isLoading=k(this._isLoading,s=>s),this.loadingDirection=k(this._loadingDirection,s=>s),this.totalItemCount=k(this._allItems,s=>s.length);const n=V(this._conversationModel);typeof n.onNewConversation=="function"&&this._disposables.push(n.onNewConversation(()=>{this.resetToBottom()})),this.resetToBottom()}subscribe(t){return this._groupedVisibleItems.subscribe(t)}loadMoreBefore(t){const e=V(this._startIndex),n=V(this._isLoading);if(e<=0||n)return!1;this._isLoading.set(!0),this._loadingDirection.set("before");const s=this._getValidBatchSize(t),i=Math.max(0,e-s);return this._startIndex.set(i),this._isLoading.set(!1),this._loadingDirection.set(null),!0}async loadToStart(t={}){const e=V(this._startIndex),n=V(this._isLoading);if(e<=0||n)return!1;this._isLoading.set(!0),this._loadingDirection.set("before");const{smooth:s,smoothInterval:i=500}=t;if(s)for(;this.loadMoreBefore();)await new Promise(a=>setTimeout(a,i)),await Dt();else this._startIndex.set(0);return this._isLoading.set(!1),this._loadingDirection.set(null),!0}loadMoreAfter(t){const e=V(this._endIndex),n=V(this._isLoading),s=V(this._allItems);if(e===void 0||e>=s.length-1||n)return!1;this._isLoading.set(!0),this._loadingDirection.set("after");const i=this._getValidBatchSize(t),a=Math.min(s.length-1,e+i);return a>=s.length-1?this._endIndex.set(void 0):this._endIndex.set(a),this._isLoading.set(!1),this._loadingDirection.set(null),!0}resetToBottom(){const t=V(this._allItems);if(t.length===0)return;const e=Math.max(0,t.length-this._config.initialVisibleCount);this._startIndex.set(e),this._endIndex.set(void 0)}resetToTop(){const t=V(this._allItems);if(t.length===0)return;const e=Math.min(t.length-1,this._config.initialVisibleCount-1);this._startIndex.set(0),this._endIndex.set(e)}async jumpToMessage(t){const e=V(this._allItems),n=e.findIndex(u=>u.request_id===t);if(n===-1)return!1;const s=Math.floor(this._config.initialVisibleCount/2),i=Math.max(0,n-s),a=n+s>=e.length-5?void 0:Math.min(e.length-1,n+s);return this._startIndex.set(i),this._endIndex.set(a),!0}_groupItems(t){return t.reduce((e,{turn:n,idx:s})=>((n.isToolResult===!0||X(n)&&Ie(n))&&e.length>0||tt(n)&&e.length>0?e[e.length-1].turns.push({turn:n,idx:s}):e.push({turns:[{turn:n,idx:s}],firstRequestId:n.request_id,lastRequestId:n.request_id,isLastGroup:!1}),e),[]).map((e,n,s)=>{const i=e.turns.findLast(({turn:u})=>!!u.request_id),a=i==null?void 0:i.turn.request_id;return{...e,lastRequestId:a,isLastGroup:n===s.length-1}})}setDynamicBatchSize(t){this._currentBatchSize=this._getValidBatchSize(t)}getCurrentBatchSize(){return this._currentBatchSize}_getValidBatchSize(t){if(t===void 0)return this._currentBatchSize;const e=this._config.minBatchSize??this._config.batchSize,n=this._config.maxBatchSize??3*this._config.batchSize;return Math.max(e,Math.min(n,t))}dispose(){this._disposables.forEach(t=>t())}}function Bt(o,t,e){const n=o.slice();return n[41]=t[e],n[43]=e,n}function vt(o,t,e){const n=o.slice();n[46]=t[e].turn,n[47]=t[e].idx;const s=n[47]+1===n[9].length;return n[48]=s,n}function zt(o){let t;return{c(){t=H("div"),t.textContent="Loading earlier messages...",D(t,"class","c-msg-list__loading svelte-ai15zf")},m(e,n){M(e,t,n)},d(e){e&&L(t)}}}function ye(o){let t,e,n,s;const i=[De,ke],a=[];function u(l,r){return l[15].enableRichCheckpointInfo?0:1}return t=u(o),e=a[t]=i[t](o),{c(){e.c(),n=R()},m(l,r){a[t].m(l,r),M(l,n,r),s=!0},p(l,r){let c=t;t=u(l),t===c?a[t].p(l,r):(A(),f(a[c],1,1,()=>{a[c]=null}),E(),e=a[t],e?e.p(l,r):(e=a[t]=i[t](l),e.c()),p(e,1),e.m(n.parentNode,n))},i(l){s||(p(e),s=!0)},o(l){f(e),s=!1},d(l){l&&L(n),a[t].d(l)}}}function Be(o){let t,e;return t=new me({props:{chatModel:o[1],turn:o[46],turnIndex:o[47],isLastTurn:o[48],messageListContainer:o[0]}}),{c(){y(t.$$.fragment)},m(n,s){B(t,n,s),e=!0},p(n,s){const i={};2&s[0]&&(i.chatModel=n[1]),131072&s[0]&&(i.turn=n[46]),131072&s[0]&&(i.turnIndex=n[47]),131584&s[0]&&(i.isLastTurn=n[48]),1&s[0]&&(i.messageListContainer=n[0]),t.$set(i)},i(n){e||(p(t.$$.fragment,n),e=!0)},o(n){f(t.$$.fragment,n),e=!1},d(n){v(t,n)}}}function ve(o){let t,e;return t=new de({props:{stage:o[46].stage,iterationId:o[46].iterationId,stageCount:o[46].stageCount}}),{c(){y(t.$$.fragment)},m(n,s){B(t,n,s),e=!0},p(n,s){const i={};131072&s[0]&&(i.stage=n[46].stage),131072&s[0]&&(i.iterationId=n[46].iterationId),131072&s[0]&&(i.stageCount=n[46].stageCount),t.$set(i)},i(n){e||(p(t.$$.fragment,n),e=!0)},o(n){f(t.$$.fragment,n),e=!1},d(n){v(t,n)}}}function ze(o){let t,e;return t=new ge({props:{chatModel:o[1],msg:o[46].response_text??""}}),{c(){y(t.$$.fragment)},m(n,s){B(t,n,s),e=!0},p(n,s){const i={};2&s[0]&&(i.chatModel=n[1]),131072&s[0]&&(i.msg=n[46].response_text??""),t.$set(i)},i(n){e||(p(t.$$.fragment,n),e=!0)},o(n){f(t.$$.fragment,n),e=!1},d(n){v(t,n)}}}function Ce(o){let t,e;return t=new Se({props:{markdown:o[46].response_text??"",messageListContainer:o[0]}}),{c(){y(t.$$.fragment)},m(n,s){B(t,n,s),e=!0},p(n,s){const i={};131072&s[0]&&(i.markdown=n[46].response_text??""),1&s[0]&&(i.messageListContainer=n[0]),t.$set(i)},i(n){e||(p(t.$$.fragment,n),e=!0)},o(n){f(t.$$.fragment,n),e=!1},d(n){v(t,n)}}}function Te(o){let t,e;function n(){return o[31](o[46])}return t=new Et({props:{turn:o[46],preamble:Me,resendTurn:n,$$slots:{default:[Pe]},$$scope:{ctx:o}}}),{c(){y(t.$$.fragment)},m(s,i){B(t,s,i),e=!0},p(s,i){o=s;const a={};131072&i[0]&&(a.turn=o[46]),131076&i[0]&&(a.resendTurn=n),131088&i[0]|1048576&i[1]&&(a.$$scope={dirty:i,ctx:o}),t.$set(a)},i(s){e||(p(t.$$.fragment,s),e=!0)},o(s){f(t.$$.fragment,s),e=!1},d(s){v(t,s)}}}function qe(o){let t,e;return t=new he({props:{flagsModel:o[10],turn:o[46]}}),{c(){y(t.$$.fragment)},m(n,s){B(t,n,s),e=!0},p(n,s){const i={};1024&s[0]&&(i.flagsModel=n[10]),131072&s[0]&&(i.turn=n[46]),t.$set(i)},i(n){e||(p(t.$$.fragment,n),e=!0)},o(n){f(t.$$.fragment,n),e=!1},d(n){v(t,n)}}}function Ve(o){let t,e;return t=new Et({props:{turn:o[46]}}),{c(){y(t.$$.fragment)},m(n,s){B(t,n,s),e=!0},p(n,s){const i={};131072&s[0]&&(i.turn=n[46]),t.$set(i)},i(n){e||(p(t.$$.fragment,n),e=!0)},o(n){f(t.$$.fragment,n),e=!1},d(n){v(t,n)}}}function ke(o){let t,e;return t=new $e({props:{turn:o[46]}}),{c(){y(t.$$.fragment)},m(n,s){B(t,n,s),e=!0},p(n,s){const i={};131072&s[0]&&(i.turn=n[46]),t.$set(i)},i(n){e||(p(t.$$.fragment,n),e=!0)},o(n){f(t.$$.fragment,n),e=!1},d(n){v(t,n)}}}function De(o){let t,e;return t=new _e({props:{turn:o[46]}}),{c(){y(t.$$.fragment)},m(n,s){B(t,n,s),e=!0},p(n,s){const i={};131072&s[0]&&(i.turn=n[46]),t.$set(i)},i(n){e||(p(t.$$.fragment,n),e=!0)},o(n){f(t.$$.fragment,n),e=!1},d(n){v(t,n)}}}function Pe(o){let t,e;return t=new xe({props:{conversationModel:o[4],turn:o[46]}}),{c(){y(t.$$.fragment)},m(n,s){B(t,n,s),e=!0},p(n,s){const i={};16&s[0]&&(i.conversationModel=n[4]),131072&s[0]&&(i.turn=n[46]),t.$set(i)},i(n){e||(p(t.$$.fragment,n),e=!0)},o(n){f(t.$$.fragment,n),e=!1},d(n){v(t,n)}}}function Ct(o){let t,e,n,s;function i(){return o[32](o[46])}return{c(){t=H("div"),D(t,"class","c-msg-list__turn-seen")},m(a,u){M(a,t,u),n||(s=ot(e=le.call(null,t,{onSeen:i,track:o[46].seen_state!==lt.seen})),n=!0)},p(a,u){o=a,e&&at(e.update)&&131072&u[0]&&e.update.call(null,{onSeen:i,track:o[46].seen_state!==lt.seen})},d(a){a&&L(t),n=!1,s()}}}function Tt(o,t){let e,n,s,i,a,u,l,r,c,m,h,z,I,g,_=wt(t[46]);const C=[Ve,qe,Te,Ce,ze,ve,Be,ye],q=[];function U($,S){return 131072&S[0]&&(n=null),131072&S[0]&&(s=null),131072&S[0]&&(i=null),131072&S[0]&&(a=null),131072&S[0]&&(u=null),131072&S[0]&&(l=null),131072&S[0]&&(r=null),131072&S[0]&&(c=null),n==null&&(n=!!ct($[46])),n?0:(s==null&&(s=!!mt($[46])),s?1:(i==null&&(i=!!dt($[46])),i?2:(a==null&&(a=!!gt($[46])),a?3:(u==null&&(u=!!ht($[46])),u?4:(l==null&&(l=!!pt($[46])),l?5:(r==null&&(r=!!(X($[46])||ut($[46])||ft($[46]))),r?6:(c==null&&(c=!(!tt($[46])||$[46].status!==Rt.success)),c?7:-1)))))))}~(m=U(t,[-1,-1]))&&(h=q[m]=C[m](t));let b=_&&Ct(t);return{key:o,first:null,c(){e=R(),h&&h.c(),z=j(),b&&b.c(),I=R(),this.first=e},m($,S){M($,e,S),~m&&q[m].m($,S),M($,z,S),b&&b.m($,S),M($,I,S),g=!0},p($,S){let T=m;m=U(t=$,S),m===T?~m&&q[m].p(t,S):(h&&(A(),f(q[T],1,1,()=>{q[T]=null}),E()),~m?(h=q[m],h?h.p(t,S):(h=q[m]=C[m](t),h.c()),p(h,1),h.m(z.parentNode,z)):h=null),131072&S[0]&&(_=wt(t[46])),_?b?b.p(t,S):(b=Ct(t),b.c(),b.m(I.parentNode,I)):b&&(b.d(1),b=null)},i($){g||(p(h),g=!0)},o($){f(h),g=!1},d($){$&&(L(e),L(z),L(I)),~m&&q[m].d($),b&&b.d($)}}}function qt(o){let t,e,n,s;const i=[Re,Ee,Ae],a=[];function u(r,c){return r[11]===yt.running?0:r[11]===yt.awaitingUserAction?1:r[7]?2:-1}function l(r,c){return c===0?function(m){var I;const h=m.slice(),z=(I=h[4])==null?void 0:I.lastExchange;return h[44]=z,h}(r):r}return~(t=u(o))&&(e=a[t]=i[t](l(o,t))),{c(){e&&e.c(),n=R()},m(r,c){~t&&a[t].m(r,c),M(r,n,c),s=!0},p(r,c){let m=t;t=u(r),t===m?~t&&a[t].p(l(r,t),c):(e&&(A(),f(a[m],1,1,()=>{a[m]=null}),E()),~t?(e=a[t],e?e.p(l(r,t),c):(e=a[t]=i[t](l(r,t)),e.c()),p(e,1),e.m(n.parentNode,n)):e=null)},i(r){s||(p(e),s=!0)},o(r){f(e),s=!1},d(r){r&&L(n),~t&&a[t].d(r)}}}function Ae(o){let t,e;return t=new ce({}),{c(){y(t.$$.fragment)},m(n,s){B(t,n,s),e=!0},p:P,i(n){e||(p(t.$$.fragment,n),e=!0)},o(n){f(t.$$.fragment,n),e=!1},d(n){v(t,n)}}}function Ee(o){let t,e,n,s;return t=new ue({}),{c(){y(t.$$.fragment),e=j(),n=H("div"),D(n,"class","c-agent-running-spacer svelte-ai15zf")},m(i,a){B(t,i,a),M(i,e,a),M(i,n,a),s=!0},p:P,i(i){s||(p(t.$$.fragment,i),s=!0)},o(i){f(t.$$.fragment,i),s=!1},d(i){i&&(L(e),L(n)),v(t,i)}}}function Re(o){let t,e,n,s;const i=[Ne,Ge,He],a=[];function u(r,c){var m,h;return(m=r[44])!=null&&m.isRetriable&&((h=r[44])!=null&&h.display_error_message)?0:r[18]?1:2}function l(r,c){return c===1?function(m){const h=m.slice(),z=h[4].getLastToolUseState();return h[45]=z,h}(r):r}return t=u(o),e=a[t]=i[t](l(o,t)),{c(){e.c(),n=R()},m(r,c){a[t].m(r,c),M(r,n,c),s=!0},p(r,c){let m=t;t=u(r),t===m?a[t].p(l(r,t),c):(A(),f(a[m],1,1,()=>{a[m]=null}),E(),e=a[t],e?e.p(l(r,t),c):(e=a[t]=i[t](l(r,t)),e.c()),p(e,1),e.m(n.parentNode,n))},i(r){s||(p(e),s=!0)},o(r){f(e),s=!1},d(r){r&&L(n),a[t].d(r)}}}function He(o){let t,e;return t=new pe({}),{c(){y(t.$$.fragment)},m(n,s){B(t,n,s),e=!0},p:P,i(n){e||(p(t.$$.fragment,n),e=!0)},o(n){f(t.$$.fragment,n),e=!1},d(n){v(t,n)}}}function Ge(o){let t,e,n,s;const i=[je,Fe],a=[];function u(l,r){return l[45].phase!==Ht.running?0:1}return t=u(o),e=a[t]=i[t](o),{c(){e.c(),n=R()},m(l,r){a[t].m(l,r),M(l,n,r),s=!0},p(l,r){let c=t;t=u(l),t!==c&&(A(),f(a[c],1,1,()=>{a[c]=null}),E(),e=a[t],e||(e=a[t]=i[t](l),e.c()),p(e,1),e.m(n.parentNode,n))},i(l){s||(p(e),s=!0)},o(l){f(e),s=!1},d(l){l&&L(n),a[t].d(l)}}}function Ne(o){let t,e;return t=new fe({props:{message:o[44].display_error_message}}),{c(){y(t.$$.fragment)},m(n,s){B(t,n,s),e=!0},p(n,s){const i={};16&s[0]&&(i.message=n[44].display_error_message),t.$set(i)},i(n){e||(p(t.$$.fragment,n),e=!0)},o(n){f(t.$$.fragment,n),e=!1},d(n){v(t,n)}}}function Fe(o){let t;return{c(){t=H("div"),D(t,"class","c-agent-running-spacer svelte-ai15zf")},m(e,n){M(e,t,n)},i:P,o:P,d(e){e&&L(t)}}}function je(o){let t,e,n;return e=new Xt({props:{size:1}}),{c(){t=H("div"),y(e.$$.fragment),D(t,"class","c-agent-running-spinner svelte-ai15zf")},m(s,i){M(s,t,i),B(e,t,null),n=!0},i(s){n||(p(e.$$.fragment,s),n=!0)},o(s){f(e.$$.fragment,s),n=!1},d(s){s&&L(t),v(e)}}}function Ue(o){let t,e,n,s=[],i=new Map,a=O(o[41].turns);const u=r=>r[46].request_id??`no-request-id-${r[47]}`;for(let r=0;r<a.length;r+=1){let c=vt(o,a,r),m=u(c);i.set(m,s[r]=Tt(m,c))}let l=o[41].isLastGroup&&qt(o);return{c(){for(let r=0;r<s.length;r+=1)s[r].c();t=j(),l&&l.c(),e=R()},m(r,c){for(let m=0;m<s.length;m+=1)s[m]&&s[m].m(r,c);M(r,t,c),l&&l.m(r,c),M(r,e,c),n=!0},p(r,c){268600855&c[0]&&(a=O(r[41].turns),A(),s=Pt(s,c,u,1,r,a,i,t.parentNode,At,Tt,t,vt),E()),r[41].isLastGroup?l?(l.p(r,c),131072&c[0]&&p(l,1)):(l=qt(r),l.c(),p(l,1),l.m(e.parentNode,e)):l&&(A(),f(l,1,1,()=>{l=null}),E())},i(r){if(!n){for(let c=0;c<a.length;c+=1)p(s[c]);p(l),n=!0}},o(r){for(let c=0;c<s.length;c+=1)f(s[c]);f(l),n=!1},d(r){r&&(L(t),L(e));for(let c=0;c<s.length;c+=1)s[c].d(r);l&&l.d(r)}}}function Vt(o,t){let e,n,s;return n=new ae({props:{class:"c-msg-list__item--grouped",chatModel:t[1],isLastItem:t[41].isLastGroup,userControlsScroll:t[5],requestId:t[41].firstRequestId,releaseScroll:t[33],messageListContainer:t[0],minHeight:t[41].isLastGroup?t[8]:0,dataRequestId:t[41].firstRequestId,$$slots:{default:[Ue]},$$scope:{ctx:t}}}),{key:o,first:null,c(){e=R(),y(n.$$.fragment),this.first=e},m(i,a){M(i,e,a),B(n,i,a),s=!0},p(i,a){t=i;const u={};2&a[0]&&(u.chatModel=t[1]),131072&a[0]&&(u.isLastItem=t[41].isLastGroup),32&a[0]&&(u.userControlsScroll=t[5]),131072&a[0]&&(u.requestId=t[41].firstRequestId),32&a[0]&&(u.releaseScroll=t[33]),1&a[0]&&(u.messageListContainer=t[0]),131328&a[0]&&(u.minHeight=t[41].isLastGroup?t[8]:0),131072&a[0]&&(u.dataRequestId=t[41].firstRequestId),429719&a[0]|1048576&a[1]&&(u.$$scope={dirty:a,ctx:t}),n.$set(u)},i(i){s||(p(n.$$.fragment,i),s=!0)},o(i){f(n.$$.fragment,i),s=!1},d(i){i&&L(e),v(n,i)}}}function kt(o){let t;return{c(){t=H("div"),t.textContent="Loading more messages...",D(t,"class","c-msg-list__loading svelte-ai15zf")},m(e,n){M(e,t,n)},d(e){e&&L(t)}}}function We(o){let t,e,n,s,i,a,u,l,r=[],c=new Map,m=o[14]&&o[16]==="before"&&zt(),h=O(o[17]);const z=g=>g[41].firstRequestId??`no-request-id-${g[43]}`;for(let g=0;g<h.length;g+=1){let _=Bt(o,h,g),C=z(_);c.set(C,r[g]=Vt(C,_))}let I=o[14]&&o[16]==="after"&&kt();return{c(){t=H("div"),m&&m.c(),e=j();for(let g=0;g<r.length;g+=1)r[g].c();n=j(),I&&I.c(),D(t,"class","c-msg-list svelte-ai15zf"),Z(t,"c-msg-list--minimal",!o[15].fullFeatured)},m(g,_){M(g,t,_),m&&m.m(t,null),rt(t,e);for(let C=0;C<r.length;C+=1)r[C]&&r[C].m(t,null);rt(t,n),I&&I.m(t,null),o[34](t),a=!0,u||(l=[ot(s=se.call(null,t,{onScrollIntoBottom:o[35],onScrollAwayFromBottom:o[36],onScroll:o[37]})),ot(i=ie.call(null,t,{onHeightChange:o[38]}))],u=!0)},p(g,_){g[14]&&g[16]==="before"?m||(m=zt(),m.c(),m.m(t,e)):m&&(m.d(1),m=null),268865463&_[0]&&(h=O(g[17]),A(),r=Pt(r,_,z,1,g,h,c,t,At,Vt,n,Bt),E()),g[14]&&g[16]==="after"?I||(I=kt(),I.c(),I.m(t,null)):I&&(I.d(1),I=null),s&&at(s.update)&&8289&_[0]&&s.update.call(null,{onScrollIntoBottom:g[35],onScrollAwayFromBottom:g[36],onScroll:g[37]}),i&&at(i.update)&&8&_[0]&&i.update.call(null,{onHeightChange:g[38]}),(!a||32768&_[0])&&Z(t,"c-msg-list--minimal",!g[15].fullFeatured)},i(g){if(!a){for(let _=0;_<h.length;_+=1)p(r[_]);a=!0}},o(g){for(let _=0;_<r.length;_+=1)f(r[_]);a=!1},d(g){g&&L(t),m&&m.d();for(let _=0;_<r.length;_+=1)r[_].d();I&&I.d(),o[34](null),u=!1,Zt(l)}}}function Ke(o){let t,e,n,s,i;return e=new ee({props:{$$slots:{default:[We]},$$scope:{ctx:o}}}),s=new ne({props:{messageListElement:o[0],showScrollDown:!o[6]}}),{c(){t=H("div"),y(e.$$.fragment),n=j(),y(s.$$.fragment),D(t,"class","c-msg-list-container svelte-ai15zf"),D(t,"data-testid","chat-message-list"),Z(t,"c-msg-list--minimal",!o[15].fullFeatured)},m(a,u){M(a,t,u),B(e,t,null),rt(t,n),B(s,t,null),i=!0},p(a,u){const l={};520191&u[0]|1048576&u[1]&&(l.$$scope={dirty:u,ctx:a}),e.$set(l);const r={};1&u[0]&&(r.messageListElement=a[0]),64&u[0]&&(r.showScrollDown=!a[6]),s.$set(r),(!i||32768&u[0])&&Z(t,"c-msg-list--minimal",!a[15].fullFeatured)},i(a){i||(p(e.$$.fragment,a),p(s.$$.fragment,a),i=!0)},o(a){f(e.$$.fragment,a),f(s.$$.fragment,a),i=!1},d(a){a&&L(t),v(e),v(s)}}}function Qe(o,t,e){let n,s,i,a,u,l,r,c,m,h,z,I,g,_,C=P,q=P,U=()=>(q(),q=it($,d=>e(29,m=d)),$),b=P;o.$$.on_destroy.push(()=>C()),o.$$.on_destroy.push(()=>q()),o.$$.on_destroy.push(()=>b());let{chatModel:$}=t;U();let{onboardingWorkspaceModel:S}=t,{msgListElement:T}=t;const Gt=Qt("agentConversationModel"),{agentExchangeStatus:$t,isCurrConversationAgentic:_t}=Gt;F(o,$t,d=>e(30,h=d)),F(o,_t,d=>e(18,_=d));const G=new we(k($,d=>d.currentConversationModel),{initialVisibleCount:20,batchSize:10,minBatchSize:5,maxBatchSize:20});F(o,G,d=>e(17,g=d));const{hasMoreBefore:It,isLoading:St,loadingDirection:xt}=G;F(o,It,d=>e(13,r=d)),F(o,St,d=>e(14,c=d)),F(o,xt,d=>e(16,I=d));const W=new Le(3),Mt=new be;Yt(()=>{G.dispose()});let Y=!1;function N(){e(5,Y=!0)}async function et(){if(!T||!r||c)return;N();const d=Mt.captureScrollPosition(T),x=W.getVelocityPPS(),K=re(x,G.getCurrentBatchSize()),Q=G.loadMoreBefore(K);d&&(N(),Mt.restoreScrollPosition(T,d),await Dt()),Q&&T&&T.scrollTop<=1&&r&&et()}Jt(()=>{var d;((d=l.lastExchange)==null?void 0:d.seen_state)===lt.unseen&&N()});let nt=0,st=!0;const Lt=d=>l.markSeen(d);let bt=!1;return o.$$set=d=>{"chatModel"in d&&U(e(1,$=d.chatModel)),"onboardingWorkspaceModel"in d&&e(2,S=d.onboardingWorkspaceModel),"msgListElement"in d&&e(0,T=d.msgListElement)},o.$$.update=()=>{var d;if(536870912&o.$$.dirty[0]&&(e(12,n=m.currentConversationModel),C(),C=it(n,x=>e(4,l=x))),1073741824&o.$$.dirty[0]&&e(11,s=h),536870912&o.$$.dirty[0]&&(e(10,i=m.flags),b(),b=it(i,x=>e(15,z=x))),16&o.$$.dirty[0]&&e(9,a=l.chatHistory.filter(x=>X(x)||ct(x)||ut(x)||mt(x)||dt(x)||gt(x)||ht(x)||pt(x)||ft(x)||tt(x))),8&o.$$.dirty[0]&&e(8,u=nt),16&o.$$.dirty[0]){const x=(d=l==null?void 0:l.lastExchange)==null?void 0:d.status,K=x===Rt.cancelled,Q=l==null?void 0:l.getLastToolUseState().phase,Nt=Q===Ht.cancelled;e(7,bt=K||Nt)}},[T,$,S,nt,l,Y,st,bt,u,a,i,s,n,r,c,z,I,g,_,$t,_t,G,It,St,xt,W,N,et,Lt,m,h,d=>S.retryProjectSummary(d),d=>Lt(d),()=>e(5,Y=!0),function(d){Ot[d?"unshift":"push"](()=>{T=d,e(0,T)})},()=>{e(5,Y=!1),e(6,st=!0),G.resetToBottom()},()=>{N(),e(6,st=!1)},d=>{if(d<=1&&N(),T){W.addSample(d);const x=W.getVelocityPPS(),K=W.getDirection(),Q=oe(x,{baseThreshold:200,predictTime:300});K==="up"&&d<Q&&r&&et()}},d=>e(3,nt=d)]}class kn extends Ut{constructor(t){super(),Wt(this,t,Qe,Ke,Kt,{chatModel:1,onboardingWorkspaceModel:2,msgListElement:0},null,[-1,-1])}}export{kn as default};
